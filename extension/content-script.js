var s = document.createElement('script');
// If we load the script with s.src="bundle.js" other code may run on the page before our the devtoolsFormatters are installed
// In that case the ImmutableJS objects would appear unformatted
s.textContent = decodeURI("/******/%20(function(modules)%20%7B%20//%20webpackBootstrap%0A/******/%20%09//%20The%20module%20cache%0A/******/%20%09var%20installedModules%20=%20%7B%7D;%0A%0A/******/%20%09//%20The%20require%20function%0A/******/%20%09function%20__webpack_require__(moduleId)%20%7B%0A%0A/******/%20%09%09//%20Check%20if%20module%20is%20in%20cache%0A/******/%20%09%09if(installedModules%5BmoduleId%5D)%0A/******/%20%09%09%09return%20installedModules%5BmoduleId%5D.exports;%0A%0A/******/%20%09%09//%20Create%20a%20new%20module%20(and%20put%20it%20into%20the%20cache)%0A/******/%20%09%09var%20module%20=%20installedModules%5BmoduleId%5D%20=%20%7B%0A/******/%20%09%09%09exports:%20%7B%7D,%0A/******/%20%09%09%09id:%20moduleId,%0A/******/%20%09%09%09loaded:%20false%0A/******/%20%09%09%7D;%0A%0A/******/%20%09%09//%20Execute%20the%20module%20function%0A/******/%20%09%09modules%5BmoduleId%5D.call(module.exports,%20module,%20module.exports,%20__webpack_require__);%0A%0A/******/%20%09%09//%20Flag%20the%20module%20as%20loaded%0A/******/%20%09%09module.loaded%20=%20true;%0A%0A/******/%20%09%09//%20Return%20the%20exports%20of%20the%20module%0A/******/%20%09%09return%20module.exports;%0A/******/%20%09%7D%0A%0A%0A/******/%20%09//%20expose%20the%20modules%20object%20(__webpack_modules__)%0A/******/%20%09__webpack_require__.m%20=%20modules;%0A%0A/******/%20%09//%20expose%20the%20module%20cache%0A/******/%20%09__webpack_require__.c%20=%20installedModules;%0A%0A/******/%20%09//%20__webpack_public_path__%0A/******/%20%09__webpack_require__.p%20=%20%22%22;%0A%0A/******/%20%09//%20Load%20entry%20module%20and%20return%20exports%0A/******/%20%09return%20__webpack_require__(0);%0A/******/%20%7D)%0A/************************************************************************/%0A/******/%20(%5B%0A/*%200%20*/%0A/***/%20function(module,%20exports,%20__webpack_require__)%20%7B%0A%0A%09%22use%20strict%22;%0A%0A%09var%20_immutableDevtools%20=%20__webpack_require__(1);%0A%0A%09var%20_immutableDevtools2%20=%20_interopRequireDefault(_immutableDevtools);%0A%0A%09var%20_createFormatters%20=%20__webpack_require__(2);%0A%0A%09function%20_interopRequireDefault(obj)%20%7B%20return%20obj%20&&%20obj.__esModule%20?%20obj%20:%20%7B%20default:%20obj%20%7D;%20%7D%0A%0A%09(0,%20_immutableDevtools2.default)();%0A%0A%09if%20(window.__ExposeIsRecordForTesting)%20%7B%0A%09%20%20%20%20window.isRecordForTesting%20=%20_createFormatters.isRecord;%0A%09%7D%0A%0A/***/%20%7D,%0A/*%201%20*/%0A/***/%20function(module,%20exports,%20__webpack_require__)%20%7B%0A%0A%09%22use%20strict%22;%0A%0A%09Object.defineProperty(exports,%20%22__esModule%22,%20%7B%0A%09%20%20value:%20true%0A%09%7D);%0A%09exports.default%20=%20install;%0A%0A%09var%20_createFormatters2%20=%20__webpack_require__(2);%0A%0A%09var%20_createFormatters3%20=%20_interopRequireDefault(_createFormatters2);%0A%0A%09function%20_interopRequireDefault(obj)%20%7B%20return%20obj%20&&%20obj.__esModule%20?%20obj%20:%20%7B%20default:%20obj%20%7D;%20%7D%0A%0A%09function%20install(Immutable)%20%7B%0A%09%20%20if%20(typeof%20window%20===%20%22undefined%22)%20%7B%0A%09%20%20%20%20throw%20new%20Error(%22Can%20only%20install%20immutable-devtools%20in%20a%20browser%20environment.%22);%0A%09%20%20%7D%0A%0A%09%20%20//%20Don't%20install%20more%20than%20once.%0A%09%20%20if%20(window.__ImmutableJSDevToolsFormattersInstalled%20===%20true)%20%7B%0A%09%20%20%20%20return;%0A%09%20%20%7D%0A%0A%09%20%20window.devtoolsFormatters%20=%20window.devtoolsFormatters%20%7C%7C%20%5B%5D;%0A%09%20%20window.__ImmutableJSDevToolsFormattersInstalled%20=%20true;%0A%0A%09%20%20var%20_createFormatters%20=%20(0,%20_createFormatters3.default)(Immutable);%0A%0A%09%20%20var%20RecordFormatter%20=%20_createFormatters.RecordFormatter;%0A%09%20%20var%20OrderedMapFormatter%20=%20_createFormatters.OrderedMapFormatter;%0A%09%20%20var%20OrderedSetFormatter%20=%20_createFormatters.OrderedSetFormatter;%0A%09%20%20var%20ListFormatter%20=%20_createFormatters.ListFormatter;%0A%09%20%20var%20MapFormatter%20=%20_createFormatters.MapFormatter;%0A%09%20%20var%20SetFormatter%20=%20_createFormatters.SetFormatter;%0A%09%20%20var%20StackFormatter%20=%20_createFormatters.StackFormatter;%0A%0A%0A%09%20%20window.devtoolsFormatters.push(RecordFormatter,%20OrderedMapFormatter,%20OrderedSetFormatter,%20ListFormatter,%20MapFormatter,%20SetFormatter,%20StackFormatter);%0A%09%7D%0A%0A/***/%20%7D,%0A/*%202%20*/%0A/***/%20function(module,%20exports,%20__webpack_require__)%20%7B%0A%0A%09'use%20strict';%0A%0A%09Object.defineProperty(exports,%20%22__esModule%22,%20%7B%0A%09%20%20value:%20true%0A%09%7D);%0A%09exports.isRecord%20=%20undefined;%0A%09exports.default%20=%20createFormatter;%0A%0A%09var%20_immutable%20=%20__webpack_require__(3);%0A%0A%09var%20_immutable2%20=%20_interopRequireDefault(_immutable);%0A%0A%09function%20_interopRequireDefault(obj)%20%7B%20return%20obj%20&&%20obj.__esModule%20?%20obj%20:%20%7B%20default:%20obj%20%7D;%20%7D%0A%0A%09function%20_toConsumableArray(arr)%20%7B%20if%20(Array.isArray(arr))%20%7B%20for%20(var%20i%20=%200,%20arr2%20=%20Array(arr.length);%20i%20%3C%20arr.length;%20i++)%20%7B%20arr2%5Bi%5D%20=%20arr%5Bi%5D;%20%7D%20return%20arr2;%20%7D%20else%20%7B%20return%20Array.from(arr);%20%7D%20%7D%0A%0A%09var%20listStyle%20=%20%7B%20style:%20'list-style-type:%20none;%20padding:%200;%20margin:%200%200%200%2012px;%20font-style:%20normal'%20%7D;%0A%09var%20immutableNameStyle%20=%20%7B%20style:%20'color:%20rgb(232,98,0)'%20%7D;%0A%09var%20keyStyle%20=%20%7B%20style:%20'color:%20#881391'%20%7D;%0A%09var%20defaultValueKeyStyle%20=%20%7B%20style:%20'color:%20#777'%20%7D;%0A%09var%20alteredValueKeyStyle%20=%20%7B%20style:%20'color:%20#881391;%20font-weight:%20bolder'%20%7D;%0A%09var%20inlineValuesStyle%20=%20%7B%20style:%20'color:%20#777;%20font-style:%20italic'%20%7D;%0A%09var%20nullStyle%20=%20%7B%20style:%20'color:%20#777'%20%7D;%0A%0A%09function%20isRecord(record)%20%7B%0A%09%20%20//%20can't%20use%20this%20because%20value%20of%20Immutable.Record%20will%20depend%20on%20Immutable%20instance%0A%09%20%20//return%20record%20instanceof%20Immutable.Record%0A%09%20%20return%20record._defaultValues%20!==%20undefined;%0A%09%7D%0A%09exports.isRecord%20=%20isRecord;%0A%09function%20createFormatter()%20%7B%0A%0A%09%20%20var%20reference%20=%20function%20reference(object,%20config)%20%7B%0A%09%20%20%20%20if%20(typeof%20object%20===%20'undefined')%20return%20%5B'span',%20nullStyle,%20'undefined'%5D;else%20if%20(object%20===%20'null')%20return%20%5B'span',%20nullStyle,%20'null'%5D;%0A%0A%09%20%20%20%20return%20%5B'object',%20%7B%20object:%20object,%20config:%20config%20%7D%5D;%0A%09%20%20%7D;%0A%0A%09%20%20var%20renderIterableHeader%20=%20function%20renderIterableHeader(iterable)%20%7B%0A%09%20%20%20%20var%20name%20=%20arguments.length%20%3C=%201%20%7C%7C%20arguments%5B1%5D%20===%20undefined%20?%20'Iterable'%20:%20arguments%5B1%5D;%0A%09%20%20%20%20return%20%5B'span',%20%5B'span',%20immutableNameStyle,%20name%5D,%20%5B'span',%20'%5B'%20+%20iterable.size%20+%20'%5D'%5D%5D;%0A%09%20%20%7D;%0A%0A%09%20%20var%20hasBody%20=%20function%20hasBody(collection,%20config)%20%7B%0A%09%20%20%20%20return%20collection.size%20%3E%200%20&&%20!(config%20&&%20config.noPreview);%0A%09%20%20%7D;%0A%0A%09%20%20var%20renderIterableBody%20=%20function%20renderIterableBody(collection,%20mapper)%20%7B%0A%09%20%20%20%20var%20options%20=%20arguments.length%20%3C=%202%20%7C%7C%20arguments%5B2%5D%20===%20undefined%20?%20%7B%7D%20:%20arguments%5B2%5D;%0A%0A%09%20%20%20%20if%20(options.sorted)%20%7B%0A%09%20%20%20%20%20%20collection%20=%20collection.sortBy(function%20(value,%20key)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20key;%0A%09%20%20%20%20%20%20%7D);%0A%09%20%20%20%20%7D%0A%09%20%20%20%20var%20children%20=%20collection.map(mapper).toList().toJS();%0A%09%20%20%20%20return%20%5B'ol',%20listStyle%5D.concat(_toConsumableArray(children));%0A%09%20%20%7D;%0A%0A%09%20%20var%20RecordFormatter%20=%20%7B%0A%09%20%20%20%20header:%20function%20header(record,%20config)%20%7B%0A%09%20%20%20%20%20%20if%20(!isRecord(record))%20return%20null;%0A%0A%09%20%20%20%20%20%20var%20defaults%20=%20record.clear();%0A%09%20%20%20%20%20%20var%20changed%20=%20!_immutable2.default.is(defaults,%20record);%0A%0A%09%20%20%20%20%20%20if%20(config%20&&%20config.noPreview)%20return%20%5B'span',%20changed%20?%20immutableNameStyle%20:%20nullStyle,%20record._name%20%7C%7C%20record.constructor.name%20%7C%7C%20'Record'%5D;%0A%0A%09%20%20%20%20%20%20var%20inlinePreview%20=%20void%200;%0A%09%20%20%20%20%20%20if%20(!changed)%20%7B%0A%09%20%20%20%20%20%20%20%20inlinePreview%20=%20%5B'span',%20inlineValuesStyle,%20'%7B%7D'%5D;%0A%09%20%20%20%20%20%20%7D%20else%20%7B%0A%09%20%20%20%20%20%20%20%20var%20preview%20=%20record.keySeq().reduce(function%20(preview,%20key)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20if%20(_immutable2.default.is(defaults.get(key),%20record.get(key)))%20return%20preview;%0A%09%20%20%20%20%20%20%20%20%20%20if%20(preview.length)%20preview.push(',%20');%0A%0A%09%20%20%20%20%20%20%20%20%20%20preview.push(%5B'span',%20%7B%7D,%20%5B'span',%20keyStyle,%20key%20+%20':%20'%5D,%20reference(record.get(key),%20%7B%20noPreview:%20true%20%7D)%5D);%0A%09%20%20%20%20%20%20%20%20%20%20return%20preview;%0A%09%20%20%20%20%20%20%20%20%7D,%20%5B%5D);%0A%09%20%20%20%20%20%20%20%20inlinePreview%20=%20%5B'span',%20inlineValuesStyle,%20'%7B'%5D.concat(_toConsumableArray(preview),%20%5B'%7D'%5D);%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20%5B'span',%20%7B%7D,%20%5B'span',%20immutableNameStyle,%20record._name%20%7C%7C%20record.constructor.name%20%7C%7C%20'Record'%5D,%20'%20',%20inlinePreview%5D;%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20hasBody:%20hasBody,%0A%09%20%20%20%20body:%20function%20body(record)%20%7B%0A%09%20%20%20%20%20%20var%20defaults%20=%20record.clear();%0A%09%20%20%20%20%20%20var%20children%20=%20record.keySeq().map(function%20(key)%20%7B%0A%09%20%20%20%20%20%20%20%20var%20style%20=%20_immutable2.default.is(defaults.get(key),%20record.get(key))%20?%20defaultValueKeyStyle%20:%20alteredValueKeyStyle;%0A%09%20%20%20%20%20%20%20%20return%20%5B'li',%20%7B%7D,%20%5B'span',%20style,%20key%20+%20':%20'%5D,%20reference(record.get(key))%5D;%0A%09%20%20%20%20%20%20%7D).toJS();%0A%09%20%20%20%20%20%20return%20%5B'ol',%20listStyle%5D.concat(_toConsumableArray(children));%0A%09%20%20%20%20%7D%0A%09%20%20%7D;%0A%0A%09%20%20var%20ListFormatter%20=%20%7B%0A%09%20%20%20%20header:%20function%20header(o)%20%7B%0A%09%20%20%20%20%20%20if%20(!_immutable2.default.List.isList(o))%20return%20null;%0A%09%20%20%20%20%20%20return%20renderIterableHeader(o,%20'List');%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20hasBody:%20hasBody,%0A%09%20%20%20%20body:%20function%20body(o)%20%7B%0A%09%20%20%20%20%20%20return%20renderIterableBody(o,%20function%20(value,%20key)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20%5B'li',%20%5B'span',%20keyStyle,%20key%20+%20':%20'%5D,%20reference(value)%5D;%0A%09%20%20%20%20%20%20%7D);%0A%09%20%20%20%20%7D%0A%09%20%20%7D;%0A%0A%09%20%20var%20StackFormatter%20=%20%7B%0A%09%20%20%20%20header:%20function%20header(o)%20%7B%0A%09%20%20%20%20%20%20if%20(!_immutable2.default.Stack.isStack(o))%20return%20null;%0A%09%20%20%20%20%20%20return%20renderIterableHeader(o,%20'Stack');%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20hasBody:%20hasBody,%0A%09%20%20%20%20body:%20function%20body(o)%20%7B%0A%09%20%20%20%20%20%20return%20renderIterableBody(o,%20function%20(value,%20key)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20%5B'li',%20%5B'span',%20keyStyle,%20key%20+%20':%20'%5D,%20reference(value)%5D;%0A%09%20%20%20%20%20%20%7D);%0A%09%20%20%20%20%7D%0A%09%20%20%7D;%0A%0A%09%20%20var%20MapFormatter%20=%20%7B%0A%09%20%20%20%20header:%20function%20header(o)%20%7B%0A%09%20%20%20%20%20%20if%20(!_immutable2.default.Map.isMap(o))%20return%20null;%0A%09%20%20%20%20%20%20return%20renderIterableHeader(o,%20'Map');%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20hasBody:%20hasBody,%0A%09%20%20%20%20body:%20function%20body(o)%20%7B%0A%09%20%20%20%20%20%20return%20renderIterableBody(o,%20function%20(value,%20key)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20%5B'li',%20%7B%7D,%20'%7B',%20reference(key),%20'%20=%3E%20',%20reference(value),%20'%7D'%5D;%0A%09%20%20%20%20%20%20%7D,%20%7B%20sorted:%20true%20%7D);%0A%09%20%20%20%20%7D%0A%09%20%20%7D;%0A%0A%09%20%20var%20OrderedMapFormatter%20=%20%7B%0A%09%20%20%20%20header:%20function%20header(o)%20%7B%0A%09%20%20%20%20%20%20if%20(!_immutable2.default.OrderedMap.isOrderedMap(o))%20return%20null;%0A%09%20%20%20%20%20%20return%20renderIterableHeader(o,%20'OrderedMap');%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20hasBody:%20hasBody,%0A%09%20%20%20%20body:%20function%20body(o)%20%7B%0A%09%20%20%20%20%20%20return%20renderIterableBody(o,%20function%20(value,%20key)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20%5B'li',%20%7B%7D,%20'%7B',%20reference(key),%20'%20=%3E%20',%20reference(value),%20'%7D'%5D;%0A%09%20%20%20%20%20%20%7D);%0A%09%20%20%20%20%7D%0A%09%20%20%7D;%0A%0A%09%20%20var%20SetFormatter%20=%20%7B%0A%09%20%20%20%20header:%20function%20header(o)%20%7B%0A%09%20%20%20%20%20%20if%20(!_immutable2.default.Set.isSet(o))%20return%20null;%0A%09%20%20%20%20%20%20return%20renderIterableHeader(o,%20'Set');%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20hasBody:%20hasBody,%0A%09%20%20%20%20body:%20function%20body(o)%20%7B%0A%09%20%20%20%20%20%20return%20renderIterableBody(o,%20function%20(value)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20%5B'li',%20reference(value)%5D;%0A%09%20%20%20%20%20%20%7D,%20%7B%20sorted:%20true%20%7D);%0A%09%20%20%20%20%7D%0A%09%20%20%7D;%0A%0A%09%20%20var%20OrderedSetFormatter%20=%20%7B%0A%09%20%20%20%20header:%20function%20header(o)%20%7B%0A%09%20%20%20%20%20%20if%20(!_immutable2.default.OrderedSet.isOrderedSet(o))%20return%20null;%0A%09%20%20%20%20%20%20return%20renderIterableHeader(o,%20'OrderedSet');%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20hasBody:%20hasBody,%0A%09%20%20%20%20body:%20function%20body(o)%20%7B%0A%09%20%20%20%20%20%20return%20renderIterableBody(o,%20function%20(value)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20%5B'li',%20reference(value)%5D;%0A%09%20%20%20%20%20%20%7D);%0A%09%20%20%20%20%7D%0A%09%20%20%7D;%0A%0A%09%20%20return%20%7B%0A%09%20%20%20%20RecordFormatter:%20RecordFormatter,%0A%09%20%20%20%20OrderedMapFormatter:%20OrderedMapFormatter,%0A%09%20%20%20%20OrderedSetFormatter:%20OrderedSetFormatter,%0A%09%20%20%20%20ListFormatter:%20ListFormatter,%0A%09%20%20%20%20MapFormatter:%20MapFormatter,%0A%09%20%20%20%20SetFormatter:%20SetFormatter,%0A%09%20%20%20%20StackFormatter:%20StackFormatter%0A%09%20%20%7D;%0A%09%7D%0A%0A/***/%20%7D,%0A/*%203%20*/%0A/***/%20function(module,%20exports,%20__webpack_require__)%20%7B%0A%0A%09/**%0A%09%20*%20%20Copyright%20(c)%202014-2015,%20Facebook,%20Inc.%0A%09%20*%20%20All%20rights%20reserved.%0A%09%20*%0A%09%20*%20%20This%20source%20code%20is%20licensed%20under%20the%20BSD-style%20license%20found%20in%20the%0A%09%20*%20%20LICENSE%20file%20in%20the%20root%20directory%20of%20this%20source%20tree.%20An%20additional%20grant%0A%09%20*%20%20of%20patent%20rights%20can%20be%20found%20in%20the%20PATENTS%20file%20in%20the%20same%20directory.%0A%09%20*/%0A%0A%09(function%20(global,%20factory)%20%7B%0A%09%20%20%20true%20?%20module.exports%20=%20factory()%20:%0A%09%20%20typeof%20define%20===%20'function'%20&&%20define.amd%20?%20define(factory)%20:%0A%09%20%20global.Immutable%20=%20factory();%0A%09%7D(this,%20function%20()%20%7B%20'use%20strict';var%20SLICE$0%20=%20Array.prototype.slice;%0A%0A%09%20%20function%20createClass(ctor,%20superClass)%20%7B%0A%09%20%20%20%20if%20(superClass)%20%7B%0A%09%20%20%20%20%20%20ctor.prototype%20=%20Object.create(superClass.prototype);%0A%09%20%20%20%20%7D%0A%09%20%20%20%20ctor.prototype.constructor%20=%20ctor;%0A%09%20%20%7D%0A%0A%09%20%20function%20Iterable(value)%20%7B%0A%09%20%20%20%20%20%20return%20isIterable(value)%20?%20value%20:%20Seq(value);%0A%09%20%20%20%20%7D%0A%0A%0A%09%20%20createClass(KeyedIterable,%20Iterable);%0A%09%20%20%20%20function%20KeyedIterable(value)%20%7B%0A%09%20%20%20%20%20%20return%20isKeyed(value)%20?%20value%20:%20KeyedSeq(value);%0A%09%20%20%20%20%7D%0A%0A%0A%09%20%20createClass(IndexedIterable,%20Iterable);%0A%09%20%20%20%20function%20IndexedIterable(value)%20%7B%0A%09%20%20%20%20%20%20return%20isIndexed(value)%20?%20value%20:%20IndexedSeq(value);%0A%09%20%20%20%20%7D%0A%0A%0A%09%20%20createClass(SetIterable,%20Iterable);%0A%09%20%20%20%20function%20SetIterable(value)%20%7B%0A%09%20%20%20%20%20%20return%20isIterable(value)%20&&%20!isAssociative(value)%20?%20value%20:%20SetSeq(value);%0A%09%20%20%20%20%7D%0A%0A%0A%0A%09%20%20function%20isIterable(maybeIterable)%20%7B%0A%09%20%20%20%20return%20!!(maybeIterable%20&&%20maybeIterable%5BIS_ITERABLE_SENTINEL%5D);%0A%09%20%20%7D%0A%0A%09%20%20function%20isKeyed(maybeKeyed)%20%7B%0A%09%20%20%20%20return%20!!(maybeKeyed%20&&%20maybeKeyed%5BIS_KEYED_SENTINEL%5D);%0A%09%20%20%7D%0A%0A%09%20%20function%20isIndexed(maybeIndexed)%20%7B%0A%09%20%20%20%20return%20!!(maybeIndexed%20&&%20maybeIndexed%5BIS_INDEXED_SENTINEL%5D);%0A%09%20%20%7D%0A%0A%09%20%20function%20isAssociative(maybeAssociative)%20%7B%0A%09%20%20%20%20return%20isKeyed(maybeAssociative)%20%7C%7C%20isIndexed(maybeAssociative);%0A%09%20%20%7D%0A%0A%09%20%20function%20isOrdered(maybeOrdered)%20%7B%0A%09%20%20%20%20return%20!!(maybeOrdered%20&&%20maybeOrdered%5BIS_ORDERED_SENTINEL%5D);%0A%09%20%20%7D%0A%0A%09%20%20Iterable.isIterable%20=%20isIterable;%0A%09%20%20Iterable.isKeyed%20=%20isKeyed;%0A%09%20%20Iterable.isIndexed%20=%20isIndexed;%0A%09%20%20Iterable.isAssociative%20=%20isAssociative;%0A%09%20%20Iterable.isOrdered%20=%20isOrdered;%0A%0A%09%20%20Iterable.Keyed%20=%20KeyedIterable;%0A%09%20%20Iterable.Indexed%20=%20IndexedIterable;%0A%09%20%20Iterable.Set%20=%20SetIterable;%0A%0A%0A%09%20%20var%20IS_ITERABLE_SENTINEL%20=%20'@@__IMMUTABLE_ITERABLE__@@';%0A%09%20%20var%20IS_KEYED_SENTINEL%20=%20'@@__IMMUTABLE_KEYED__@@';%0A%09%20%20var%20IS_INDEXED_SENTINEL%20=%20'@@__IMMUTABLE_INDEXED__@@';%0A%09%20%20var%20IS_ORDERED_SENTINEL%20=%20'@@__IMMUTABLE_ORDERED__@@';%0A%0A%09%20%20//%20Used%20for%20setting%20prototype%20methods%20that%20IE8%20chokes%20on.%0A%09%20%20var%20DELETE%20=%20'delete';%0A%0A%09%20%20//%20Constants%20describing%20the%20size%20of%20trie%20nodes.%0A%09%20%20var%20SHIFT%20=%205;%20//%20Resulted%20in%20best%20performance%20after%20______?%0A%09%20%20var%20SIZE%20=%201%20%3C%3C%20SHIFT;%0A%09%20%20var%20MASK%20=%20SIZE%20-%201;%0A%0A%09%20%20//%20A%20consistent%20shared%20value%20representing%20%22not%20set%22%20which%20equals%20nothing%20other%0A%09%20%20//%20than%20itself,%20and%20nothing%20that%20could%20be%20provided%20externally.%0A%09%20%20var%20NOT_SET%20=%20%7B%7D;%0A%0A%09%20%20//%20Boolean%20references,%20Rough%20equivalent%20of%20%60bool%20&%60.%0A%09%20%20var%20CHANGE_LENGTH%20=%20%7B%20value:%20false%20%7D;%0A%09%20%20var%20DID_ALTER%20=%20%7B%20value:%20false%20%7D;%0A%0A%09%20%20function%20MakeRef(ref)%20%7B%0A%09%20%20%20%20ref.value%20=%20false;%0A%09%20%20%20%20return%20ref;%0A%09%20%20%7D%0A%0A%09%20%20function%20SetRef(ref)%20%7B%0A%09%20%20%20%20ref%20&&%20(ref.value%20=%20true);%0A%09%20%20%7D%0A%0A%09%20%20//%20A%20function%20which%20returns%20a%20value%20representing%20an%20%22owner%22%20for%20transient%20writes%0A%09%20%20//%20to%20tries.%20The%20return%20value%20will%20only%20ever%20equal%20itself,%20and%20will%20not%20equal%0A%09%20%20//%20the%20return%20of%20any%20subsequent%20call%20of%20this%20function.%0A%09%20%20function%20OwnerID()%20%7B%7D%0A%0A%09%20%20//%20http://jsperf.com/copy-array-inline%0A%09%20%20function%20arrCopy(arr,%20offset)%20%7B%0A%09%20%20%20%20offset%20=%20offset%20%7C%7C%200;%0A%09%20%20%20%20var%20len%20=%20Math.max(0,%20arr.length%20-%20offset);%0A%09%20%20%20%20var%20newArr%20=%20new%20Array(len);%0A%09%20%20%20%20for%20(var%20ii%20=%200;%20ii%20%3C%20len;%20ii++)%20%7B%0A%09%20%20%20%20%20%20newArr%5Bii%5D%20=%20arr%5Bii%20+%20offset%5D;%0A%09%20%20%20%20%7D%0A%09%20%20%20%20return%20newArr;%0A%09%20%20%7D%0A%0A%09%20%20function%20ensureSize(iter)%20%7B%0A%09%20%20%20%20if%20(iter.size%20===%20undefined)%20%7B%0A%09%20%20%20%20%20%20iter.size%20=%20iter.__iterate(returnTrue);%0A%09%20%20%20%20%7D%0A%09%20%20%20%20return%20iter.size;%0A%09%20%20%7D%0A%0A%09%20%20function%20wrapIndex(iter,%20index)%20%7B%0A%09%20%20%20%20//%20This%20implements%20%22is%20array%20index%22%20which%20the%20ECMAString%20spec%20defines%20as:%0A%09%20%20%20%20//%0A%09%20%20%20%20//%20%20%20%20%20A%20String%20property%20name%20P%20is%20an%20array%20index%20if%20and%20only%20if%0A%09%20%20%20%20//%20%20%20%20%20ToString(ToUint32(P))%20is%20equal%20to%20P%20and%20ToUint32(P)%20is%20not%20equal%0A%09%20%20%20%20//%20%20%20%20%20to%202%5E32%E2%88%921.%0A%09%20%20%20%20//%0A%09%20%20%20%20//%20http://www.ecma-international.org/ecma-262/6.0/#sec-array-exotic-objects%0A%09%20%20%20%20if%20(typeof%20index%20!==%20'number')%20%7B%0A%09%20%20%20%20%20%20var%20uint32Index%20=%20index%20%3E%3E%3E%200;%20//%20N%20%3E%3E%3E%200%20is%20shorthand%20for%20ToUint32%0A%09%20%20%20%20%20%20if%20(''%20+%20uint32Index%20!==%20index%20%7C%7C%20uint32Index%20===%204294967295)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20NaN;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20index%20=%20uint32Index;%0A%09%20%20%20%20%7D%0A%09%20%20%20%20return%20index%20%3C%200%20?%20ensureSize(iter)%20+%20index%20:%20index;%0A%09%20%20%7D%0A%0A%09%20%20function%20returnTrue()%20%7B%0A%09%20%20%20%20return%20true;%0A%09%20%20%7D%0A%0A%09%20%20function%20wholeSlice(begin,%20end,%20size)%20%7B%0A%09%20%20%20%20return%20(begin%20===%200%20%7C%7C%20(size%20!==%20undefined%20&&%20begin%20%3C=%20-size))%20&&%0A%09%20%20%20%20%20%20(end%20===%20undefined%20%7C%7C%20(size%20!==%20undefined%20&&%20end%20%3E=%20size));%0A%09%20%20%7D%0A%0A%09%20%20function%20resolveBegin(begin,%20size)%20%7B%0A%09%20%20%20%20return%20resolveIndex(begin,%20size,%200);%0A%09%20%20%7D%0A%0A%09%20%20function%20resolveEnd(end,%20size)%20%7B%0A%09%20%20%20%20return%20resolveIndex(end,%20size,%20size);%0A%09%20%20%7D%0A%0A%09%20%20function%20resolveIndex(index,%20size,%20defaultIndex)%20%7B%0A%09%20%20%20%20return%20index%20===%20undefined%20?%0A%09%20%20%20%20%20%20defaultIndex%20:%0A%09%20%20%20%20%20%20index%20%3C%200%20?%0A%09%20%20%20%20%20%20%20%20Math.max(0,%20size%20+%20index)%20:%0A%09%20%20%20%20%20%20%20%20size%20===%20undefined%20?%0A%09%20%20%20%20%20%20%20%20%20%20index%20:%0A%09%20%20%20%20%20%20%20%20%20%20Math.min(size,%20index);%0A%09%20%20%7D%0A%0A%09%20%20/*%20global%20Symbol%20*/%0A%0A%09%20%20var%20ITERATE_KEYS%20=%200;%0A%09%20%20var%20ITERATE_VALUES%20=%201;%0A%09%20%20var%20ITERATE_ENTRIES%20=%202;%0A%0A%09%20%20var%20REAL_ITERATOR_SYMBOL%20=%20typeof%20Symbol%20===%20'function'%20&&%20Symbol.iterator;%0A%09%20%20var%20FAUX_ITERATOR_SYMBOL%20=%20'@@iterator';%0A%0A%09%20%20var%20ITERATOR_SYMBOL%20=%20REAL_ITERATOR_SYMBOL%20%7C%7C%20FAUX_ITERATOR_SYMBOL;%0A%0A%0A%09%20%20function%20Iterator(next)%20%7B%0A%09%20%20%20%20%20%20this.next%20=%20next;%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20Iterator.prototype.toString%20=%20function()%20%7B%0A%09%20%20%20%20%20%20return%20'%5BIterator%5D';%0A%09%20%20%20%20%7D;%0A%0A%0A%09%20%20Iterator.KEYS%20=%20ITERATE_KEYS;%0A%09%20%20Iterator.VALUES%20=%20ITERATE_VALUES;%0A%09%20%20Iterator.ENTRIES%20=%20ITERATE_ENTRIES;%0A%0A%09%20%20Iterator.prototype.inspect%20=%0A%09%20%20Iterator.prototype.toSource%20=%20function%20()%20%7B%20return%20this.toString();%20%7D%0A%09%20%20Iterator.prototype%5BITERATOR_SYMBOL%5D%20=%20function%20()%20%7B%0A%09%20%20%20%20return%20this;%0A%09%20%20%7D;%0A%0A%0A%09%20%20function%20iteratorValue(type,%20k,%20v,%20iteratorResult)%20%7B%0A%09%20%20%20%20var%20value%20=%20type%20===%200%20?%20k%20:%20type%20===%201%20?%20v%20:%20%5Bk,%20v%5D;%0A%09%20%20%20%20iteratorResult%20?%20(iteratorResult.value%20=%20value)%20:%20(iteratorResult%20=%20%7B%0A%09%20%20%20%20%20%20value:%20value,%20done:%20false%0A%09%20%20%20%20%7D);%0A%09%20%20%20%20return%20iteratorResult;%0A%09%20%20%7D%0A%0A%09%20%20function%20iteratorDone()%20%7B%0A%09%20%20%20%20return%20%7B%20value:%20undefined,%20done:%20true%20%7D;%0A%09%20%20%7D%0A%0A%09%20%20function%20hasIterator(maybeIterable)%20%7B%0A%09%20%20%20%20return%20!!getIteratorFn(maybeIterable);%0A%09%20%20%7D%0A%0A%09%20%20function%20isIterator(maybeIterator)%20%7B%0A%09%20%20%20%20return%20maybeIterator%20&&%20typeof%20maybeIterator.next%20===%20'function';%0A%09%20%20%7D%0A%0A%09%20%20function%20getIterator(iterable)%20%7B%0A%09%20%20%20%20var%20iteratorFn%20=%20getIteratorFn(iterable);%0A%09%20%20%20%20return%20iteratorFn%20&&%20iteratorFn.call(iterable);%0A%09%20%20%7D%0A%0A%09%20%20function%20getIteratorFn(iterable)%20%7B%0A%09%20%20%20%20var%20iteratorFn%20=%20iterable%20&&%20(%0A%09%20%20%20%20%20%20(REAL_ITERATOR_SYMBOL%20&&%20iterable%5BREAL_ITERATOR_SYMBOL%5D)%20%7C%7C%0A%09%20%20%20%20%20%20iterable%5BFAUX_ITERATOR_SYMBOL%5D%0A%09%20%20%20%20);%0A%09%20%20%20%20if%20(typeof%20iteratorFn%20===%20'function')%20%7B%0A%09%20%20%20%20%20%20return%20iteratorFn;%0A%09%20%20%20%20%7D%0A%09%20%20%7D%0A%0A%09%20%20function%20isArrayLike(value)%20%7B%0A%09%20%20%20%20return%20value%20&&%20typeof%20value.length%20===%20'number';%0A%09%20%20%7D%0A%0A%09%20%20createClass(Seq,%20Iterable);%0A%09%20%20%20%20function%20Seq(value)%20%7B%0A%09%20%20%20%20%20%20return%20value%20===%20null%20%7C%7C%20value%20===%20undefined%20?%20emptySequence()%20:%0A%09%20%20%20%20%20%20%20%20isIterable(value)%20?%20value.toSeq()%20:%20seqFromValue(value);%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20Seq.of%20=%20function(/*...values*/)%20%7B%0A%09%20%20%20%20%20%20return%20Seq(arguments);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Seq.prototype.toSeq%20=%20function()%20%7B%0A%09%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Seq.prototype.toString%20=%20function()%20%7B%0A%09%20%20%20%20%20%20return%20this.__toString('Seq%20%7B',%20'%7D');%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Seq.prototype.cacheResult%20=%20function()%20%7B%0A%09%20%20%20%20%20%20if%20(!this._cache%20&&%20this.__iterateUncached)%20%7B%0A%09%20%20%20%20%20%20%20%20this._cache%20=%20this.entrySeq().toArray();%0A%09%20%20%20%20%20%20%20%20this.size%20=%20this._cache.length;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20//%20abstract%20__iterateUncached(fn,%20reverse)%0A%0A%09%20%20%20%20Seq.prototype.__iterate%20=%20function(fn,%20reverse)%20%7B%0A%09%20%20%20%20%20%20return%20seqIterate(this,%20fn,%20reverse,%20true);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20//%20abstract%20__iteratorUncached(type,%20reverse)%0A%0A%09%20%20%20%20Seq.prototype.__iterator%20=%20function(type,%20reverse)%20%7B%0A%09%20%20%20%20%20%20return%20seqIterator(this,%20type,%20reverse,%20true);%0A%09%20%20%20%20%7D;%0A%0A%0A%0A%09%20%20createClass(KeyedSeq,%20Seq);%0A%09%20%20%20%20function%20KeyedSeq(value)%20%7B%0A%09%20%20%20%20%20%20return%20value%20===%20null%20%7C%7C%20value%20===%20undefined%20?%0A%09%20%20%20%20%20%20%20%20emptySequence().toKeyedSeq()%20:%0A%09%20%20%20%20%20%20%20%20isIterable(value)%20?%0A%09%20%20%20%20%20%20%20%20%20%20(isKeyed(value)%20?%20value.toSeq()%20:%20value.fromEntrySeq())%20:%0A%09%20%20%20%20%20%20%20%20%20%20keyedSeqFromValue(value);%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20KeyedSeq.prototype.toKeyedSeq%20=%20function()%20%7B%0A%09%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%7D;%0A%0A%0A%0A%09%20%20createClass(IndexedSeq,%20Seq);%0A%09%20%20%20%20function%20IndexedSeq(value)%20%7B%0A%09%20%20%20%20%20%20return%20value%20===%20null%20%7C%7C%20value%20===%20undefined%20?%20emptySequence()%20:%0A%09%20%20%20%20%20%20%20%20!isIterable(value)%20?%20indexedSeqFromValue(value)%20:%0A%09%20%20%20%20%20%20%20%20isKeyed(value)%20?%20value.entrySeq()%20:%20value.toIndexedSeq();%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20IndexedSeq.of%20=%20function(/*...values*/)%20%7B%0A%09%20%20%20%20%20%20return%20IndexedSeq(arguments);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20IndexedSeq.prototype.toIndexedSeq%20=%20function()%20%7B%0A%09%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20IndexedSeq.prototype.toString%20=%20function()%20%7B%0A%09%20%20%20%20%20%20return%20this.__toString('Seq%20%5B',%20'%5D');%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20IndexedSeq.prototype.__iterate%20=%20function(fn,%20reverse)%20%7B%0A%09%20%20%20%20%20%20return%20seqIterate(this,%20fn,%20reverse,%20false);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20IndexedSeq.prototype.__iterator%20=%20function(type,%20reverse)%20%7B%0A%09%20%20%20%20%20%20return%20seqIterator(this,%20type,%20reverse,%20false);%0A%09%20%20%20%20%7D;%0A%0A%0A%0A%09%20%20createClass(SetSeq,%20Seq);%0A%09%20%20%20%20function%20SetSeq(value)%20%7B%0A%09%20%20%20%20%20%20return%20(%0A%09%20%20%20%20%20%20%20%20value%20===%20null%20%7C%7C%20value%20===%20undefined%20?%20emptySequence()%20:%0A%09%20%20%20%20%20%20%20%20!isIterable(value)%20?%20indexedSeqFromValue(value)%20:%0A%09%20%20%20%20%20%20%20%20isKeyed(value)%20?%20value.entrySeq()%20:%20value%0A%09%20%20%20%20%20%20).toSetSeq();%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20SetSeq.of%20=%20function(/*...values*/)%20%7B%0A%09%20%20%20%20%20%20return%20SetSeq(arguments);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20SetSeq.prototype.toSetSeq%20=%20function()%20%7B%0A%09%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%7D;%0A%0A%0A%0A%09%20%20Seq.isSeq%20=%20isSeq;%0A%09%20%20Seq.Keyed%20=%20KeyedSeq;%0A%09%20%20Seq.Set%20=%20SetSeq;%0A%09%20%20Seq.Indexed%20=%20IndexedSeq;%0A%0A%09%20%20var%20IS_SEQ_SENTINEL%20=%20'@@__IMMUTABLE_SEQ__@@';%0A%0A%09%20%20Seq.prototype%5BIS_SEQ_SENTINEL%5D%20=%20true;%0A%0A%0A%0A%09%20%20createClass(ArraySeq,%20IndexedSeq);%0A%09%20%20%20%20function%20ArraySeq(array)%20%7B%0A%09%20%20%20%20%20%20this._array%20=%20array;%0A%09%20%20%20%20%20%20this.size%20=%20array.length;%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20ArraySeq.prototype.get%20=%20function(index,%20notSetValue)%20%7B%0A%09%20%20%20%20%20%20return%20this.has(index)%20?%20this._array%5BwrapIndex(this,%20index)%5D%20:%20notSetValue;%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20ArraySeq.prototype.__iterate%20=%20function(fn,%20reverse)%20%7B%0A%09%20%20%20%20%20%20var%20array%20=%20this._array;%0A%09%20%20%20%20%20%20var%20maxIndex%20=%20array.length%20-%201;%0A%09%20%20%20%20%20%20for%20(var%20ii%20=%200;%20ii%20%3C=%20maxIndex;%20ii++)%20%7B%0A%09%20%20%20%20%20%20%20%20if%20(fn(array%5Breverse%20?%20maxIndex%20-%20ii%20:%20ii%5D,%20ii,%20this)%20===%20false)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20return%20ii%20+%201;%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20ii;%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20ArraySeq.prototype.__iterator%20=%20function(type,%20reverse)%20%7B%0A%09%20%20%20%20%20%20var%20array%20=%20this._array;%0A%09%20%20%20%20%20%20var%20maxIndex%20=%20array.length%20-%201;%0A%09%20%20%20%20%20%20var%20ii%20=%200;%0A%09%20%20%20%20%20%20return%20new%20Iterator(function()%20%0A%09%20%20%20%20%20%20%20%20%7Breturn%20ii%20%3E%20maxIndex%20?%0A%09%20%20%20%20%20%20%20%20%20%20iteratorDone()%20:%0A%09%20%20%20%20%20%20%20%20%20%20iteratorValue(type,%20ii,%20array%5Breverse%20?%20maxIndex%20-%20ii++%20:%20ii++%5D)%7D%0A%09%20%20%20%20%20%20);%0A%09%20%20%20%20%7D;%0A%0A%0A%0A%09%20%20createClass(ObjectSeq,%20KeyedSeq);%0A%09%20%20%20%20function%20ObjectSeq(object)%20%7B%0A%09%20%20%20%20%20%20var%20keys%20=%20Object.keys(object);%0A%09%20%20%20%20%20%20this._object%20=%20object;%0A%09%20%20%20%20%20%20this._keys%20=%20keys;%0A%09%20%20%20%20%20%20this.size%20=%20keys.length;%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20ObjectSeq.prototype.get%20=%20function(key,%20notSetValue)%20%7B%0A%09%20%20%20%20%20%20if%20(notSetValue%20!==%20undefined%20&&%20!this.has(key))%20%7B%0A%09%20%20%20%20%20%20%20%20return%20notSetValue;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20this._object%5Bkey%5D;%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20ObjectSeq.prototype.has%20=%20function(key)%20%7B%0A%09%20%20%20%20%20%20return%20this._object.hasOwnProperty(key);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20ObjectSeq.prototype.__iterate%20=%20function(fn,%20reverse)%20%7B%0A%09%20%20%20%20%20%20var%20object%20=%20this._object;%0A%09%20%20%20%20%20%20var%20keys%20=%20this._keys;%0A%09%20%20%20%20%20%20var%20maxIndex%20=%20keys.length%20-%201;%0A%09%20%20%20%20%20%20for%20(var%20ii%20=%200;%20ii%20%3C=%20maxIndex;%20ii++)%20%7B%0A%09%20%20%20%20%20%20%20%20var%20key%20=%20keys%5Breverse%20?%20maxIndex%20-%20ii%20:%20ii%5D;%0A%09%20%20%20%20%20%20%20%20if%20(fn(object%5Bkey%5D,%20key,%20this)%20===%20false)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20return%20ii%20+%201;%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20ii;%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20ObjectSeq.prototype.__iterator%20=%20function(type,%20reverse)%20%7B%0A%09%20%20%20%20%20%20var%20object%20=%20this._object;%0A%09%20%20%20%20%20%20var%20keys%20=%20this._keys;%0A%09%20%20%20%20%20%20var%20maxIndex%20=%20keys.length%20-%201;%0A%09%20%20%20%20%20%20var%20ii%20=%200;%0A%09%20%20%20%20%20%20return%20new%20Iterator(function()%20%20%7B%0A%09%20%20%20%20%20%20%20%20var%20key%20=%20keys%5Breverse%20?%20maxIndex%20-%20ii%20:%20ii%5D;%0A%09%20%20%20%20%20%20%20%20return%20ii++%20%3E%20maxIndex%20?%0A%09%20%20%20%20%20%20%20%20%20%20iteratorDone()%20:%0A%09%20%20%20%20%20%20%20%20%20%20iteratorValue(type,%20key,%20object%5Bkey%5D);%0A%09%20%20%20%20%20%20%7D);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20ObjectSeq.prototype%5BIS_ORDERED_SENTINEL%5D%20=%20true;%0A%0A%0A%09%20%20createClass(IterableSeq,%20IndexedSeq);%0A%09%20%20%20%20function%20IterableSeq(iterable)%20%7B%0A%09%20%20%20%20%20%20this._iterable%20=%20iterable;%0A%09%20%20%20%20%20%20this.size%20=%20iterable.length%20%7C%7C%20iterable.size;%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20IterableSeq.prototype.__iterateUncached%20=%20function(fn,%20reverse)%20%7B%0A%09%20%20%20%20%20%20if%20(reverse)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this.cacheResult().__iterate(fn,%20reverse);%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20var%20iterable%20=%20this._iterable;%0A%09%20%20%20%20%20%20var%20iterator%20=%20getIterator(iterable);%0A%09%20%20%20%20%20%20var%20iterations%20=%200;%0A%09%20%20%20%20%20%20if%20(isIterator(iterator))%20%7B%0A%09%20%20%20%20%20%20%20%20var%20step;%0A%09%20%20%20%20%20%20%20%20while%20(!(step%20=%20iterator.next()).done)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20if%20(fn(step.value,%20iterations++,%20this)%20===%20false)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20%20%20break;%0A%09%20%20%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20iterations;%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20IterableSeq.prototype.__iteratorUncached%20=%20function(type,%20reverse)%20%7B%0A%09%20%20%20%20%20%20if%20(reverse)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this.cacheResult().__iterator(type,%20reverse);%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20var%20iterable%20=%20this._iterable;%0A%09%20%20%20%20%20%20var%20iterator%20=%20getIterator(iterable);%0A%09%20%20%20%20%20%20if%20(!isIterator(iterator))%20%7B%0A%09%20%20%20%20%20%20%20%20return%20new%20Iterator(iteratorDone);%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20var%20iterations%20=%200;%0A%09%20%20%20%20%20%20return%20new%20Iterator(function()%20%20%7B%0A%09%20%20%20%20%20%20%20%20var%20step%20=%20iterator.next();%0A%09%20%20%20%20%20%20%20%20return%20step.done%20?%20step%20:%20iteratorValue(type,%20iterations++,%20step.value);%0A%09%20%20%20%20%20%20%7D);%0A%09%20%20%20%20%7D;%0A%0A%0A%0A%09%20%20createClass(IteratorSeq,%20IndexedSeq);%0A%09%20%20%20%20function%20IteratorSeq(iterator)%20%7B%0A%09%20%20%20%20%20%20this._iterator%20=%20iterator;%0A%09%20%20%20%20%20%20this._iteratorCache%20=%20%5B%5D;%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20IteratorSeq.prototype.__iterateUncached%20=%20function(fn,%20reverse)%20%7B%0A%09%20%20%20%20%20%20if%20(reverse)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this.cacheResult().__iterate(fn,%20reverse);%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20var%20iterator%20=%20this._iterator;%0A%09%20%20%20%20%20%20var%20cache%20=%20this._iteratorCache;%0A%09%20%20%20%20%20%20var%20iterations%20=%200;%0A%09%20%20%20%20%20%20while%20(iterations%20%3C%20cache.length)%20%7B%0A%09%20%20%20%20%20%20%20%20if%20(fn(cache%5Biterations%5D,%20iterations++,%20this)%20===%20false)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20return%20iterations;%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20var%20step;%0A%09%20%20%20%20%20%20while%20(!(step%20=%20iterator.next()).done)%20%7B%0A%09%20%20%20%20%20%20%20%20var%20val%20=%20step.value;%0A%09%20%20%20%20%20%20%20%20cache%5Biterations%5D%20=%20val;%0A%09%20%20%20%20%20%20%20%20if%20(fn(val,%20iterations++,%20this)%20===%20false)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20break;%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20iterations;%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20IteratorSeq.prototype.__iteratorUncached%20=%20function(type,%20reverse)%20%7B%0A%09%20%20%20%20%20%20if%20(reverse)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this.cacheResult().__iterator(type,%20reverse);%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20var%20iterator%20=%20this._iterator;%0A%09%20%20%20%20%20%20var%20cache%20=%20this._iteratorCache;%0A%09%20%20%20%20%20%20var%20iterations%20=%200;%0A%09%20%20%20%20%20%20return%20new%20Iterator(function()%20%20%7B%0A%09%20%20%20%20%20%20%20%20if%20(iterations%20%3E=%20cache.length)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20var%20step%20=%20iterator.next();%0A%09%20%20%20%20%20%20%20%20%20%20if%20(step.done)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20%20%20return%20step;%0A%09%20%20%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20%20%20cache%5Biterations%5D%20=%20step.value;%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20return%20iteratorValue(type,%20iterations,%20cache%5Biterations++%5D);%0A%09%20%20%20%20%20%20%7D);%0A%09%20%20%20%20%7D;%0A%0A%0A%0A%0A%09%20%20//%20#%20pragma%20Helper%20functions%0A%0A%09%20%20function%20isSeq(maybeSeq)%20%7B%0A%09%20%20%20%20return%20!!(maybeSeq%20&&%20maybeSeq%5BIS_SEQ_SENTINEL%5D);%0A%09%20%20%7D%0A%0A%09%20%20var%20EMPTY_SEQ;%0A%0A%09%20%20function%20emptySequence()%20%7B%0A%09%20%20%20%20return%20EMPTY_SEQ%20%7C%7C%20(EMPTY_SEQ%20=%20new%20ArraySeq(%5B%5D));%0A%09%20%20%7D%0A%0A%09%20%20function%20keyedSeqFromValue(value)%20%7B%0A%09%20%20%20%20var%20seq%20=%0A%09%20%20%20%20%20%20Array.isArray(value)%20?%20new%20ArraySeq(value).fromEntrySeq()%20:%0A%09%20%20%20%20%20%20isIterator(value)%20?%20new%20IteratorSeq(value).fromEntrySeq()%20:%0A%09%20%20%20%20%20%20hasIterator(value)%20?%20new%20IterableSeq(value).fromEntrySeq()%20:%0A%09%20%20%20%20%20%20typeof%20value%20===%20'object'%20?%20new%20ObjectSeq(value)%20:%0A%09%20%20%20%20%20%20undefined;%0A%09%20%20%20%20if%20(!seq)%20%7B%0A%09%20%20%20%20%20%20throw%20new%20TypeError(%0A%09%20%20%20%20%20%20%20%20'Expected%20Array%20or%20iterable%20object%20of%20%5Bk,%20v%5D%20entries,%20'+%0A%09%20%20%20%20%20%20%20%20'or%20keyed%20object:%20'%20+%20value%0A%09%20%20%20%20%20%20);%0A%09%20%20%20%20%7D%0A%09%20%20%20%20return%20seq;%0A%09%20%20%7D%0A%0A%09%20%20function%20indexedSeqFromValue(value)%20%7B%0A%09%20%20%20%20var%20seq%20=%20maybeIndexedSeqFromValue(value);%0A%09%20%20%20%20if%20(!seq)%20%7B%0A%09%20%20%20%20%20%20throw%20new%20TypeError(%0A%09%20%20%20%20%20%20%20%20'Expected%20Array%20or%20iterable%20object%20of%20values:%20'%20+%20value%0A%09%20%20%20%20%20%20);%0A%09%20%20%20%20%7D%0A%09%20%20%20%20return%20seq;%0A%09%20%20%7D%0A%0A%09%20%20function%20seqFromValue(value)%20%7B%0A%09%20%20%20%20var%20seq%20=%20maybeIndexedSeqFromValue(value)%20%7C%7C%0A%09%20%20%20%20%20%20(typeof%20value%20===%20'object'%20&&%20new%20ObjectSeq(value));%0A%09%20%20%20%20if%20(!seq)%20%7B%0A%09%20%20%20%20%20%20throw%20new%20TypeError(%0A%09%20%20%20%20%20%20%20%20'Expected%20Array%20or%20iterable%20object%20of%20values,%20or%20keyed%20object:%20'%20+%20value%0A%09%20%20%20%20%20%20);%0A%09%20%20%20%20%7D%0A%09%20%20%20%20return%20seq;%0A%09%20%20%7D%0A%0A%09%20%20function%20maybeIndexedSeqFromValue(value)%20%7B%0A%09%20%20%20%20return%20(%0A%09%20%20%20%20%20%20isArrayLike(value)%20?%20new%20ArraySeq(value)%20:%0A%09%20%20%20%20%20%20isIterator(value)%20?%20new%20IteratorSeq(value)%20:%0A%09%20%20%20%20%20%20hasIterator(value)%20?%20new%20IterableSeq(value)%20:%0A%09%20%20%20%20%20%20undefined%0A%09%20%20%20%20);%0A%09%20%20%7D%0A%0A%09%20%20function%20seqIterate(seq,%20fn,%20reverse,%20useKeys)%20%7B%0A%09%20%20%20%20var%20cache%20=%20seq._cache;%0A%09%20%20%20%20if%20(cache)%20%7B%0A%09%20%20%20%20%20%20var%20maxIndex%20=%20cache.length%20-%201;%0A%09%20%20%20%20%20%20for%20(var%20ii%20=%200;%20ii%20%3C=%20maxIndex;%20ii++)%20%7B%0A%09%20%20%20%20%20%20%20%20var%20entry%20=%20cache%5Breverse%20?%20maxIndex%20-%20ii%20:%20ii%5D;%0A%09%20%20%20%20%20%20%20%20if%20(fn(entry%5B1%5D,%20useKeys%20?%20entry%5B0%5D%20:%20ii,%20seq)%20===%20false)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20return%20ii%20+%201;%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20ii;%0A%09%20%20%20%20%7D%0A%09%20%20%20%20return%20seq.__iterateUncached(fn,%20reverse);%0A%09%20%20%7D%0A%0A%09%20%20function%20seqIterator(seq,%20type,%20reverse,%20useKeys)%20%7B%0A%09%20%20%20%20var%20cache%20=%20seq._cache;%0A%09%20%20%20%20if%20(cache)%20%7B%0A%09%20%20%20%20%20%20var%20maxIndex%20=%20cache.length%20-%201;%0A%09%20%20%20%20%20%20var%20ii%20=%200;%0A%09%20%20%20%20%20%20return%20new%20Iterator(function()%20%20%7B%0A%09%20%20%20%20%20%20%20%20var%20entry%20=%20cache%5Breverse%20?%20maxIndex%20-%20ii%20:%20ii%5D;%0A%09%20%20%20%20%20%20%20%20return%20ii++%20%3E%20maxIndex%20?%0A%09%20%20%20%20%20%20%20%20%20%20iteratorDone()%20:%0A%09%20%20%20%20%20%20%20%20%20%20iteratorValue(type,%20useKeys%20?%20entry%5B0%5D%20:%20ii%20-%201,%20entry%5B1%5D);%0A%09%20%20%20%20%20%20%7D);%0A%09%20%20%20%20%7D%0A%09%20%20%20%20return%20seq.__iteratorUncached(type,%20reverse);%0A%09%20%20%7D%0A%0A%09%20%20function%20fromJS(json,%20converter)%20%7B%0A%09%20%20%20%20return%20converter%20?%0A%09%20%20%20%20%20%20fromJSWith(converter,%20json,%20'',%20%7B'':%20json%7D)%20:%0A%09%20%20%20%20%20%20fromJSDefault(json);%0A%09%20%20%7D%0A%0A%09%20%20function%20fromJSWith(converter,%20json,%20key,%20parentJSON)%20%7B%0A%09%20%20%20%20if%20(Array.isArray(json))%20%7B%0A%09%20%20%20%20%20%20return%20converter.call(parentJSON,%20key,%20IndexedSeq(json).map(function(v,%20k)%20%20%7Breturn%20fromJSWith(converter,%20v,%20k,%20json)%7D));%0A%09%20%20%20%20%7D%0A%09%20%20%20%20if%20(isPlainObj(json))%20%7B%0A%09%20%20%20%20%20%20return%20converter.call(parentJSON,%20key,%20KeyedSeq(json).map(function(v,%20k)%20%20%7Breturn%20fromJSWith(converter,%20v,%20k,%20json)%7D));%0A%09%20%20%20%20%7D%0A%09%20%20%20%20return%20json;%0A%09%20%20%7D%0A%0A%09%20%20function%20fromJSDefault(json)%20%7B%0A%09%20%20%20%20if%20(Array.isArray(json))%20%7B%0A%09%20%20%20%20%20%20return%20IndexedSeq(json).map(fromJSDefault).toList();%0A%09%20%20%20%20%7D%0A%09%20%20%20%20if%20(isPlainObj(json))%20%7B%0A%09%20%20%20%20%20%20return%20KeyedSeq(json).map(fromJSDefault).toMap();%0A%09%20%20%20%20%7D%0A%09%20%20%20%20return%20json;%0A%09%20%20%7D%0A%0A%09%20%20function%20isPlainObj(value)%20%7B%0A%09%20%20%20%20return%20value%20&&%20(value.constructor%20===%20Object%20%7C%7C%20value.constructor%20===%20undefined);%0A%09%20%20%7D%0A%0A%09%20%20/**%0A%09%20%20%20*%20An%20extension%20of%20the%20%22same-value%22%20algorithm%20as%20%5Bdescribed%20for%20use%20by%20ES6%20Map%0A%09%20%20%20*%20and%20Set%5D(https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map#Key_equality)%0A%09%20%20%20*%0A%09%20%20%20*%20NaN%20is%20considered%20the%20same%20as%20NaN,%20however%20-0%20and%200%20are%20considered%20the%20same%0A%09%20%20%20*%20value,%20which%20is%20different%20from%20the%20algorithm%20described%20by%0A%09%20%20%20*%20%5B%60Object.is%60%5D(https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/is).%0A%09%20%20%20*%0A%09%20%20%20*%20This%20is%20extended%20further%20to%20allow%20Objects%20to%20describe%20the%20values%20they%0A%09%20%20%20*%20represent,%20by%20way%20of%20%60valueOf%60%20or%20%60equals%60%20(and%20%60hashCode%60).%0A%09%20%20%20*%0A%09%20%20%20*%20Note:%20because%20of%20this%20extension,%20the%20key%20equality%20of%20Immutable.Map%20and%20the%0A%09%20%20%20*%20value%20equality%20of%20Immutable.Set%20will%20differ%20from%20ES6%20Map%20and%20Set.%0A%09%20%20%20*%0A%09%20%20%20*%20###%20Defining%20custom%20values%0A%09%20%20%20*%0A%09%20%20%20*%20The%20easiest%20way%20to%20describe%20the%20value%20an%20object%20represents%20is%20by%20implementing%0A%09%20%20%20*%20%60valueOf%60.%20For%20example,%20%60Date%60%20represents%20a%20value%20by%20returning%20a%20unix%0A%09%20%20%20*%20timestamp%20for%20%60valueOf%60:%0A%09%20%20%20*%0A%09%20%20%20*%20%20%20%20%20var%20date1%20=%20new%20Date(1234567890000);%20//%20Fri%20Feb%2013%202009%20...%0A%09%20%20%20*%20%20%20%20%20var%20date2%20=%20new%20Date(1234567890000);%0A%09%20%20%20*%20%20%20%20%20date1.valueOf();%20//%201234567890000%0A%09%20%20%20*%20%20%20%20%20assert(%20date1%20!==%20date2%20);%0A%09%20%20%20*%20%20%20%20%20assert(%20Immutable.is(%20date1,%20date2%20)%20);%0A%09%20%20%20*%0A%09%20%20%20*%20Note:%20overriding%20%60valueOf%60%20may%20have%20other%20implications%20if%20you%20use%20this%20object%0A%09%20%20%20*%20where%20JavaScript%20expects%20a%20primitive,%20such%20as%20implicit%20string%20coercion.%0A%09%20%20%20*%0A%09%20%20%20*%20For%20more%20complex%20types,%20especially%20collections,%20implementing%20%60valueOf%60%20may%0A%09%20%20%20*%20not%20be%20performant.%20An%20alternative%20is%20to%20implement%20%60equals%60%20and%20%60hashCode%60.%0A%09%20%20%20*%0A%09%20%20%20*%20%60equals%60%20takes%20another%20object,%20presumably%20of%20similar%20type,%20and%20returns%20true%0A%09%20%20%20*%20if%20the%20it%20is%20equal.%20Equality%20is%20symmetrical,%20so%20the%20same%20result%20should%20be%0A%09%20%20%20*%20returned%20if%20this%20and%20the%20argument%20are%20flipped.%0A%09%20%20%20*%0A%09%20%20%20*%20%20%20%20%20assert(%20a.equals(b)%20===%20b.equals(a)%20);%0A%09%20%20%20*%0A%09%20%20%20*%20%60hashCode%60%20returns%20a%2032bit%20integer%20number%20representing%20the%20object%20which%20will%0A%09%20%20%20*%20be%20used%20to%20determine%20how%20to%20store%20the%20value%20object%20in%20a%20Map%20or%20Set.%20You%20must%0A%09%20%20%20*%20provide%20both%20or%20neither%20methods,%20one%20must%20not%20exist%20without%20the%20other.%0A%09%20%20%20*%0A%09%20%20%20*%20Also,%20an%20important%20relationship%20between%20these%20methods%20must%20be%20upheld:%20if%20two%0A%09%20%20%20*%20values%20are%20equal,%20they%20*must*%20return%20the%20same%20hashCode.%20If%20the%20values%20are%20not%0A%09%20%20%20*%20equal,%20they%20might%20have%20the%20same%20hashCode;%20this%20is%20called%20a%20hash%20collision,%0A%09%20%20%20*%20and%20while%20undesirable%20for%20performance%20reasons,%20it%20is%20acceptable.%0A%09%20%20%20*%0A%09%20%20%20*%20%20%20%20%20if%20(a.equals(b))%20%7B%0A%09%20%20%20*%20%20%20%20%20%20%20assert(%20a.hashCode()%20===%20b.hashCode()%20);%0A%09%20%20%20*%20%20%20%20%20%7D%0A%09%20%20%20*%0A%09%20%20%20*%20All%20Immutable%20collections%20implement%20%60equals%60%20and%20%60hashCode%60.%0A%09%20%20%20*%0A%09%20%20%20*/%0A%09%20%20function%20is(valueA,%20valueB)%20%7B%0A%09%20%20%20%20if%20(valueA%20===%20valueB%20%7C%7C%20(valueA%20!==%20valueA%20&&%20valueB%20!==%20valueB))%20%7B%0A%09%20%20%20%20%20%20return%20true;%0A%09%20%20%20%20%7D%0A%09%20%20%20%20if%20(!valueA%20%7C%7C%20!valueB)%20%7B%0A%09%20%20%20%20%20%20return%20false;%0A%09%20%20%20%20%7D%0A%09%20%20%20%20if%20(typeof%20valueA.valueOf%20===%20'function'%20&&%0A%09%20%20%20%20%20%20%20%20typeof%20valueB.valueOf%20===%20'function')%20%7B%0A%09%20%20%20%20%20%20valueA%20=%20valueA.valueOf();%0A%09%20%20%20%20%20%20valueB%20=%20valueB.valueOf();%0A%09%20%20%20%20%20%20if%20(valueA%20===%20valueB%20%7C%7C%20(valueA%20!==%20valueA%20&&%20valueB%20!==%20valueB))%20%7B%0A%09%20%20%20%20%20%20%20%20return%20true;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20if%20(!valueA%20%7C%7C%20!valueB)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20false;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%7D%0A%09%20%20%20%20if%20(typeof%20valueA.equals%20===%20'function'%20&&%0A%09%20%20%20%20%20%20%20%20typeof%20valueB.equals%20===%20'function'%20&&%0A%09%20%20%20%20%20%20%20%20valueA.equals(valueB))%20%7B%0A%09%20%20%20%20%20%20return%20true;%0A%09%20%20%20%20%7D%0A%09%20%20%20%20return%20false;%0A%09%20%20%7D%0A%0A%09%20%20function%20deepEqual(a,%20b)%20%7B%0A%09%20%20%20%20if%20(a%20===%20b)%20%7B%0A%09%20%20%20%20%20%20return%20true;%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20if%20(%0A%09%20%20%20%20%20%20!isIterable(b)%20%7C%7C%0A%09%20%20%20%20%20%20a.size%20!==%20undefined%20&&%20b.size%20!==%20undefined%20&&%20a.size%20!==%20b.size%20%7C%7C%0A%09%20%20%20%20%20%20a.__hash%20!==%20undefined%20&&%20b.__hash%20!==%20undefined%20&&%20a.__hash%20!==%20b.__hash%20%7C%7C%0A%09%20%20%20%20%20%20isKeyed(a)%20!==%20isKeyed(b)%20%7C%7C%0A%09%20%20%20%20%20%20isIndexed(a)%20!==%20isIndexed(b)%20%7C%7C%0A%09%20%20%20%20%20%20isOrdered(a)%20!==%20isOrdered(b)%0A%09%20%20%20%20)%20%7B%0A%09%20%20%20%20%20%20return%20false;%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20if%20(a.size%20===%200%20&&%20b.size%20===%200)%20%7B%0A%09%20%20%20%20%20%20return%20true;%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20var%20notAssociative%20=%20!isAssociative(a);%0A%0A%09%20%20%20%20if%20(isOrdered(a))%20%7B%0A%09%20%20%20%20%20%20var%20entries%20=%20a.entries();%0A%09%20%20%20%20%20%20return%20b.every(function(v,%20k)%20%20%7B%0A%09%20%20%20%20%20%20%20%20var%20entry%20=%20entries.next().value;%0A%09%20%20%20%20%20%20%20%20return%20entry%20&&%20is(entry%5B1%5D,%20v)%20&&%20(notAssociative%20%7C%7C%20is(entry%5B0%5D,%20k));%0A%09%20%20%20%20%20%20%7D)%20&&%20entries.next().done;%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20var%20flipped%20=%20false;%0A%0A%09%20%20%20%20if%20(a.size%20===%20undefined)%20%7B%0A%09%20%20%20%20%20%20if%20(b.size%20===%20undefined)%20%7B%0A%09%20%20%20%20%20%20%20%20if%20(typeof%20a.cacheResult%20===%20'function')%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20a.cacheResult();%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%7D%20else%20%7B%0A%09%20%20%20%20%20%20%20%20flipped%20=%20true;%0A%09%20%20%20%20%20%20%20%20var%20_%20=%20a;%0A%09%20%20%20%20%20%20%20%20a%20=%20b;%0A%09%20%20%20%20%20%20%20%20b%20=%20_;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20var%20allEqual%20=%20true;%0A%09%20%20%20%20var%20bSize%20=%20b.__iterate(function(v,%20k)%20%20%7B%0A%09%20%20%20%20%20%20if%20(notAssociative%20?%20!a.has(v)%20:%0A%09%20%20%20%20%20%20%20%20%20%20flipped%20?%20!is(v,%20a.get(k,%20NOT_SET))%20:%20!is(a.get(k,%20NOT_SET),%20v))%20%7B%0A%09%20%20%20%20%20%20%20%20allEqual%20=%20false;%0A%09%20%20%20%20%20%20%20%20return%20false;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%7D);%0A%0A%09%20%20%20%20return%20allEqual%20&&%20a.size%20===%20bSize;%0A%09%20%20%7D%0A%0A%09%20%20createClass(Repeat,%20IndexedSeq);%0A%0A%09%20%20%20%20function%20Repeat(value,%20times)%20%7B%0A%09%20%20%20%20%20%20if%20(!(this%20instanceof%20Repeat))%20%7B%0A%09%20%20%20%20%20%20%20%20return%20new%20Repeat(value,%20times);%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20this._value%20=%20value;%0A%09%20%20%20%20%20%20this.size%20=%20times%20===%20undefined%20?%20Infinity%20:%20Math.max(0,%20times);%0A%09%20%20%20%20%20%20if%20(this.size%20===%200)%20%7B%0A%09%20%20%20%20%20%20%20%20if%20(EMPTY_REPEAT)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20return%20EMPTY_REPEAT;%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20EMPTY_REPEAT%20=%20this;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20Repeat.prototype.toString%20=%20function()%20%7B%0A%09%20%20%20%20%20%20if%20(this.size%20===%200)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20'Repeat%20%5B%5D';%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20'Repeat%20%5B%20'%20+%20this._value%20+%20'%20'%20+%20this.size%20+%20'%20times%20%5D';%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Repeat.prototype.get%20=%20function(index,%20notSetValue)%20%7B%0A%09%20%20%20%20%20%20return%20this.has(index)%20?%20this._value%20:%20notSetValue;%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Repeat.prototype.includes%20=%20function(searchValue)%20%7B%0A%09%20%20%20%20%20%20return%20is(this._value,%20searchValue);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Repeat.prototype.slice%20=%20function(begin,%20end)%20%7B%0A%09%20%20%20%20%20%20var%20size%20=%20this.size;%0A%09%20%20%20%20%20%20return%20wholeSlice(begin,%20end,%20size)%20?%20this%20:%0A%09%20%20%20%20%20%20%20%20new%20Repeat(this._value,%20resolveEnd(end,%20size)%20-%20resolveBegin(begin,%20size));%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Repeat.prototype.reverse%20=%20function()%20%7B%0A%09%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Repeat.prototype.indexOf%20=%20function(searchValue)%20%7B%0A%09%20%20%20%20%20%20if%20(is(this._value,%20searchValue))%20%7B%0A%09%20%20%20%20%20%20%20%20return%200;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20-1;%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Repeat.prototype.lastIndexOf%20=%20function(searchValue)%20%7B%0A%09%20%20%20%20%20%20if%20(is(this._value,%20searchValue))%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this.size;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20-1;%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Repeat.prototype.__iterate%20=%20function(fn,%20reverse)%20%7B%0A%09%20%20%20%20%20%20for%20(var%20ii%20=%200;%20ii%20%3C%20this.size;%20ii++)%20%7B%0A%09%20%20%20%20%20%20%20%20if%20(fn(this._value,%20ii,%20this)%20===%20false)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20return%20ii%20+%201;%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20ii;%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Repeat.prototype.__iterator%20=%20function(type,%20reverse)%20%7Bvar%20this$0%20=%20this;%0A%09%20%20%20%20%20%20var%20ii%20=%200;%0A%09%20%20%20%20%20%20return%20new%20Iterator(function()%20%0A%09%20%20%20%20%20%20%20%20%7Breturn%20ii%20%3C%20this$0.size%20?%20iteratorValue(type,%20ii++,%20this$0._value)%20:%20iteratorDone()%7D%0A%09%20%20%20%20%20%20);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Repeat.prototype.equals%20=%20function(other)%20%7B%0A%09%20%20%20%20%20%20return%20other%20instanceof%20Repeat%20?%0A%09%20%20%20%20%20%20%20%20is(this._value,%20other._value)%20:%0A%09%20%20%20%20%20%20%20%20deepEqual(other);%0A%09%20%20%20%20%7D;%0A%0A%0A%09%20%20var%20EMPTY_REPEAT;%0A%0A%09%20%20function%20invariant(condition,%20error)%20%7B%0A%09%20%20%20%20if%20(!condition)%20throw%20new%20Error(error);%0A%09%20%20%7D%0A%0A%09%20%20createClass(Range,%20IndexedSeq);%0A%0A%09%20%20%20%20function%20Range(start,%20end,%20step)%20%7B%0A%09%20%20%20%20%20%20if%20(!(this%20instanceof%20Range))%20%7B%0A%09%20%20%20%20%20%20%20%20return%20new%20Range(start,%20end,%20step);%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20invariant(step%20!==%200,%20'Cannot%20step%20a%20Range%20by%200');%0A%09%20%20%20%20%20%20start%20=%20start%20%7C%7C%200;%0A%09%20%20%20%20%20%20if%20(end%20===%20undefined)%20%7B%0A%09%20%20%20%20%20%20%20%20end%20=%20Infinity;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20step%20=%20step%20===%20undefined%20?%201%20:%20Math.abs(step);%0A%09%20%20%20%20%20%20if%20(end%20%3C%20start)%20%7B%0A%09%20%20%20%20%20%20%20%20step%20=%20-step;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20this._start%20=%20start;%0A%09%20%20%20%20%20%20this._end%20=%20end;%0A%09%20%20%20%20%20%20this._step%20=%20step;%0A%09%20%20%20%20%20%20this.size%20=%20Math.max(0,%20Math.ceil((end%20-%20start)%20/%20step%20-%201)%20+%201);%0A%09%20%20%20%20%20%20if%20(this.size%20===%200)%20%7B%0A%09%20%20%20%20%20%20%20%20if%20(EMPTY_RANGE)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20return%20EMPTY_RANGE;%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20EMPTY_RANGE%20=%20this;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20Range.prototype.toString%20=%20function()%20%7B%0A%09%20%20%20%20%20%20if%20(this.size%20===%200)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20'Range%20%5B%5D';%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20'Range%20%5B%20'%20+%0A%09%20%20%20%20%20%20%20%20this._start%20+%20'...'%20+%20this._end%20+%0A%09%20%20%20%20%20%20%20%20(this._step%20%3E%201%20?%20'%20by%20'%20+%20this._step%20:%20'')%20+%0A%09%20%20%20%20%20%20'%20%5D';%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Range.prototype.get%20=%20function(index,%20notSetValue)%20%7B%0A%09%20%20%20%20%20%20return%20this.has(index)%20?%0A%09%20%20%20%20%20%20%20%20this._start%20+%20wrapIndex(this,%20index)%20*%20this._step%20:%0A%09%20%20%20%20%20%20%20%20notSetValue;%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Range.prototype.includes%20=%20function(searchValue)%20%7B%0A%09%20%20%20%20%20%20var%20possibleIndex%20=%20(searchValue%20-%20this._start)%20/%20this._step;%0A%09%20%20%20%20%20%20return%20possibleIndex%20%3E=%200%20&&%0A%09%20%20%20%20%20%20%20%20possibleIndex%20%3C%20this.size%20&&%0A%09%20%20%20%20%20%20%20%20possibleIndex%20===%20Math.floor(possibleIndex);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Range.prototype.slice%20=%20function(begin,%20end)%20%7B%0A%09%20%20%20%20%20%20if%20(wholeSlice(begin,%20end,%20this.size))%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20begin%20=%20resolveBegin(begin,%20this.size);%0A%09%20%20%20%20%20%20end%20=%20resolveEnd(end,%20this.size);%0A%09%20%20%20%20%20%20if%20(end%20%3C=%20begin)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20new%20Range(0,%200);%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20new%20Range(this.get(begin,%20this._end),%20this.get(end,%20this._end),%20this._step);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Range.prototype.indexOf%20=%20function(searchValue)%20%7B%0A%09%20%20%20%20%20%20var%20offsetValue%20=%20searchValue%20-%20this._start;%0A%09%20%20%20%20%20%20if%20(offsetValue%20%25%20this._step%20===%200)%20%7B%0A%09%20%20%20%20%20%20%20%20var%20index%20=%20offsetValue%20/%20this._step;%0A%09%20%20%20%20%20%20%20%20if%20(index%20%3E=%200%20&&%20index%20%3C%20this.size)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20return%20index%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20-1;%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Range.prototype.lastIndexOf%20=%20function(searchValue)%20%7B%0A%09%20%20%20%20%20%20return%20this.indexOf(searchValue);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Range.prototype.__iterate%20=%20function(fn,%20reverse)%20%7B%0A%09%20%20%20%20%20%20var%20maxIndex%20=%20this.size%20-%201;%0A%09%20%20%20%20%20%20var%20step%20=%20this._step;%0A%09%20%20%20%20%20%20var%20value%20=%20reverse%20?%20this._start%20+%20maxIndex%20*%20step%20:%20this._start;%0A%09%20%20%20%20%20%20for%20(var%20ii%20=%200;%20ii%20%3C=%20maxIndex;%20ii++)%20%7B%0A%09%20%20%20%20%20%20%20%20if%20(fn(value,%20ii,%20this)%20===%20false)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20return%20ii%20+%201;%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20value%20+=%20reverse%20?%20-step%20:%20step;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20ii;%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Range.prototype.__iterator%20=%20function(type,%20reverse)%20%7B%0A%09%20%20%20%20%20%20var%20maxIndex%20=%20this.size%20-%201;%0A%09%20%20%20%20%20%20var%20step%20=%20this._step;%0A%09%20%20%20%20%20%20var%20value%20=%20reverse%20?%20this._start%20+%20maxIndex%20*%20step%20:%20this._start;%0A%09%20%20%20%20%20%20var%20ii%20=%200;%0A%09%20%20%20%20%20%20return%20new%20Iterator(function()%20%20%7B%0A%09%20%20%20%20%20%20%20%20var%20v%20=%20value;%0A%09%20%20%20%20%20%20%20%20value%20+=%20reverse%20?%20-step%20:%20step;%0A%09%20%20%20%20%20%20%20%20return%20ii%20%3E%20maxIndex%20?%20iteratorDone()%20:%20iteratorValue(type,%20ii++,%20v);%0A%09%20%20%20%20%20%20%7D);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Range.prototype.equals%20=%20function(other)%20%7B%0A%09%20%20%20%20%20%20return%20other%20instanceof%20Range%20?%0A%09%20%20%20%20%20%20%20%20this._start%20===%20other._start%20&&%0A%09%20%20%20%20%20%20%20%20this._end%20===%20other._end%20&&%0A%09%20%20%20%20%20%20%20%20this._step%20===%20other._step%20:%0A%09%20%20%20%20%20%20%20%20deepEqual(this,%20other);%0A%09%20%20%20%20%7D;%0A%0A%0A%09%20%20var%20EMPTY_RANGE;%0A%0A%09%20%20createClass(Collection,%20Iterable);%0A%09%20%20%20%20function%20Collection()%20%7B%0A%09%20%20%20%20%20%20throw%20TypeError('Abstract');%0A%09%20%20%20%20%7D%0A%0A%0A%09%20%20createClass(KeyedCollection,%20Collection);function%20KeyedCollection()%20%7B%7D%0A%0A%09%20%20createClass(IndexedCollection,%20Collection);function%20IndexedCollection()%20%7B%7D%0A%0A%09%20%20createClass(SetCollection,%20Collection);function%20SetCollection()%20%7B%7D%0A%0A%0A%09%20%20Collection.Keyed%20=%20KeyedCollection;%0A%09%20%20Collection.Indexed%20=%20IndexedCollection;%0A%09%20%20Collection.Set%20=%20SetCollection;%0A%0A%09%20%20var%20imul%20=%0A%09%20%20%20%20typeof%20Math.imul%20===%20'function'%20&&%20Math.imul(0xffffffff,%202)%20===%20-2%20?%0A%09%20%20%20%20Math.imul%20:%0A%09%20%20%20%20function%20imul(a,%20b)%20%7B%0A%09%20%20%20%20%20%20a%20=%20a%20%7C%200;%20//%20int%0A%09%20%20%20%20%20%20b%20=%20b%20%7C%200;%20//%20int%0A%09%20%20%20%20%20%20var%20c%20=%20a%20&%200xffff;%0A%09%20%20%20%20%20%20var%20d%20=%20b%20&%200xffff;%0A%09%20%20%20%20%20%20//%20Shift%20by%200%20fixes%20the%20sign%20on%20the%20high%20part.%0A%09%20%20%20%20%20%20return%20(c%20*%20d)%20+%20((((a%20%3E%3E%3E%2016)%20*%20d%20+%20c%20*%20(b%20%3E%3E%3E%2016))%20%3C%3C%2016)%20%3E%3E%3E%200)%20%7C%200;%20//%20int%0A%09%20%20%20%20%7D;%0A%0A%09%20%20//%20v8%20has%20an%20optimization%20for%20storing%2031-bit%20signed%20numbers.%0A%09%20%20//%20Values%20which%20have%20either%2000%20or%2011%20as%20the%20high%20order%20bits%20qualify.%0A%09%20%20//%20This%20function%20drops%20the%20highest%20order%20bit%20in%20a%20signed%20number,%20maintaining%0A%09%20%20//%20the%20sign%20bit.%0A%09%20%20function%20smi(i32)%20%7B%0A%09%20%20%20%20return%20((i32%20%3E%3E%3E%201)%20&%200x40000000)%20%7C%20(i32%20&%200xBFFFFFFF);%0A%09%20%20%7D%0A%0A%09%20%20function%20hash(o)%20%7B%0A%09%20%20%20%20if%20(o%20===%20false%20%7C%7C%20o%20===%20null%20%7C%7C%20o%20===%20undefined)%20%7B%0A%09%20%20%20%20%20%20return%200;%0A%09%20%20%20%20%7D%0A%09%20%20%20%20if%20(typeof%20o.valueOf%20===%20'function')%20%7B%0A%09%20%20%20%20%20%20o%20=%20o.valueOf();%0A%09%20%20%20%20%20%20if%20(o%20===%20false%20%7C%7C%20o%20===%20null%20%7C%7C%20o%20===%20undefined)%20%7B%0A%09%20%20%20%20%20%20%20%20return%200;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%7D%0A%09%20%20%20%20if%20(o%20===%20true)%20%7B%0A%09%20%20%20%20%20%20return%201;%0A%09%20%20%20%20%7D%0A%09%20%20%20%20var%20type%20=%20typeof%20o;%0A%09%20%20%20%20if%20(type%20===%20'number')%20%7B%0A%09%20%20%20%20%20%20var%20h%20=%20o%20%7C%200;%0A%09%20%20%20%20%20%20if%20(h%20!==%20o)%20%7B%0A%09%20%20%20%20%20%20%20%20h%20%5E=%20o%20*%200xFFFFFFFF;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20while%20(o%20%3E%200xFFFFFFFF)%20%7B%0A%09%20%20%20%20%20%20%20%20o%20/=%200xFFFFFFFF;%0A%09%20%20%20%20%20%20%20%20h%20%5E=%20o;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20smi(h);%0A%09%20%20%20%20%7D%0A%09%20%20%20%20if%20(type%20===%20'string')%20%7B%0A%09%20%20%20%20%20%20return%20o.length%20%3E%20STRING_HASH_CACHE_MIN_STRLEN%20?%20cachedHashString(o)%20:%20hashString(o);%0A%09%20%20%20%20%7D%0A%09%20%20%20%20if%20(typeof%20o.hashCode%20===%20'function')%20%7B%0A%09%20%20%20%20%20%20return%20o.hashCode();%0A%09%20%20%20%20%7D%0A%09%20%20%20%20if%20(type%20===%20'object')%20%7B%0A%09%20%20%20%20%20%20return%20hashJSObj(o);%0A%09%20%20%20%20%7D%0A%09%20%20%20%20if%20(typeof%20o.toString%20===%20'function')%20%7B%0A%09%20%20%20%20%20%20return%20hashString(o.toString());%0A%09%20%20%20%20%7D%0A%09%20%20%20%20throw%20new%20Error('Value%20type%20'%20+%20type%20+%20'%20cannot%20be%20hashed.');%0A%09%20%20%7D%0A%0A%09%20%20function%20cachedHashString(string)%20%7B%0A%09%20%20%20%20var%20hash%20=%20stringHashCache%5Bstring%5D;%0A%09%20%20%20%20if%20(hash%20===%20undefined)%20%7B%0A%09%20%20%20%20%20%20hash%20=%20hashString(string);%0A%09%20%20%20%20%20%20if%20(STRING_HASH_CACHE_SIZE%20===%20STRING_HASH_CACHE_MAX_SIZE)%20%7B%0A%09%20%20%20%20%20%20%20%20STRING_HASH_CACHE_SIZE%20=%200;%0A%09%20%20%20%20%20%20%20%20stringHashCache%20=%20%7B%7D;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20STRING_HASH_CACHE_SIZE++;%0A%09%20%20%20%20%20%20stringHashCache%5Bstring%5D%20=%20hash;%0A%09%20%20%20%20%7D%0A%09%20%20%20%20return%20hash;%0A%09%20%20%7D%0A%0A%09%20%20//%20http://jsperf.com/hashing-strings%0A%09%20%20function%20hashString(string)%20%7B%0A%09%20%20%20%20//%20This%20is%20the%20hash%20from%20JVM%0A%09%20%20%20%20//%20The%20hash%20code%20for%20a%20string%20is%20computed%20as%0A%09%20%20%20%20//%20s%5B0%5D%20*%2031%20%5E%20(n%20-%201)%20+%20s%5B1%5D%20*%2031%20%5E%20(n%20-%202)%20+%20...%20+%20s%5Bn%20-%201%5D,%0A%09%20%20%20%20//%20where%20s%5Bi%5D%20is%20the%20ith%20character%20of%20the%20string%20and%20n%20is%20the%20length%20of%0A%09%20%20%20%20//%20the%20string.%20We%20%22mod%22%20the%20result%20to%20make%20it%20between%200%20(inclusive)%20and%202%5E31%0A%09%20%20%20%20//%20(exclusive)%20by%20dropping%20high%20bits.%0A%09%20%20%20%20var%20hash%20=%200;%0A%09%20%20%20%20for%20(var%20ii%20=%200;%20ii%20%3C%20string.length;%20ii++)%20%7B%0A%09%20%20%20%20%20%20hash%20=%2031%20*%20hash%20+%20string.charCodeAt(ii)%20%7C%200;%0A%09%20%20%20%20%7D%0A%09%20%20%20%20return%20smi(hash);%0A%09%20%20%7D%0A%0A%09%20%20function%20hashJSObj(obj)%20%7B%0A%09%20%20%20%20var%20hash;%0A%09%20%20%20%20if%20(usingWeakMap)%20%7B%0A%09%20%20%20%20%20%20hash%20=%20weakMap.get(obj);%0A%09%20%20%20%20%20%20if%20(hash%20!==%20undefined)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20hash;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20hash%20=%20obj%5BUID_HASH_KEY%5D;%0A%09%20%20%20%20if%20(hash%20!==%20undefined)%20%7B%0A%09%20%20%20%20%20%20return%20hash;%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20if%20(!canDefineProperty)%20%7B%0A%09%20%20%20%20%20%20hash%20=%20obj.propertyIsEnumerable%20&&%20obj.propertyIsEnumerable%5BUID_HASH_KEY%5D;%0A%09%20%20%20%20%20%20if%20(hash%20!==%20undefined)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20hash;%0A%09%20%20%20%20%20%20%7D%0A%0A%09%20%20%20%20%20%20hash%20=%20getIENodeHash(obj);%0A%09%20%20%20%20%20%20if%20(hash%20!==%20undefined)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20hash;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20hash%20=%20++objHashUID;%0A%09%20%20%20%20if%20(objHashUID%20&%200x40000000)%20%7B%0A%09%20%20%20%20%20%20objHashUID%20=%200;%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20if%20(usingWeakMap)%20%7B%0A%09%20%20%20%20%20%20weakMap.set(obj,%20hash);%0A%09%20%20%20%20%7D%20else%20if%20(isExtensible%20!==%20undefined%20&&%20isExtensible(obj)%20===%20false)%20%7B%0A%09%20%20%20%20%20%20throw%20new%20Error('Non-extensible%20objects%20are%20not%20allowed%20as%20keys.');%0A%09%20%20%20%20%7D%20else%20if%20(canDefineProperty)%20%7B%0A%09%20%20%20%20%20%20Object.defineProperty(obj,%20UID_HASH_KEY,%20%7B%0A%09%20%20%20%20%20%20%20%20'enumerable':%20false,%0A%09%20%20%20%20%20%20%20%20'configurable':%20false,%0A%09%20%20%20%20%20%20%20%20'writable':%20false,%0A%09%20%20%20%20%20%20%20%20'value':%20hash%0A%09%20%20%20%20%20%20%7D);%0A%09%20%20%20%20%7D%20else%20if%20(obj.propertyIsEnumerable%20!==%20undefined%20&&%0A%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20obj.propertyIsEnumerable%20===%20obj.constructor.prototype.propertyIsEnumerable)%20%7B%0A%09%20%20%20%20%20%20//%20Since%20we%20can't%20define%20a%20non-enumerable%20property%20on%20the%20object%0A%09%20%20%20%20%20%20//%20we'll%20hijack%20one%20of%20the%20less-used%20non-enumerable%20properties%20to%0A%09%20%20%20%20%20%20//%20save%20our%20hash%20on%20it.%20Since%20this%20is%20a%20function%20it%20will%20not%20show%20up%20in%0A%09%20%20%20%20%20%20//%20%60JSON.stringify%60%20which%20is%20what%20we%20want.%0A%09%20%20%20%20%20%20obj.propertyIsEnumerable%20=%20function()%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this.constructor.prototype.propertyIsEnumerable.apply(this,%20arguments);%0A%09%20%20%20%20%20%20%7D;%0A%09%20%20%20%20%20%20obj.propertyIsEnumerable%5BUID_HASH_KEY%5D%20=%20hash;%0A%09%20%20%20%20%7D%20else%20if%20(obj.nodeType%20!==%20undefined)%20%7B%0A%09%20%20%20%20%20%20//%20At%20this%20point%20we%20couldn't%20get%20the%20IE%20%60uniqueID%60%20to%20use%20as%20a%20hash%0A%09%20%20%20%20%20%20//%20and%20we%20couldn't%20use%20a%20non-enumerable%20property%20to%20exploit%20the%0A%09%20%20%20%20%20%20//%20dontEnum%20bug%20so%20we%20simply%20add%20the%20%60UID_HASH_KEY%60%20on%20the%20node%0A%09%20%20%20%20%20%20//%20itself.%0A%09%20%20%20%20%20%20obj%5BUID_HASH_KEY%5D%20=%20hash;%0A%09%20%20%20%20%7D%20else%20%7B%0A%09%20%20%20%20%20%20throw%20new%20Error('Unable%20to%20set%20a%20non-enumerable%20property%20on%20object.');%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20return%20hash;%0A%09%20%20%7D%0A%0A%09%20%20//%20Get%20references%20to%20ES5%20object%20methods.%0A%09%20%20var%20isExtensible%20=%20Object.isExtensible;%0A%0A%09%20%20//%20True%20if%20Object.defineProperty%20works%20as%20expected.%20IE8%20fails%20this%20test.%0A%09%20%20var%20canDefineProperty%20=%20(function()%20%7B%0A%09%20%20%20%20try%20%7B%0A%09%20%20%20%20%20%20Object.defineProperty(%7B%7D,%20'@',%20%7B%7D);%0A%09%20%20%20%20%20%20return%20true;%0A%09%20%20%20%20%7D%20catch%20(e)%20%7B%0A%09%20%20%20%20%20%20return%20false;%0A%09%20%20%20%20%7D%0A%09%20%20%7D());%0A%0A%09%20%20//%20IE%20has%20a%20%60uniqueID%60%20property%20on%20DOM%20nodes.%20We%20can%20construct%20the%20hash%20from%20it%0A%09%20%20//%20and%20avoid%20memory%20leaks%20from%20the%20IE%20cloneNode%20bug.%0A%09%20%20function%20getIENodeHash(node)%20%7B%0A%09%20%20%20%20if%20(node%20&&%20node.nodeType%20%3E%200)%20%7B%0A%09%20%20%20%20%20%20switch%20(node.nodeType)%20%7B%0A%09%20%20%20%20%20%20%20%20case%201:%20//%20Element%0A%09%20%20%20%20%20%20%20%20%20%20return%20node.uniqueID;%0A%09%20%20%20%20%20%20%20%20case%209:%20//%20Document%0A%09%20%20%20%20%20%20%20%20%20%20return%20node.documentElement%20&&%20node.documentElement.uniqueID;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%7D%0A%09%20%20%7D%0A%0A%09%20%20//%20If%20possible,%20use%20a%20WeakMap.%0A%09%20%20var%20usingWeakMap%20=%20typeof%20WeakMap%20===%20'function';%0A%09%20%20var%20weakMap;%0A%09%20%20if%20(usingWeakMap)%20%7B%0A%09%20%20%20%20weakMap%20=%20new%20WeakMap();%0A%09%20%20%7D%0A%0A%09%20%20var%20objHashUID%20=%200;%0A%0A%09%20%20var%20UID_HASH_KEY%20=%20'__immutablehash__';%0A%09%20%20if%20(typeof%20Symbol%20===%20'function')%20%7B%0A%09%20%20%20%20UID_HASH_KEY%20=%20Symbol(UID_HASH_KEY);%0A%09%20%20%7D%0A%0A%09%20%20var%20STRING_HASH_CACHE_MIN_STRLEN%20=%2016;%0A%09%20%20var%20STRING_HASH_CACHE_MAX_SIZE%20=%20255;%0A%09%20%20var%20STRING_HASH_CACHE_SIZE%20=%200;%0A%09%20%20var%20stringHashCache%20=%20%7B%7D;%0A%0A%09%20%20function%20assertNotInfinite(size)%20%7B%0A%09%20%20%20%20invariant(%0A%09%20%20%20%20%20%20size%20!==%20Infinity,%0A%09%20%20%20%20%20%20'Cannot%20perform%20this%20action%20with%20an%20infinite%20size.'%0A%09%20%20%20%20);%0A%09%20%20%7D%0A%0A%09%20%20createClass(Map,%20KeyedCollection);%0A%0A%09%20%20%20%20//%20@pragma%20Construction%0A%0A%09%20%20%20%20function%20Map(value)%20%7B%0A%09%20%20%20%20%20%20return%20value%20===%20null%20%7C%7C%20value%20===%20undefined%20?%20emptyMap()%20:%0A%09%20%20%20%20%20%20%20%20isMap(value)%20&&%20!isOrdered(value)%20?%20value%20:%0A%09%20%20%20%20%20%20%20%20emptyMap().withMutations(function(map%20)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20var%20iter%20=%20KeyedIterable(value);%0A%09%20%20%20%20%20%20%20%20%20%20assertNotInfinite(iter.size);%0A%09%20%20%20%20%20%20%20%20%20%20iter.forEach(function(v,%20k)%20%20%7Breturn%20map.set(k,%20v)%7D);%0A%09%20%20%20%20%20%20%20%20%7D);%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20Map.prototype.toString%20=%20function()%20%7B%0A%09%20%20%20%20%20%20return%20this.__toString('Map%20%7B',%20'%7D');%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20//%20@pragma%20Access%0A%0A%09%20%20%20%20Map.prototype.get%20=%20function(k,%20notSetValue)%20%7B%0A%09%20%20%20%20%20%20return%20this._root%20?%0A%09%20%20%20%20%20%20%20%20this._root.get(0,%20undefined,%20k,%20notSetValue)%20:%0A%09%20%20%20%20%20%20%20%20notSetValue;%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20//%20@pragma%20Modification%0A%0A%09%20%20%20%20Map.prototype.set%20=%20function(k,%20v)%20%7B%0A%09%20%20%20%20%20%20return%20updateMap(this,%20k,%20v);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Map.prototype.setIn%20=%20function(keyPath,%20v)%20%7B%0A%09%20%20%20%20%20%20return%20this.updateIn(keyPath,%20NOT_SET,%20function()%20%20%7Breturn%20v%7D);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Map.prototype.remove%20=%20function(k)%20%7B%0A%09%20%20%20%20%20%20return%20updateMap(this,%20k,%20NOT_SET);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Map.prototype.deleteIn%20=%20function(keyPath)%20%7B%0A%09%20%20%20%20%20%20return%20this.updateIn(keyPath,%20function()%20%20%7Breturn%20NOT_SET%7D);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Map.prototype.update%20=%20function(k,%20notSetValue,%20updater)%20%7B%0A%09%20%20%20%20%20%20return%20arguments.length%20===%201%20?%0A%09%20%20%20%20%20%20%20%20k(this)%20:%0A%09%20%20%20%20%20%20%20%20this.updateIn(%5Bk%5D,%20notSetValue,%20updater);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Map.prototype.updateIn%20=%20function(keyPath,%20notSetValue,%20updater)%20%7B%0A%09%20%20%20%20%20%20if%20(!updater)%20%7B%0A%09%20%20%20%20%20%20%20%20updater%20=%20notSetValue;%0A%09%20%20%20%20%20%20%20%20notSetValue%20=%20undefined;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20var%20updatedValue%20=%20updateInDeepMap(%0A%09%20%20%20%20%20%20%20%20this,%0A%09%20%20%20%20%20%20%20%20forceIterator(keyPath),%0A%09%20%20%20%20%20%20%20%20notSetValue,%0A%09%20%20%20%20%20%20%20%20updater%0A%09%20%20%20%20%20%20);%0A%09%20%20%20%20%20%20return%20updatedValue%20===%20NOT_SET%20?%20undefined%20:%20updatedValue;%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Map.prototype.clear%20=%20function()%20%7B%0A%09%20%20%20%20%20%20if%20(this.size%20===%200)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20if%20(this.__ownerID)%20%7B%0A%09%20%20%20%20%20%20%20%20this.size%20=%200;%0A%09%20%20%20%20%20%20%20%20this._root%20=%20null;%0A%09%20%20%20%20%20%20%20%20this.__hash%20=%20undefined;%0A%09%20%20%20%20%20%20%20%20this.__altered%20=%20true;%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20emptyMap();%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20//%20@pragma%20Composition%0A%0A%09%20%20%20%20Map.prototype.merge%20=%20function(/*...iters*/)%20%7B%0A%09%20%20%20%20%20%20return%20mergeIntoMapWith(this,%20undefined,%20arguments);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Map.prototype.mergeWith%20=%20function(merger)%20%7Bvar%20iters%20=%20SLICE$0.call(arguments,%201);%0A%09%20%20%20%20%20%20return%20mergeIntoMapWith(this,%20merger,%20iters);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Map.prototype.mergeIn%20=%20function(keyPath)%20%7Bvar%20iters%20=%20SLICE$0.call(arguments,%201);%0A%09%20%20%20%20%20%20return%20this.updateIn(%0A%09%20%20%20%20%20%20%20%20keyPath,%0A%09%20%20%20%20%20%20%20%20emptyMap(),%0A%09%20%20%20%20%20%20%20%20function(m%20)%20%7Breturn%20typeof%20m.merge%20===%20'function'%20?%0A%09%20%20%20%20%20%20%20%20%20%20m.merge.apply(m,%20iters)%20:%0A%09%20%20%20%20%20%20%20%20%20%20iters%5Biters.length%20-%201%5D%7D%0A%09%20%20%20%20%20%20);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Map.prototype.mergeDeep%20=%20function(/*...iters*/)%20%7B%0A%09%20%20%20%20%20%20return%20mergeIntoMapWith(this,%20deepMerger,%20arguments);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Map.prototype.mergeDeepWith%20=%20function(merger)%20%7Bvar%20iters%20=%20SLICE$0.call(arguments,%201);%0A%09%20%20%20%20%20%20return%20mergeIntoMapWith(this,%20deepMergerWith(merger),%20iters);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Map.prototype.mergeDeepIn%20=%20function(keyPath)%20%7Bvar%20iters%20=%20SLICE$0.call(arguments,%201);%0A%09%20%20%20%20%20%20return%20this.updateIn(%0A%09%20%20%20%20%20%20%20%20keyPath,%0A%09%20%20%20%20%20%20%20%20emptyMap(),%0A%09%20%20%20%20%20%20%20%20function(m%20)%20%7Breturn%20typeof%20m.mergeDeep%20===%20'function'%20?%0A%09%20%20%20%20%20%20%20%20%20%20m.mergeDeep.apply(m,%20iters)%20:%0A%09%20%20%20%20%20%20%20%20%20%20iters%5Biters.length%20-%201%5D%7D%0A%09%20%20%20%20%20%20);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Map.prototype.sort%20=%20function(comparator)%20%7B%0A%09%20%20%20%20%20%20//%20Late%20binding%0A%09%20%20%20%20%20%20return%20OrderedMap(sortFactory(this,%20comparator));%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Map.prototype.sortBy%20=%20function(mapper,%20comparator)%20%7B%0A%09%20%20%20%20%20%20//%20Late%20binding%0A%09%20%20%20%20%20%20return%20OrderedMap(sortFactory(this,%20comparator,%20mapper));%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20//%20@pragma%20Mutability%0A%0A%09%20%20%20%20Map.prototype.withMutations%20=%20function(fn)%20%7B%0A%09%20%20%20%20%20%20var%20mutable%20=%20this.asMutable();%0A%09%20%20%20%20%20%20fn(mutable);%0A%09%20%20%20%20%20%20return%20mutable.wasAltered()%20?%20mutable.__ensureOwner(this.__ownerID)%20:%20this;%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Map.prototype.asMutable%20=%20function()%20%7B%0A%09%20%20%20%20%20%20return%20this.__ownerID%20?%20this%20:%20this.__ensureOwner(new%20OwnerID());%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Map.prototype.asImmutable%20=%20function()%20%7B%0A%09%20%20%20%20%20%20return%20this.__ensureOwner();%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Map.prototype.wasAltered%20=%20function()%20%7B%0A%09%20%20%20%20%20%20return%20this.__altered;%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Map.prototype.__iterator%20=%20function(type,%20reverse)%20%7B%0A%09%20%20%20%20%20%20return%20new%20MapIterator(this,%20type,%20reverse);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Map.prototype.__iterate%20=%20function(fn,%20reverse)%20%7Bvar%20this$0%20=%20this;%0A%09%20%20%20%20%20%20var%20iterations%20=%200;%0A%09%20%20%20%20%20%20this._root%20&&%20this._root.iterate(function(entry%20)%20%7B%0A%09%20%20%20%20%20%20%20%20iterations++;%0A%09%20%20%20%20%20%20%20%20return%20fn(entry%5B1%5D,%20entry%5B0%5D,%20this$0);%0A%09%20%20%20%20%20%20%7D,%20reverse);%0A%09%20%20%20%20%20%20return%20iterations;%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Map.prototype.__ensureOwner%20=%20function(ownerID)%20%7B%0A%09%20%20%20%20%20%20if%20(ownerID%20===%20this.__ownerID)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20if%20(!ownerID)%20%7B%0A%09%20%20%20%20%20%20%20%20this.__ownerID%20=%20ownerID;%0A%09%20%20%20%20%20%20%20%20this.__altered%20=%20false;%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20makeMap(this.size,%20this._root,%20ownerID,%20this.__hash);%0A%09%20%20%20%20%7D;%0A%0A%0A%09%20%20function%20isMap(maybeMap)%20%7B%0A%09%20%20%20%20return%20!!(maybeMap%20&&%20maybeMap%5BIS_MAP_SENTINEL%5D);%0A%09%20%20%7D%0A%0A%09%20%20Map.isMap%20=%20isMap;%0A%0A%09%20%20var%20IS_MAP_SENTINEL%20=%20'@@__IMMUTABLE_MAP__@@';%0A%0A%09%20%20var%20MapPrototype%20=%20Map.prototype;%0A%09%20%20MapPrototype%5BIS_MAP_SENTINEL%5D%20=%20true;%0A%09%20%20MapPrototype%5BDELETE%5D%20=%20MapPrototype.remove;%0A%09%20%20MapPrototype.removeIn%20=%20MapPrototype.deleteIn;%0A%0A%0A%09%20%20//%20#pragma%20Trie%20Nodes%0A%0A%0A%0A%09%20%20%20%20function%20ArrayMapNode(ownerID,%20entries)%20%7B%0A%09%20%20%20%20%20%20this.ownerID%20=%20ownerID;%0A%09%20%20%20%20%20%20this.entries%20=%20entries;%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20ArrayMapNode.prototype.get%20=%20function(shift,%20keyHash,%20key,%20notSetValue)%20%7B%0A%09%20%20%20%20%20%20var%20entries%20=%20this.entries;%0A%09%20%20%20%20%20%20for%20(var%20ii%20=%200,%20len%20=%20entries.length;%20ii%20%3C%20len;%20ii++)%20%7B%0A%09%20%20%20%20%20%20%20%20if%20(is(key,%20entries%5Bii%5D%5B0%5D))%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20return%20entries%5Bii%5D%5B1%5D;%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20notSetValue;%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20ArrayMapNode.prototype.update%20=%20function(ownerID,%20shift,%20keyHash,%20key,%20value,%20didChangeSize,%20didAlter)%20%7B%0A%09%20%20%20%20%20%20var%20removed%20=%20value%20===%20NOT_SET;%0A%0A%09%20%20%20%20%20%20var%20entries%20=%20this.entries;%0A%09%20%20%20%20%20%20var%20idx%20=%200;%0A%09%20%20%20%20%20%20for%20(var%20len%20=%20entries.length;%20idx%20%3C%20len;%20idx++)%20%7B%0A%09%20%20%20%20%20%20%20%20if%20(is(key,%20entries%5Bidx%5D%5B0%5D))%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20break;%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20var%20exists%20=%20idx%20%3C%20len;%0A%0A%09%20%20%20%20%20%20if%20(exists%20?%20entries%5Bidx%5D%5B1%5D%20===%20value%20:%20removed)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%0A%09%20%20%20%20%20%20SetRef(didAlter);%0A%09%20%20%20%20%20%20(removed%20%7C%7C%20!exists)%20&&%20SetRef(didChangeSize);%0A%0A%09%20%20%20%20%20%20if%20(removed%20&&%20entries.length%20===%201)%20%7B%0A%09%20%20%20%20%20%20%20%20return;%20//%20undefined%0A%09%20%20%20%20%20%20%7D%0A%0A%09%20%20%20%20%20%20if%20(!exists%20&&%20!removed%20&&%20entries.length%20%3E=%20MAX_ARRAY_MAP_SIZE)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20createNodes(ownerID,%20entries,%20key,%20value);%0A%09%20%20%20%20%20%20%7D%0A%0A%09%20%20%20%20%20%20var%20isEditable%20=%20ownerID%20&&%20ownerID%20===%20this.ownerID;%0A%09%20%20%20%20%20%20var%20newEntries%20=%20isEditable%20?%20entries%20:%20arrCopy(entries);%0A%0A%09%20%20%20%20%20%20if%20(exists)%20%7B%0A%09%20%20%20%20%20%20%20%20if%20(removed)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20idx%20===%20len%20-%201%20?%20newEntries.pop()%20:%20(newEntries%5Bidx%5D%20=%20newEntries.pop());%0A%09%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20newEntries%5Bidx%5D%20=%20%5Bkey,%20value%5D;%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%7D%20else%20%7B%0A%09%20%20%20%20%20%20%20%20newEntries.push(%5Bkey,%20value%5D);%0A%09%20%20%20%20%20%20%7D%0A%0A%09%20%20%20%20%20%20if%20(isEditable)%20%7B%0A%09%20%20%20%20%20%20%20%20this.entries%20=%20newEntries;%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%0A%09%20%20%20%20%20%20return%20new%20ArrayMapNode(ownerID,%20newEntries);%0A%09%20%20%20%20%7D;%0A%0A%0A%0A%0A%09%20%20%20%20function%20BitmapIndexedNode(ownerID,%20bitmap,%20nodes)%20%7B%0A%09%20%20%20%20%20%20this.ownerID%20=%20ownerID;%0A%09%20%20%20%20%20%20this.bitmap%20=%20bitmap;%0A%09%20%20%20%20%20%20this.nodes%20=%20nodes;%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20BitmapIndexedNode.prototype.get%20=%20function(shift,%20keyHash,%20key,%20notSetValue)%20%7B%0A%09%20%20%20%20%20%20if%20(keyHash%20===%20undefined)%20%7B%0A%09%20%20%20%20%20%20%20%20keyHash%20=%20hash(key);%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20var%20bit%20=%20(1%20%3C%3C%20((shift%20===%200%20?%20keyHash%20:%20keyHash%20%3E%3E%3E%20shift)%20&%20MASK));%0A%09%20%20%20%20%20%20var%20bitmap%20=%20this.bitmap;%0A%09%20%20%20%20%20%20return%20(bitmap%20&%20bit)%20===%200%20?%20notSetValue%20:%0A%09%20%20%20%20%20%20%20%20this.nodes%5BpopCount(bitmap%20&%20(bit%20-%201))%5D.get(shift%20+%20SHIFT,%20keyHash,%20key,%20notSetValue);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20BitmapIndexedNode.prototype.update%20=%20function(ownerID,%20shift,%20keyHash,%20key,%20value,%20didChangeSize,%20didAlter)%20%7B%0A%09%20%20%20%20%20%20if%20(keyHash%20===%20undefined)%20%7B%0A%09%20%20%20%20%20%20%20%20keyHash%20=%20hash(key);%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20var%20keyHashFrag%20=%20(shift%20===%200%20?%20keyHash%20:%20keyHash%20%3E%3E%3E%20shift)%20&%20MASK;%0A%09%20%20%20%20%20%20var%20bit%20=%201%20%3C%3C%20keyHashFrag;%0A%09%20%20%20%20%20%20var%20bitmap%20=%20this.bitmap;%0A%09%20%20%20%20%20%20var%20exists%20=%20(bitmap%20&%20bit)%20!==%200;%0A%0A%09%20%20%20%20%20%20if%20(!exists%20&&%20value%20===%20NOT_SET)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%0A%09%20%20%20%20%20%20var%20idx%20=%20popCount(bitmap%20&%20(bit%20-%201));%0A%09%20%20%20%20%20%20var%20nodes%20=%20this.nodes;%0A%09%20%20%20%20%20%20var%20node%20=%20exists%20?%20nodes%5Bidx%5D%20:%20undefined;%0A%09%20%20%20%20%20%20var%20newNode%20=%20updateNode(node,%20ownerID,%20shift%20+%20SHIFT,%20keyHash,%20key,%20value,%20didChangeSize,%20didAlter);%0A%0A%09%20%20%20%20%20%20if%20(newNode%20===%20node)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%0A%09%20%20%20%20%20%20if%20(!exists%20&&%20newNode%20&&%20nodes.length%20%3E=%20MAX_BITMAP_INDEXED_SIZE)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20expandNodes(ownerID,%20nodes,%20bitmap,%20keyHashFrag,%20newNode);%0A%09%20%20%20%20%20%20%7D%0A%0A%09%20%20%20%20%20%20if%20(exists%20&&%20!newNode%20&&%20nodes.length%20===%202%20&&%20isLeafNode(nodes%5Bidx%20%5E%201%5D))%20%7B%0A%09%20%20%20%20%20%20%20%20return%20nodes%5Bidx%20%5E%201%5D;%0A%09%20%20%20%20%20%20%7D%0A%0A%09%20%20%20%20%20%20if%20(exists%20&&%20newNode%20&&%20nodes.length%20===%201%20&&%20isLeafNode(newNode))%20%7B%0A%09%20%20%20%20%20%20%20%20return%20newNode;%0A%09%20%20%20%20%20%20%7D%0A%0A%09%20%20%20%20%20%20var%20isEditable%20=%20ownerID%20&&%20ownerID%20===%20this.ownerID;%0A%09%20%20%20%20%20%20var%20newBitmap%20=%20exists%20?%20newNode%20?%20bitmap%20:%20bitmap%20%5E%20bit%20:%20bitmap%20%7C%20bit;%0A%09%20%20%20%20%20%20var%20newNodes%20=%20exists%20?%20newNode%20?%0A%09%20%20%20%20%20%20%20%20setIn(nodes,%20idx,%20newNode,%20isEditable)%20:%0A%09%20%20%20%20%20%20%20%20spliceOut(nodes,%20idx,%20isEditable)%20:%0A%09%20%20%20%20%20%20%20%20spliceIn(nodes,%20idx,%20newNode,%20isEditable);%0A%0A%09%20%20%20%20%20%20if%20(isEditable)%20%7B%0A%09%20%20%20%20%20%20%20%20this.bitmap%20=%20newBitmap;%0A%09%20%20%20%20%20%20%20%20this.nodes%20=%20newNodes;%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%0A%09%20%20%20%20%20%20return%20new%20BitmapIndexedNode(ownerID,%20newBitmap,%20newNodes);%0A%09%20%20%20%20%7D;%0A%0A%0A%0A%0A%09%20%20%20%20function%20HashArrayMapNode(ownerID,%20count,%20nodes)%20%7B%0A%09%20%20%20%20%20%20this.ownerID%20=%20ownerID;%0A%09%20%20%20%20%20%20this.count%20=%20count;%0A%09%20%20%20%20%20%20this.nodes%20=%20nodes;%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20HashArrayMapNode.prototype.get%20=%20function(shift,%20keyHash,%20key,%20notSetValue)%20%7B%0A%09%20%20%20%20%20%20if%20(keyHash%20===%20undefined)%20%7B%0A%09%20%20%20%20%20%20%20%20keyHash%20=%20hash(key);%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20var%20idx%20=%20(shift%20===%200%20?%20keyHash%20:%20keyHash%20%3E%3E%3E%20shift)%20&%20MASK;%0A%09%20%20%20%20%20%20var%20node%20=%20this.nodes%5Bidx%5D;%0A%09%20%20%20%20%20%20return%20node%20?%20node.get(shift%20+%20SHIFT,%20keyHash,%20key,%20notSetValue)%20:%20notSetValue;%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20HashArrayMapNode.prototype.update%20=%20function(ownerID,%20shift,%20keyHash,%20key,%20value,%20didChangeSize,%20didAlter)%20%7B%0A%09%20%20%20%20%20%20if%20(keyHash%20===%20undefined)%20%7B%0A%09%20%20%20%20%20%20%20%20keyHash%20=%20hash(key);%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20var%20idx%20=%20(shift%20===%200%20?%20keyHash%20:%20keyHash%20%3E%3E%3E%20shift)%20&%20MASK;%0A%09%20%20%20%20%20%20var%20removed%20=%20value%20===%20NOT_SET;%0A%09%20%20%20%20%20%20var%20nodes%20=%20this.nodes;%0A%09%20%20%20%20%20%20var%20node%20=%20nodes%5Bidx%5D;%0A%0A%09%20%20%20%20%20%20if%20(removed%20&&%20!node)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%0A%09%20%20%20%20%20%20var%20newNode%20=%20updateNode(node,%20ownerID,%20shift%20+%20SHIFT,%20keyHash,%20key,%20value,%20didChangeSize,%20didAlter);%0A%09%20%20%20%20%20%20if%20(newNode%20===%20node)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%0A%09%20%20%20%20%20%20var%20newCount%20=%20this.count;%0A%09%20%20%20%20%20%20if%20(!node)%20%7B%0A%09%20%20%20%20%20%20%20%20newCount++;%0A%09%20%20%20%20%20%20%7D%20else%20if%20(!newNode)%20%7B%0A%09%20%20%20%20%20%20%20%20newCount--;%0A%09%20%20%20%20%20%20%20%20if%20(newCount%20%3C%20MIN_HASH_ARRAY_MAP_SIZE)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20return%20packNodes(ownerID,%20nodes,%20newCount,%20idx);%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%7D%0A%0A%09%20%20%20%20%20%20var%20isEditable%20=%20ownerID%20&&%20ownerID%20===%20this.ownerID;%0A%09%20%20%20%20%20%20var%20newNodes%20=%20setIn(nodes,%20idx,%20newNode,%20isEditable);%0A%0A%09%20%20%20%20%20%20if%20(isEditable)%20%7B%0A%09%20%20%20%20%20%20%20%20this.count%20=%20newCount;%0A%09%20%20%20%20%20%20%20%20this.nodes%20=%20newNodes;%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%0A%09%20%20%20%20%20%20return%20new%20HashArrayMapNode(ownerID,%20newCount,%20newNodes);%0A%09%20%20%20%20%7D;%0A%0A%0A%0A%0A%09%20%20%20%20function%20HashCollisionNode(ownerID,%20keyHash,%20entries)%20%7B%0A%09%20%20%20%20%20%20this.ownerID%20=%20ownerID;%0A%09%20%20%20%20%20%20this.keyHash%20=%20keyHash;%0A%09%20%20%20%20%20%20this.entries%20=%20entries;%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20HashCollisionNode.prototype.get%20=%20function(shift,%20keyHash,%20key,%20notSetValue)%20%7B%0A%09%20%20%20%20%20%20var%20entries%20=%20this.entries;%0A%09%20%20%20%20%20%20for%20(var%20ii%20=%200,%20len%20=%20entries.length;%20ii%20%3C%20len;%20ii++)%20%7B%0A%09%20%20%20%20%20%20%20%20if%20(is(key,%20entries%5Bii%5D%5B0%5D))%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20return%20entries%5Bii%5D%5B1%5D;%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20notSetValue;%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20HashCollisionNode.prototype.update%20=%20function(ownerID,%20shift,%20keyHash,%20key,%20value,%20didChangeSize,%20didAlter)%20%7B%0A%09%20%20%20%20%20%20if%20(keyHash%20===%20undefined)%20%7B%0A%09%20%20%20%20%20%20%20%20keyHash%20=%20hash(key);%0A%09%20%20%20%20%20%20%7D%0A%0A%09%20%20%20%20%20%20var%20removed%20=%20value%20===%20NOT_SET;%0A%0A%09%20%20%20%20%20%20if%20(keyHash%20!==%20this.keyHash)%20%7B%0A%09%20%20%20%20%20%20%20%20if%20(removed)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20SetRef(didAlter);%0A%09%20%20%20%20%20%20%20%20SetRef(didChangeSize);%0A%09%20%20%20%20%20%20%20%20return%20mergeIntoNode(this,%20ownerID,%20shift,%20keyHash,%20%5Bkey,%20value%5D);%0A%09%20%20%20%20%20%20%7D%0A%0A%09%20%20%20%20%20%20var%20entries%20=%20this.entries;%0A%09%20%20%20%20%20%20var%20idx%20=%200;%0A%09%20%20%20%20%20%20for%20(var%20len%20=%20entries.length;%20idx%20%3C%20len;%20idx++)%20%7B%0A%09%20%20%20%20%20%20%20%20if%20(is(key,%20entries%5Bidx%5D%5B0%5D))%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20break;%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20var%20exists%20=%20idx%20%3C%20len;%0A%0A%09%20%20%20%20%20%20if%20(exists%20?%20entries%5Bidx%5D%5B1%5D%20===%20value%20:%20removed)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%0A%09%20%20%20%20%20%20SetRef(didAlter);%0A%09%20%20%20%20%20%20(removed%20%7C%7C%20!exists)%20&&%20SetRef(didChangeSize);%0A%0A%09%20%20%20%20%20%20if%20(removed%20&&%20len%20===%202)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20new%20ValueNode(ownerID,%20this.keyHash,%20entries%5Bidx%20%5E%201%5D);%0A%09%20%20%20%20%20%20%7D%0A%0A%09%20%20%20%20%20%20var%20isEditable%20=%20ownerID%20&&%20ownerID%20===%20this.ownerID;%0A%09%20%20%20%20%20%20var%20newEntries%20=%20isEditable%20?%20entries%20:%20arrCopy(entries);%0A%0A%09%20%20%20%20%20%20if%20(exists)%20%7B%0A%09%20%20%20%20%20%20%20%20if%20(removed)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20idx%20===%20len%20-%201%20?%20newEntries.pop()%20:%20(newEntries%5Bidx%5D%20=%20newEntries.pop());%0A%09%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20newEntries%5Bidx%5D%20=%20%5Bkey,%20value%5D;%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%7D%20else%20%7B%0A%09%20%20%20%20%20%20%20%20newEntries.push(%5Bkey,%20value%5D);%0A%09%20%20%20%20%20%20%7D%0A%0A%09%20%20%20%20%20%20if%20(isEditable)%20%7B%0A%09%20%20%20%20%20%20%20%20this.entries%20=%20newEntries;%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%0A%09%20%20%20%20%20%20return%20new%20HashCollisionNode(ownerID,%20this.keyHash,%20newEntries);%0A%09%20%20%20%20%7D;%0A%0A%0A%0A%0A%09%20%20%20%20function%20ValueNode(ownerID,%20keyHash,%20entry)%20%7B%0A%09%20%20%20%20%20%20this.ownerID%20=%20ownerID;%0A%09%20%20%20%20%20%20this.keyHash%20=%20keyHash;%0A%09%20%20%20%20%20%20this.entry%20=%20entry;%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20ValueNode.prototype.get%20=%20function(shift,%20keyHash,%20key,%20notSetValue)%20%7B%0A%09%20%20%20%20%20%20return%20is(key,%20this.entry%5B0%5D)%20?%20this.entry%5B1%5D%20:%20notSetValue;%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20ValueNode.prototype.update%20=%20function(ownerID,%20shift,%20keyHash,%20key,%20value,%20didChangeSize,%20didAlter)%20%7B%0A%09%20%20%20%20%20%20var%20removed%20=%20value%20===%20NOT_SET;%0A%09%20%20%20%20%20%20var%20keyMatch%20=%20is(key,%20this.entry%5B0%5D);%0A%09%20%20%20%20%20%20if%20(keyMatch%20?%20value%20===%20this.entry%5B1%5D%20:%20removed)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%0A%09%20%20%20%20%20%20SetRef(didAlter);%0A%0A%09%20%20%20%20%20%20if%20(removed)%20%7B%0A%09%20%20%20%20%20%20%20%20SetRef(didChangeSize);%0A%09%20%20%20%20%20%20%20%20return;%20//%20undefined%0A%09%20%20%20%20%20%20%7D%0A%0A%09%20%20%20%20%20%20if%20(keyMatch)%20%7B%0A%09%20%20%20%20%20%20%20%20if%20(ownerID%20&&%20ownerID%20===%20this.ownerID)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20this.entry%5B1%5D%20=%20value;%0A%09%20%20%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20return%20new%20ValueNode(ownerID,%20this.keyHash,%20%5Bkey,%20value%5D);%0A%09%20%20%20%20%20%20%7D%0A%0A%09%20%20%20%20%20%20SetRef(didChangeSize);%0A%09%20%20%20%20%20%20return%20mergeIntoNode(this,%20ownerID,%20shift,%20hash(key),%20%5Bkey,%20value%5D);%0A%09%20%20%20%20%7D;%0A%0A%0A%0A%09%20%20//%20#pragma%20Iterators%0A%0A%09%20%20ArrayMapNode.prototype.iterate%20=%0A%09%20%20HashCollisionNode.prototype.iterate%20=%20function%20(fn,%20reverse)%20%7B%0A%09%20%20%20%20var%20entries%20=%20this.entries;%0A%09%20%20%20%20for%20(var%20ii%20=%200,%20maxIndex%20=%20entries.length%20-%201;%20ii%20%3C=%20maxIndex;%20ii++)%20%7B%0A%09%20%20%20%20%20%20if%20(fn(entries%5Breverse%20?%20maxIndex%20-%20ii%20:%20ii%5D)%20===%20false)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20false;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%7D%0A%09%20%20%7D%0A%0A%09%20%20BitmapIndexedNode.prototype.iterate%20=%0A%09%20%20HashArrayMapNode.prototype.iterate%20=%20function%20(fn,%20reverse)%20%7B%0A%09%20%20%20%20var%20nodes%20=%20this.nodes;%0A%09%20%20%20%20for%20(var%20ii%20=%200,%20maxIndex%20=%20nodes.length%20-%201;%20ii%20%3C=%20maxIndex;%20ii++)%20%7B%0A%09%20%20%20%20%20%20var%20node%20=%20nodes%5Breverse%20?%20maxIndex%20-%20ii%20:%20ii%5D;%0A%09%20%20%20%20%20%20if%20(node%20&&%20node.iterate(fn,%20reverse)%20===%20false)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20false;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%7D%0A%09%20%20%7D%0A%0A%09%20%20ValueNode.prototype.iterate%20=%20function%20(fn,%20reverse)%20%7B%0A%09%20%20%20%20return%20fn(this.entry);%0A%09%20%20%7D%0A%0A%09%20%20createClass(MapIterator,%20Iterator);%0A%0A%09%20%20%20%20function%20MapIterator(map,%20type,%20reverse)%20%7B%0A%09%20%20%20%20%20%20this._type%20=%20type;%0A%09%20%20%20%20%20%20this._reverse%20=%20reverse;%0A%09%20%20%20%20%20%20this._stack%20=%20map._root%20&&%20mapIteratorFrame(map._root);%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20MapIterator.prototype.next%20=%20function()%20%7B%0A%09%20%20%20%20%20%20var%20type%20=%20this._type;%0A%09%20%20%20%20%20%20var%20stack%20=%20this._stack;%0A%09%20%20%20%20%20%20while%20(stack)%20%7B%0A%09%20%20%20%20%20%20%20%20var%20node%20=%20stack.node;%0A%09%20%20%20%20%20%20%20%20var%20index%20=%20stack.index++;%0A%09%20%20%20%20%20%20%20%20var%20maxIndex;%0A%09%20%20%20%20%20%20%20%20if%20(node.entry)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20if%20(index%20===%200)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20%20%20return%20mapIteratorValue(type,%20node.entry);%0A%09%20%20%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20%7D%20else%20if%20(node.entries)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20maxIndex%20=%20node.entries.length%20-%201;%0A%09%20%20%20%20%20%20%20%20%20%20if%20(index%20%3C=%20maxIndex)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20%20%20return%20mapIteratorValue(type,%20node.entries%5Bthis._reverse%20?%20maxIndex%20-%20index%20:%20index%5D);%0A%09%20%20%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20maxIndex%20=%20node.nodes.length%20-%201;%0A%09%20%20%20%20%20%20%20%20%20%20if%20(index%20%3C=%20maxIndex)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20%20%20var%20subNode%20=%20node.nodes%5Bthis._reverse%20?%20maxIndex%20-%20index%20:%20index%5D;%0A%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(subNode)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(subNode.entry)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20mapIteratorValue(type,%20subNode.entry);%0A%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20stack%20=%20this._stack%20=%20mapIteratorFrame(subNode,%20stack);%0A%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20%20%20%20%20continue;%0A%09%20%20%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20stack%20=%20this._stack%20=%20this._stack.__prev;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20iteratorDone();%0A%09%20%20%20%20%7D;%0A%0A%0A%09%20%20function%20mapIteratorValue(type,%20entry)%20%7B%0A%09%20%20%20%20return%20iteratorValue(type,%20entry%5B0%5D,%20entry%5B1%5D);%0A%09%20%20%7D%0A%0A%09%20%20function%20mapIteratorFrame(node,%20prev)%20%7B%0A%09%20%20%20%20return%20%7B%0A%09%20%20%20%20%20%20node:%20node,%0A%09%20%20%20%20%20%20index:%200,%0A%09%20%20%20%20%20%20__prev:%20prev%0A%09%20%20%20%20%7D;%0A%09%20%20%7D%0A%0A%09%20%20function%20makeMap(size,%20root,%20ownerID,%20hash)%20%7B%0A%09%20%20%20%20var%20map%20=%20Object.create(MapPrototype);%0A%09%20%20%20%20map.size%20=%20size;%0A%09%20%20%20%20map._root%20=%20root;%0A%09%20%20%20%20map.__ownerID%20=%20ownerID;%0A%09%20%20%20%20map.__hash%20=%20hash;%0A%09%20%20%20%20map.__altered%20=%20false;%0A%09%20%20%20%20return%20map;%0A%09%20%20%7D%0A%0A%09%20%20var%20EMPTY_MAP;%0A%09%20%20function%20emptyMap()%20%7B%0A%09%20%20%20%20return%20EMPTY_MAP%20%7C%7C%20(EMPTY_MAP%20=%20makeMap(0));%0A%09%20%20%7D%0A%0A%09%20%20function%20updateMap(map,%20k,%20v)%20%7B%0A%09%20%20%20%20var%20newRoot;%0A%09%20%20%20%20var%20newSize;%0A%09%20%20%20%20if%20(!map._root)%20%7B%0A%09%20%20%20%20%20%20if%20(v%20===%20NOT_SET)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20map;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20newSize%20=%201;%0A%09%20%20%20%20%20%20newRoot%20=%20new%20ArrayMapNode(map.__ownerID,%20%5B%5Bk,%20v%5D%5D);%0A%09%20%20%20%20%7D%20else%20%7B%0A%09%20%20%20%20%20%20var%20didChangeSize%20=%20MakeRef(CHANGE_LENGTH);%0A%09%20%20%20%20%20%20var%20didAlter%20=%20MakeRef(DID_ALTER);%0A%09%20%20%20%20%20%20newRoot%20=%20updateNode(map._root,%20map.__ownerID,%200,%20undefined,%20k,%20v,%20didChangeSize,%20didAlter);%0A%09%20%20%20%20%20%20if%20(!didAlter.value)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20map;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20newSize%20=%20map.size%20+%20(didChangeSize.value%20?%20v%20===%20NOT_SET%20?%20-1%20:%201%20:%200);%0A%09%20%20%20%20%7D%0A%09%20%20%20%20if%20(map.__ownerID)%20%7B%0A%09%20%20%20%20%20%20map.size%20=%20newSize;%0A%09%20%20%20%20%20%20map._root%20=%20newRoot;%0A%09%20%20%20%20%20%20map.__hash%20=%20undefined;%0A%09%20%20%20%20%20%20map.__altered%20=%20true;%0A%09%20%20%20%20%20%20return%20map;%0A%09%20%20%20%20%7D%0A%09%20%20%20%20return%20newRoot%20?%20makeMap(newSize,%20newRoot)%20:%20emptyMap();%0A%09%20%20%7D%0A%0A%09%20%20function%20updateNode(node,%20ownerID,%20shift,%20keyHash,%20key,%20value,%20didChangeSize,%20didAlter)%20%7B%0A%09%20%20%20%20if%20(!node)%20%7B%0A%09%20%20%20%20%20%20if%20(value%20===%20NOT_SET)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20node;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20SetRef(didAlter);%0A%09%20%20%20%20%20%20SetRef(didChangeSize);%0A%09%20%20%20%20%20%20return%20new%20ValueNode(ownerID,%20keyHash,%20%5Bkey,%20value%5D);%0A%09%20%20%20%20%7D%0A%09%20%20%20%20return%20node.update(ownerID,%20shift,%20keyHash,%20key,%20value,%20didChangeSize,%20didAlter);%0A%09%20%20%7D%0A%0A%09%20%20function%20isLeafNode(node)%20%7B%0A%09%20%20%20%20return%20node.constructor%20===%20ValueNode%20%7C%7C%20node.constructor%20===%20HashCollisionNode;%0A%09%20%20%7D%0A%0A%09%20%20function%20mergeIntoNode(node,%20ownerID,%20shift,%20keyHash,%20entry)%20%7B%0A%09%20%20%20%20if%20(node.keyHash%20===%20keyHash)%20%7B%0A%09%20%20%20%20%20%20return%20new%20HashCollisionNode(ownerID,%20keyHash,%20%5Bnode.entry,%20entry%5D);%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20var%20idx1%20=%20(shift%20===%200%20?%20node.keyHash%20:%20node.keyHash%20%3E%3E%3E%20shift)%20&%20MASK;%0A%09%20%20%20%20var%20idx2%20=%20(shift%20===%200%20?%20keyHash%20:%20keyHash%20%3E%3E%3E%20shift)%20&%20MASK;%0A%0A%09%20%20%20%20var%20newNode;%0A%09%20%20%20%20var%20nodes%20=%20idx1%20===%20idx2%20?%0A%09%20%20%20%20%20%20%5BmergeIntoNode(node,%20ownerID,%20shift%20+%20SHIFT,%20keyHash,%20entry)%5D%20:%0A%09%20%20%20%20%20%20((newNode%20=%20new%20ValueNode(ownerID,%20keyHash,%20entry)),%20idx1%20%3C%20idx2%20?%20%5Bnode,%20newNode%5D%20:%20%5BnewNode,%20node%5D);%0A%0A%09%20%20%20%20return%20new%20BitmapIndexedNode(ownerID,%20(1%20%3C%3C%20idx1)%20%7C%20(1%20%3C%3C%20idx2),%20nodes);%0A%09%20%20%7D%0A%0A%09%20%20function%20createNodes(ownerID,%20entries,%20key,%20value)%20%7B%0A%09%20%20%20%20if%20(!ownerID)%20%7B%0A%09%20%20%20%20%20%20ownerID%20=%20new%20OwnerID();%0A%09%20%20%20%20%7D%0A%09%20%20%20%20var%20node%20=%20new%20ValueNode(ownerID,%20hash(key),%20%5Bkey,%20value%5D);%0A%09%20%20%20%20for%20(var%20ii%20=%200;%20ii%20%3C%20entries.length;%20ii++)%20%7B%0A%09%20%20%20%20%20%20var%20entry%20=%20entries%5Bii%5D;%0A%09%20%20%20%20%20%20node%20=%20node.update(ownerID,%200,%20undefined,%20entry%5B0%5D,%20entry%5B1%5D);%0A%09%20%20%20%20%7D%0A%09%20%20%20%20return%20node;%0A%09%20%20%7D%0A%0A%09%20%20function%20packNodes(ownerID,%20nodes,%20count,%20excluding)%20%7B%0A%09%20%20%20%20var%20bitmap%20=%200;%0A%09%20%20%20%20var%20packedII%20=%200;%0A%09%20%20%20%20var%20packedNodes%20=%20new%20Array(count);%0A%09%20%20%20%20for%20(var%20ii%20=%200,%20bit%20=%201,%20len%20=%20nodes.length;%20ii%20%3C%20len;%20ii++,%20bit%20%3C%3C=%201)%20%7B%0A%09%20%20%20%20%20%20var%20node%20=%20nodes%5Bii%5D;%0A%09%20%20%20%20%20%20if%20(node%20!==%20undefined%20&&%20ii%20!==%20excluding)%20%7B%0A%09%20%20%20%20%20%20%20%20bitmap%20%7C=%20bit;%0A%09%20%20%20%20%20%20%20%20packedNodes%5BpackedII++%5D%20=%20node;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%7D%0A%09%20%20%20%20return%20new%20BitmapIndexedNode(ownerID,%20bitmap,%20packedNodes);%0A%09%20%20%7D%0A%0A%09%20%20function%20expandNodes(ownerID,%20nodes,%20bitmap,%20including,%20node)%20%7B%0A%09%20%20%20%20var%20count%20=%200;%0A%09%20%20%20%20var%20expandedNodes%20=%20new%20Array(SIZE);%0A%09%20%20%20%20for%20(var%20ii%20=%200;%20bitmap%20!==%200;%20ii++,%20bitmap%20%3E%3E%3E=%201)%20%7B%0A%09%20%20%20%20%20%20expandedNodes%5Bii%5D%20=%20bitmap%20&%201%20?%20nodes%5Bcount++%5D%20:%20undefined;%0A%09%20%20%20%20%7D%0A%09%20%20%20%20expandedNodes%5Bincluding%5D%20=%20node;%0A%09%20%20%20%20return%20new%20HashArrayMapNode(ownerID,%20count%20+%201,%20expandedNodes);%0A%09%20%20%7D%0A%0A%09%20%20function%20mergeIntoMapWith(map,%20merger,%20iterables)%20%7B%0A%09%20%20%20%20var%20iters%20=%20%5B%5D;%0A%09%20%20%20%20for%20(var%20ii%20=%200;%20ii%20%3C%20iterables.length;%20ii++)%20%7B%0A%09%20%20%20%20%20%20var%20value%20=%20iterables%5Bii%5D;%0A%09%20%20%20%20%20%20var%20iter%20=%20KeyedIterable(value);%0A%09%20%20%20%20%20%20if%20(!isIterable(value))%20%7B%0A%09%20%20%20%20%20%20%20%20iter%20=%20iter.map(function(v%20)%20%7Breturn%20fromJS(v)%7D);%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20iters.push(iter);%0A%09%20%20%20%20%7D%0A%09%20%20%20%20return%20mergeIntoCollectionWith(map,%20merger,%20iters);%0A%09%20%20%7D%0A%0A%09%20%20function%20deepMerger(existing,%20value,%20key)%20%7B%0A%09%20%20%20%20return%20existing%20&&%20existing.mergeDeep%20&&%20isIterable(value)%20?%0A%09%20%20%20%20%20%20existing.mergeDeep(value)%20:%0A%09%20%20%20%20%20%20is(existing,%20value)%20?%20existing%20:%20value;%0A%09%20%20%7D%0A%0A%09%20%20function%20deepMergerWith(merger)%20%7B%0A%09%20%20%20%20return%20function(existing,%20value,%20key)%20%20%7B%0A%09%20%20%20%20%20%20if%20(existing%20&&%20existing.mergeDeepWith%20&&%20isIterable(value))%20%7B%0A%09%20%20%20%20%20%20%20%20return%20existing.mergeDeepWith(merger,%20value);%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20var%20nextValue%20=%20merger(existing,%20value,%20key);%0A%09%20%20%20%20%20%20return%20is(existing,%20nextValue)%20?%20existing%20:%20nextValue;%0A%09%20%20%20%20%7D;%0A%09%20%20%7D%0A%0A%09%20%20function%20mergeIntoCollectionWith(collection,%20merger,%20iters)%20%7B%0A%09%20%20%20%20iters%20=%20iters.filter(function(x%20)%20%7Breturn%20x.size%20!==%200%7D);%0A%09%20%20%20%20if%20(iters.length%20===%200)%20%7B%0A%09%20%20%20%20%20%20return%20collection;%0A%09%20%20%20%20%7D%0A%09%20%20%20%20if%20(collection.size%20===%200%20&&%20!collection.__ownerID%20&&%20iters.length%20===%201)%20%7B%0A%09%20%20%20%20%20%20return%20collection.constructor(iters%5B0%5D);%0A%09%20%20%20%20%7D%0A%09%20%20%20%20return%20collection.withMutations(function(collection%20)%20%7B%0A%09%20%20%20%20%20%20var%20mergeIntoMap%20=%20merger%20?%0A%09%20%20%20%20%20%20%20%20function(value,%20key)%20%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20collection.update(key,%20NOT_SET,%20function(existing%20)%0A%09%20%20%20%20%20%20%20%20%20%20%20%20%7Breturn%20existing%20===%20NOT_SET%20?%20value%20:%20merger(existing,%20value,%20key)%7D%0A%09%20%20%20%20%20%20%20%20%20%20);%0A%09%20%20%20%20%20%20%20%20%7D%20:%0A%09%20%20%20%20%20%20%20%20function(value,%20key)%20%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20collection.set(key,%20value);%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20for%20(var%20ii%20=%200;%20ii%20%3C%20iters.length;%20ii++)%20%7B%0A%09%20%20%20%20%20%20%20%20iters%5Bii%5D.forEach(mergeIntoMap);%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%7D);%0A%09%20%20%7D%0A%0A%09%20%20function%20updateInDeepMap(existing,%20keyPathIter,%20notSetValue,%20updater)%20%7B%0A%09%20%20%20%20var%20isNotSet%20=%20existing%20===%20NOT_SET;%0A%09%20%20%20%20var%20step%20=%20keyPathIter.next();%0A%09%20%20%20%20if%20(step.done)%20%7B%0A%09%20%20%20%20%20%20var%20existingValue%20=%20isNotSet%20?%20notSetValue%20:%20existing;%0A%09%20%20%20%20%20%20var%20newValue%20=%20updater(existingValue);%0A%09%20%20%20%20%20%20return%20newValue%20===%20existingValue%20?%20existing%20:%20newValue;%0A%09%20%20%20%20%7D%0A%09%20%20%20%20invariant(%0A%09%20%20%20%20%20%20isNotSet%20%7C%7C%20(existing%20&&%20existing.set),%0A%09%20%20%20%20%20%20'invalid%20keyPath'%0A%09%20%20%20%20);%0A%09%20%20%20%20var%20key%20=%20step.value;%0A%09%20%20%20%20var%20nextExisting%20=%20isNotSet%20?%20NOT_SET%20:%20existing.get(key,%20NOT_SET);%0A%09%20%20%20%20var%20nextUpdated%20=%20updateInDeepMap(%0A%09%20%20%20%20%20%20nextExisting,%0A%09%20%20%20%20%20%20keyPathIter,%0A%09%20%20%20%20%20%20notSetValue,%0A%09%20%20%20%20%20%20updater%0A%09%20%20%20%20);%0A%09%20%20%20%20return%20nextUpdated%20===%20nextExisting%20?%20existing%20:%0A%09%20%20%20%20%20%20nextUpdated%20===%20NOT_SET%20?%20existing.remove(key)%20:%0A%09%20%20%20%20%20%20(isNotSet%20?%20emptyMap()%20:%20existing).set(key,%20nextUpdated);%0A%09%20%20%7D%0A%0A%09%20%20function%20popCount(x)%20%7B%0A%09%20%20%20%20x%20=%20x%20-%20((x%20%3E%3E%201)%20&%200x55555555);%0A%09%20%20%20%20x%20=%20(x%20&%200x33333333)%20+%20((x%20%3E%3E%202)%20&%200x33333333);%0A%09%20%20%20%20x%20=%20(x%20+%20(x%20%3E%3E%204))%20&%200x0f0f0f0f;%0A%09%20%20%20%20x%20=%20x%20+%20(x%20%3E%3E%208);%0A%09%20%20%20%20x%20=%20x%20+%20(x%20%3E%3E%2016);%0A%09%20%20%20%20return%20x%20&%200x7f;%0A%09%20%20%7D%0A%0A%09%20%20function%20setIn(array,%20idx,%20val,%20canEdit)%20%7B%0A%09%20%20%20%20var%20newArray%20=%20canEdit%20?%20array%20:%20arrCopy(array);%0A%09%20%20%20%20newArray%5Bidx%5D%20=%20val;%0A%09%20%20%20%20return%20newArray;%0A%09%20%20%7D%0A%0A%09%20%20function%20spliceIn(array,%20idx,%20val,%20canEdit)%20%7B%0A%09%20%20%20%20var%20newLen%20=%20array.length%20+%201;%0A%09%20%20%20%20if%20(canEdit%20&&%20idx%20+%201%20===%20newLen)%20%7B%0A%09%20%20%20%20%20%20array%5Bidx%5D%20=%20val;%0A%09%20%20%20%20%20%20return%20array;%0A%09%20%20%20%20%7D%0A%09%20%20%20%20var%20newArray%20=%20new%20Array(newLen);%0A%09%20%20%20%20var%20after%20=%200;%0A%09%20%20%20%20for%20(var%20ii%20=%200;%20ii%20%3C%20newLen;%20ii++)%20%7B%0A%09%20%20%20%20%20%20if%20(ii%20===%20idx)%20%7B%0A%09%20%20%20%20%20%20%20%20newArray%5Bii%5D%20=%20val;%0A%09%20%20%20%20%20%20%20%20after%20=%20-1;%0A%09%20%20%20%20%20%20%7D%20else%20%7B%0A%09%20%20%20%20%20%20%20%20newArray%5Bii%5D%20=%20array%5Bii%20+%20after%5D;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%7D%0A%09%20%20%20%20return%20newArray;%0A%09%20%20%7D%0A%0A%09%20%20function%20spliceOut(array,%20idx,%20canEdit)%20%7B%0A%09%20%20%20%20var%20newLen%20=%20array.length%20-%201;%0A%09%20%20%20%20if%20(canEdit%20&&%20idx%20===%20newLen)%20%7B%0A%09%20%20%20%20%20%20array.pop();%0A%09%20%20%20%20%20%20return%20array;%0A%09%20%20%20%20%7D%0A%09%20%20%20%20var%20newArray%20=%20new%20Array(newLen);%0A%09%20%20%20%20var%20after%20=%200;%0A%09%20%20%20%20for%20(var%20ii%20=%200;%20ii%20%3C%20newLen;%20ii++)%20%7B%0A%09%20%20%20%20%20%20if%20(ii%20===%20idx)%20%7B%0A%09%20%20%20%20%20%20%20%20after%20=%201;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20newArray%5Bii%5D%20=%20array%5Bii%20+%20after%5D;%0A%09%20%20%20%20%7D%0A%09%20%20%20%20return%20newArray;%0A%09%20%20%7D%0A%0A%09%20%20var%20MAX_ARRAY_MAP_SIZE%20=%20SIZE%20/%204;%0A%09%20%20var%20MAX_BITMAP_INDEXED_SIZE%20=%20SIZE%20/%202;%0A%09%20%20var%20MIN_HASH_ARRAY_MAP_SIZE%20=%20SIZE%20/%204;%0A%0A%09%20%20createClass(List,%20IndexedCollection);%0A%0A%09%20%20%20%20//%20@pragma%20Construction%0A%0A%09%20%20%20%20function%20List(value)%20%7B%0A%09%20%20%20%20%20%20var%20empty%20=%20emptyList();%0A%09%20%20%20%20%20%20if%20(value%20===%20null%20%7C%7C%20value%20===%20undefined)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20empty;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20if%20(isList(value))%20%7B%0A%09%20%20%20%20%20%20%20%20return%20value;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20var%20iter%20=%20IndexedIterable(value);%0A%09%20%20%20%20%20%20var%20size%20=%20iter.size;%0A%09%20%20%20%20%20%20if%20(size%20===%200)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20empty;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20assertNotInfinite(size);%0A%09%20%20%20%20%20%20if%20(size%20%3E%200%20&&%20size%20%3C%20SIZE)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20makeList(0,%20size,%20SHIFT,%20null,%20new%20VNode(iter.toArray()));%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20empty.withMutations(function(list%20)%20%7B%0A%09%20%20%20%20%20%20%20%20list.setSize(size);%0A%09%20%20%20%20%20%20%20%20iter.forEach(function(v,%20i)%20%20%7Breturn%20list.set(i,%20v)%7D);%0A%09%20%20%20%20%20%20%7D);%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20List.of%20=%20function(/*...values*/)%20%7B%0A%09%20%20%20%20%20%20return%20this(arguments);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20List.prototype.toString%20=%20function()%20%7B%0A%09%20%20%20%20%20%20return%20this.__toString('List%20%5B',%20'%5D');%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20//%20@pragma%20Access%0A%0A%09%20%20%20%20List.prototype.get%20=%20function(index,%20notSetValue)%20%7B%0A%09%20%20%20%20%20%20index%20=%20wrapIndex(this,%20index);%0A%09%20%20%20%20%20%20if%20(index%20%3E=%200%20&&%20index%20%3C%20this.size)%20%7B%0A%09%20%20%20%20%20%20%20%20index%20+=%20this._origin;%0A%09%20%20%20%20%20%20%20%20var%20node%20=%20listNodeFor(this,%20index);%0A%09%20%20%20%20%20%20%20%20return%20node%20&&%20node.array%5Bindex%20&%20MASK%5D;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20notSetValue;%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20//%20@pragma%20Modification%0A%0A%09%20%20%20%20List.prototype.set%20=%20function(index,%20value)%20%7B%0A%09%20%20%20%20%20%20return%20updateList(this,%20index,%20value);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20List.prototype.remove%20=%20function(index)%20%7B%0A%09%20%20%20%20%20%20return%20!this.has(index)%20?%20this%20:%0A%09%20%20%20%20%20%20%20%20index%20===%200%20?%20this.shift()%20:%0A%09%20%20%20%20%20%20%20%20index%20===%20this.size%20-%201%20?%20this.pop()%20:%0A%09%20%20%20%20%20%20%20%20this.splice(index,%201);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20List.prototype.insert%20=%20function(index,%20value)%20%7B%0A%09%20%20%20%20%20%20return%20this.splice(index,%200,%20value);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20List.prototype.clear%20=%20function()%20%7B%0A%09%20%20%20%20%20%20if%20(this.size%20===%200)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20if%20(this.__ownerID)%20%7B%0A%09%20%20%20%20%20%20%20%20this.size%20=%20this._origin%20=%20this._capacity%20=%200;%0A%09%20%20%20%20%20%20%20%20this._level%20=%20SHIFT;%0A%09%20%20%20%20%20%20%20%20this._root%20=%20this._tail%20=%20null;%0A%09%20%20%20%20%20%20%20%20this.__hash%20=%20undefined;%0A%09%20%20%20%20%20%20%20%20this.__altered%20=%20true;%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20emptyList();%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20List.prototype.push%20=%20function(/*...values*/)%20%7B%0A%09%20%20%20%20%20%20var%20values%20=%20arguments;%0A%09%20%20%20%20%20%20var%20oldSize%20=%20this.size;%0A%09%20%20%20%20%20%20return%20this.withMutations(function(list%20)%20%7B%0A%09%20%20%20%20%20%20%20%20setListBounds(list,%200,%20oldSize%20+%20values.length);%0A%09%20%20%20%20%20%20%20%20for%20(var%20ii%20=%200;%20ii%20%3C%20values.length;%20ii++)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20list.set(oldSize%20+%20ii,%20values%5Bii%5D);%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%7D);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20List.prototype.pop%20=%20function()%20%7B%0A%09%20%20%20%20%20%20return%20setListBounds(this,%200,%20-1);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20List.prototype.unshift%20=%20function(/*...values*/)%20%7B%0A%09%20%20%20%20%20%20var%20values%20=%20arguments;%0A%09%20%20%20%20%20%20return%20this.withMutations(function(list%20)%20%7B%0A%09%20%20%20%20%20%20%20%20setListBounds(list,%20-values.length);%0A%09%20%20%20%20%20%20%20%20for%20(var%20ii%20=%200;%20ii%20%3C%20values.length;%20ii++)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20list.set(ii,%20values%5Bii%5D);%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%7D);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20List.prototype.shift%20=%20function()%20%7B%0A%09%20%20%20%20%20%20return%20setListBounds(this,%201);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20//%20@pragma%20Composition%0A%0A%09%20%20%20%20List.prototype.merge%20=%20function(/*...iters*/)%20%7B%0A%09%20%20%20%20%20%20return%20mergeIntoListWith(this,%20undefined,%20arguments);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20List.prototype.mergeWith%20=%20function(merger)%20%7Bvar%20iters%20=%20SLICE$0.call(arguments,%201);%0A%09%20%20%20%20%20%20return%20mergeIntoListWith(this,%20merger,%20iters);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20List.prototype.mergeDeep%20=%20function(/*...iters*/)%20%7B%0A%09%20%20%20%20%20%20return%20mergeIntoListWith(this,%20deepMerger,%20arguments);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20List.prototype.mergeDeepWith%20=%20function(merger)%20%7Bvar%20iters%20=%20SLICE$0.call(arguments,%201);%0A%09%20%20%20%20%20%20return%20mergeIntoListWith(this,%20deepMergerWith(merger),%20iters);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20List.prototype.setSize%20=%20function(size)%20%7B%0A%09%20%20%20%20%20%20return%20setListBounds(this,%200,%20size);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20//%20@pragma%20Iteration%0A%0A%09%20%20%20%20List.prototype.slice%20=%20function(begin,%20end)%20%7B%0A%09%20%20%20%20%20%20var%20size%20=%20this.size;%0A%09%20%20%20%20%20%20if%20(wholeSlice(begin,%20end,%20size))%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20setListBounds(%0A%09%20%20%20%20%20%20%20%20this,%0A%09%20%20%20%20%20%20%20%20resolveBegin(begin,%20size),%0A%09%20%20%20%20%20%20%20%20resolveEnd(end,%20size)%0A%09%20%20%20%20%20%20);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20List.prototype.__iterator%20=%20function(type,%20reverse)%20%7B%0A%09%20%20%20%20%20%20var%20index%20=%200;%0A%09%20%20%20%20%20%20var%20values%20=%20iterateList(this,%20reverse);%0A%09%20%20%20%20%20%20return%20new%20Iterator(function()%20%20%7B%0A%09%20%20%20%20%20%20%20%20var%20value%20=%20values();%0A%09%20%20%20%20%20%20%20%20return%20value%20===%20DONE%20?%0A%09%20%20%20%20%20%20%20%20%20%20iteratorDone()%20:%0A%09%20%20%20%20%20%20%20%20%20%20iteratorValue(type,%20index++,%20value);%0A%09%20%20%20%20%20%20%7D);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20List.prototype.__iterate%20=%20function(fn,%20reverse)%20%7B%0A%09%20%20%20%20%20%20var%20index%20=%200;%0A%09%20%20%20%20%20%20var%20values%20=%20iterateList(this,%20reverse);%0A%09%20%20%20%20%20%20var%20value;%0A%09%20%20%20%20%20%20while%20((value%20=%20values())%20!==%20DONE)%20%7B%0A%09%20%20%20%20%20%20%20%20if%20(fn(value,%20index++,%20this)%20===%20false)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20break;%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20index;%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20List.prototype.__ensureOwner%20=%20function(ownerID)%20%7B%0A%09%20%20%20%20%20%20if%20(ownerID%20===%20this.__ownerID)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20if%20(!ownerID)%20%7B%0A%09%20%20%20%20%20%20%20%20this.__ownerID%20=%20ownerID;%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20makeList(this._origin,%20this._capacity,%20this._level,%20this._root,%20this._tail,%20ownerID,%20this.__hash);%0A%09%20%20%20%20%7D;%0A%0A%0A%09%20%20function%20isList(maybeList)%20%7B%0A%09%20%20%20%20return%20!!(maybeList%20&&%20maybeList%5BIS_LIST_SENTINEL%5D);%0A%09%20%20%7D%0A%0A%09%20%20List.isList%20=%20isList;%0A%0A%09%20%20var%20IS_LIST_SENTINEL%20=%20'@@__IMMUTABLE_LIST__@@';%0A%0A%09%20%20var%20ListPrototype%20=%20List.prototype;%0A%09%20%20ListPrototype%5BIS_LIST_SENTINEL%5D%20=%20true;%0A%09%20%20ListPrototype%5BDELETE%5D%20=%20ListPrototype.remove;%0A%09%20%20ListPrototype.setIn%20=%20MapPrototype.setIn;%0A%09%20%20ListPrototype.deleteIn%20=%0A%09%20%20ListPrototype.removeIn%20=%20MapPrototype.removeIn;%0A%09%20%20ListPrototype.update%20=%20MapPrototype.update;%0A%09%20%20ListPrototype.updateIn%20=%20MapPrototype.updateIn;%0A%09%20%20ListPrototype.mergeIn%20=%20MapPrototype.mergeIn;%0A%09%20%20ListPrototype.mergeDeepIn%20=%20MapPrototype.mergeDeepIn;%0A%09%20%20ListPrototype.withMutations%20=%20MapPrototype.withMutations;%0A%09%20%20ListPrototype.asMutable%20=%20MapPrototype.asMutable;%0A%09%20%20ListPrototype.asImmutable%20=%20MapPrototype.asImmutable;%0A%09%20%20ListPrototype.wasAltered%20=%20MapPrototype.wasAltered;%0A%0A%0A%0A%09%20%20%20%20function%20VNode(array,%20ownerID)%20%7B%0A%09%20%20%20%20%20%20this.array%20=%20array;%0A%09%20%20%20%20%20%20this.ownerID%20=%20ownerID;%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20//%20TODO:%20seems%20like%20these%20methods%20are%20very%20similar%0A%0A%09%20%20%20%20VNode.prototype.removeBefore%20=%20function(ownerID,%20level,%20index)%20%7B%0A%09%20%20%20%20%20%20if%20(index%20===%20level%20?%201%20%3C%3C%20level%20:%200%20%7C%7C%20this.array.length%20===%200)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20var%20originIndex%20=%20(index%20%3E%3E%3E%20level)%20&%20MASK;%0A%09%20%20%20%20%20%20if%20(originIndex%20%3E=%20this.array.length)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20new%20VNode(%5B%5D,%20ownerID);%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20var%20removingFirst%20=%20originIndex%20===%200;%0A%09%20%20%20%20%20%20var%20newChild;%0A%09%20%20%20%20%20%20if%20(level%20%3E%200)%20%7B%0A%09%20%20%20%20%20%20%20%20var%20oldChild%20=%20this.array%5BoriginIndex%5D;%0A%09%20%20%20%20%20%20%20%20newChild%20=%20oldChild%20&&%20oldChild.removeBefore(ownerID,%20level%20-%20SHIFT,%20index);%0A%09%20%20%20%20%20%20%20%20if%20(newChild%20===%20oldChild%20&&%20removingFirst)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20if%20(removingFirst%20&&%20!newChild)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20var%20editable%20=%20editableVNode(this,%20ownerID);%0A%09%20%20%20%20%20%20if%20(!removingFirst)%20%7B%0A%09%20%20%20%20%20%20%20%20for%20(var%20ii%20=%200;%20ii%20%3C%20originIndex;%20ii++)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20editable.array%5Bii%5D%20=%20undefined;%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20if%20(newChild)%20%7B%0A%09%20%20%20%20%20%20%20%20editable.array%5BoriginIndex%5D%20=%20newChild;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20editable;%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20VNode.prototype.removeAfter%20=%20function(ownerID,%20level,%20index)%20%7B%0A%09%20%20%20%20%20%20if%20(index%20===%20(level%20?%201%20%3C%3C%20level%20:%200)%20%7C%7C%20this.array.length%20===%200)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20var%20sizeIndex%20=%20((index%20-%201)%20%3E%3E%3E%20level)%20&%20MASK;%0A%09%20%20%20%20%20%20if%20(sizeIndex%20%3E=%20this.array.length)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%0A%09%20%20%20%20%20%20var%20newChild;%0A%09%20%20%20%20%20%20if%20(level%20%3E%200)%20%7B%0A%09%20%20%20%20%20%20%20%20var%20oldChild%20=%20this.array%5BsizeIndex%5D;%0A%09%20%20%20%20%20%20%20%20newChild%20=%20oldChild%20&&%20oldChild.removeAfter(ownerID,%20level%20-%20SHIFT,%20index);%0A%09%20%20%20%20%20%20%20%20if%20(newChild%20===%20oldChild%20&&%20sizeIndex%20===%20this.array.length%20-%201)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%7D%0A%0A%09%20%20%20%20%20%20var%20editable%20=%20editableVNode(this,%20ownerID);%0A%09%20%20%20%20%20%20editable.array.splice(sizeIndex%20+%201);%0A%09%20%20%20%20%20%20if%20(newChild)%20%7B%0A%09%20%20%20%20%20%20%20%20editable.array%5BsizeIndex%5D%20=%20newChild;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20editable;%0A%09%20%20%20%20%7D;%0A%0A%0A%0A%09%20%20var%20DONE%20=%20%7B%7D;%0A%0A%09%20%20function%20iterateList(list,%20reverse)%20%7B%0A%09%20%20%20%20var%20left%20=%20list._origin;%0A%09%20%20%20%20var%20right%20=%20list._capacity;%0A%09%20%20%20%20var%20tailPos%20=%20getTailOffset(right);%0A%09%20%20%20%20var%20tail%20=%20list._tail;%0A%0A%09%20%20%20%20return%20iterateNodeOrLeaf(list._root,%20list._level,%200);%0A%0A%09%20%20%20%20function%20iterateNodeOrLeaf(node,%20level,%20offset)%20%7B%0A%09%20%20%20%20%20%20return%20level%20===%200%20?%0A%09%20%20%20%20%20%20%20%20iterateLeaf(node,%20offset)%20:%0A%09%20%20%20%20%20%20%20%20iterateNode(node,%20level,%20offset);%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20function%20iterateLeaf(node,%20offset)%20%7B%0A%09%20%20%20%20%20%20var%20array%20=%20offset%20===%20tailPos%20?%20tail%20&&%20tail.array%20:%20node%20&&%20node.array;%0A%09%20%20%20%20%20%20var%20from%20=%20offset%20%3E%20left%20?%200%20:%20left%20-%20offset;%0A%09%20%20%20%20%20%20var%20to%20=%20right%20-%20offset;%0A%09%20%20%20%20%20%20if%20(to%20%3E%20SIZE)%20%7B%0A%09%20%20%20%20%20%20%20%20to%20=%20SIZE;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20function()%20%20%7B%0A%09%20%20%20%20%20%20%20%20if%20(from%20===%20to)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20return%20DONE;%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20var%20idx%20=%20reverse%20?%20--to%20:%20from++;%0A%09%20%20%20%20%20%20%20%20return%20array%20&&%20array%5Bidx%5D;%0A%09%20%20%20%20%20%20%7D;%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20function%20iterateNode(node,%20level,%20offset)%20%7B%0A%09%20%20%20%20%20%20var%20values;%0A%09%20%20%20%20%20%20var%20array%20=%20node%20&&%20node.array;%0A%09%20%20%20%20%20%20var%20from%20=%20offset%20%3E%20left%20?%200%20:%20(left%20-%20offset)%20%3E%3E%20level;%0A%09%20%20%20%20%20%20var%20to%20=%20((right%20-%20offset)%20%3E%3E%20level)%20+%201;%0A%09%20%20%20%20%20%20if%20(to%20%3E%20SIZE)%20%7B%0A%09%20%20%20%20%20%20%20%20to%20=%20SIZE;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20function()%20%20%7B%0A%09%20%20%20%20%20%20%20%20do%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20if%20(values)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20%20%20var%20value%20=%20values();%0A%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20!==%20DONE)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20value;%0A%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20%20%20%20%20values%20=%20null;%0A%09%20%20%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20%20%20if%20(from%20===%20to)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20%20%20return%20DONE;%0A%09%20%20%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20%20%20var%20idx%20=%20reverse%20?%20--to%20:%20from++;%0A%09%20%20%20%20%20%20%20%20%20%20values%20=%20iterateNodeOrLeaf(%0A%09%20%20%20%20%20%20%20%20%20%20%20%20array%20&&%20array%5Bidx%5D,%20level%20-%20SHIFT,%20offset%20+%20(idx%20%3C%3C%20level)%0A%09%20%20%20%20%20%20%20%20%20%20);%0A%09%20%20%20%20%20%20%20%20%7D%20while%20(true);%0A%09%20%20%20%20%20%20%7D;%0A%09%20%20%20%20%7D%0A%09%20%20%7D%0A%0A%09%20%20function%20makeList(origin,%20capacity,%20level,%20root,%20tail,%20ownerID,%20hash)%20%7B%0A%09%20%20%20%20var%20list%20=%20Object.create(ListPrototype);%0A%09%20%20%20%20list.size%20=%20capacity%20-%20origin;%0A%09%20%20%20%20list._origin%20=%20origin;%0A%09%20%20%20%20list._capacity%20=%20capacity;%0A%09%20%20%20%20list._level%20=%20level;%0A%09%20%20%20%20list._root%20=%20root;%0A%09%20%20%20%20list._tail%20=%20tail;%0A%09%20%20%20%20list.__ownerID%20=%20ownerID;%0A%09%20%20%20%20list.__hash%20=%20hash;%0A%09%20%20%20%20list.__altered%20=%20false;%0A%09%20%20%20%20return%20list;%0A%09%20%20%7D%0A%0A%09%20%20var%20EMPTY_LIST;%0A%09%20%20function%20emptyList()%20%7B%0A%09%20%20%20%20return%20EMPTY_LIST%20%7C%7C%20(EMPTY_LIST%20=%20makeList(0,%200,%20SHIFT));%0A%09%20%20%7D%0A%0A%09%20%20function%20updateList(list,%20index,%20value)%20%7B%0A%09%20%20%20%20index%20=%20wrapIndex(list,%20index);%0A%0A%09%20%20%20%20if%20(index%20!==%20index)%20%7B%0A%09%20%20%20%20%20%20return%20list;%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20if%20(index%20%3E=%20list.size%20%7C%7C%20index%20%3C%200)%20%7B%0A%09%20%20%20%20%20%20return%20list.withMutations(function(list%20)%20%7B%0A%09%20%20%20%20%20%20%20%20index%20%3C%200%20?%0A%09%20%20%20%20%20%20%20%20%20%20setListBounds(list,%20index).set(0,%20value)%20:%0A%09%20%20%20%20%20%20%20%20%20%20setListBounds(list,%200,%20index%20+%201).set(index,%20value)%0A%09%20%20%20%20%20%20%7D);%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20index%20+=%20list._origin;%0A%0A%09%20%20%20%20var%20newTail%20=%20list._tail;%0A%09%20%20%20%20var%20newRoot%20=%20list._root;%0A%09%20%20%20%20var%20didAlter%20=%20MakeRef(DID_ALTER);%0A%09%20%20%20%20if%20(index%20%3E=%20getTailOffset(list._capacity))%20%7B%0A%09%20%20%20%20%20%20newTail%20=%20updateVNode(newTail,%20list.__ownerID,%200,%20index,%20value,%20didAlter);%0A%09%20%20%20%20%7D%20else%20%7B%0A%09%20%20%20%20%20%20newRoot%20=%20updateVNode(newRoot,%20list.__ownerID,%20list._level,%20index,%20value,%20didAlter);%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20if%20(!didAlter.value)%20%7B%0A%09%20%20%20%20%20%20return%20list;%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20if%20(list.__ownerID)%20%7B%0A%09%20%20%20%20%20%20list._root%20=%20newRoot;%0A%09%20%20%20%20%20%20list._tail%20=%20newTail;%0A%09%20%20%20%20%20%20list.__hash%20=%20undefined;%0A%09%20%20%20%20%20%20list.__altered%20=%20true;%0A%09%20%20%20%20%20%20return%20list;%0A%09%20%20%20%20%7D%0A%09%20%20%20%20return%20makeList(list._origin,%20list._capacity,%20list._level,%20newRoot,%20newTail);%0A%09%20%20%7D%0A%0A%09%20%20function%20updateVNode(node,%20ownerID,%20level,%20index,%20value,%20didAlter)%20%7B%0A%09%20%20%20%20var%20idx%20=%20(index%20%3E%3E%3E%20level)%20&%20MASK;%0A%09%20%20%20%20var%20nodeHas%20=%20node%20&&%20idx%20%3C%20node.array.length;%0A%09%20%20%20%20if%20(!nodeHas%20&&%20value%20===%20undefined)%20%7B%0A%09%20%20%20%20%20%20return%20node;%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20var%20newNode;%0A%0A%09%20%20%20%20if%20(level%20%3E%200)%20%7B%0A%09%20%20%20%20%20%20var%20lowerNode%20=%20node%20&&%20node.array%5Bidx%5D;%0A%09%20%20%20%20%20%20var%20newLowerNode%20=%20updateVNode(lowerNode,%20ownerID,%20level%20-%20SHIFT,%20index,%20value,%20didAlter);%0A%09%20%20%20%20%20%20if%20(newLowerNode%20===%20lowerNode)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20node;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20newNode%20=%20editableVNode(node,%20ownerID);%0A%09%20%20%20%20%20%20newNode.array%5Bidx%5D%20=%20newLowerNode;%0A%09%20%20%20%20%20%20return%20newNode;%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20if%20(nodeHas%20&&%20node.array%5Bidx%5D%20===%20value)%20%7B%0A%09%20%20%20%20%20%20return%20node;%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20SetRef(didAlter);%0A%0A%09%20%20%20%20newNode%20=%20editableVNode(node,%20ownerID);%0A%09%20%20%20%20if%20(value%20===%20undefined%20&&%20idx%20===%20newNode.array.length%20-%201)%20%7B%0A%09%20%20%20%20%20%20newNode.array.pop();%0A%09%20%20%20%20%7D%20else%20%7B%0A%09%20%20%20%20%20%20newNode.array%5Bidx%5D%20=%20value;%0A%09%20%20%20%20%7D%0A%09%20%20%20%20return%20newNode;%0A%09%20%20%7D%0A%0A%09%20%20function%20editableVNode(node,%20ownerID)%20%7B%0A%09%20%20%20%20if%20(ownerID%20&&%20node%20&&%20ownerID%20===%20node.ownerID)%20%7B%0A%09%20%20%20%20%20%20return%20node;%0A%09%20%20%20%20%7D%0A%09%20%20%20%20return%20new%20VNode(node%20?%20node.array.slice()%20:%20%5B%5D,%20ownerID);%0A%09%20%20%7D%0A%0A%09%20%20function%20listNodeFor(list,%20rawIndex)%20%7B%0A%09%20%20%20%20if%20(rawIndex%20%3E=%20getTailOffset(list._capacity))%20%7B%0A%09%20%20%20%20%20%20return%20list._tail;%0A%09%20%20%20%20%7D%0A%09%20%20%20%20if%20(rawIndex%20%3C%201%20%3C%3C%20(list._level%20+%20SHIFT))%20%7B%0A%09%20%20%20%20%20%20var%20node%20=%20list._root;%0A%09%20%20%20%20%20%20var%20level%20=%20list._level;%0A%09%20%20%20%20%20%20while%20(node%20&&%20level%20%3E%200)%20%7B%0A%09%20%20%20%20%20%20%20%20node%20=%20node.array%5B(rawIndex%20%3E%3E%3E%20level)%20&%20MASK%5D;%0A%09%20%20%20%20%20%20%20%20level%20-=%20SHIFT;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20node;%0A%09%20%20%20%20%7D%0A%09%20%20%7D%0A%0A%09%20%20function%20setListBounds(list,%20begin,%20end)%20%7B%0A%09%20%20%20%20//%20Sanitize%20begin%20&%20end%20using%20this%20shorthand%20for%20ToInt32(argument)%0A%09%20%20%20%20//%20http://www.ecma-international.org/ecma-262/6.0/#sec-toint32%0A%09%20%20%20%20if%20(begin%20!==%20undefined)%20%7B%0A%09%20%20%20%20%20%20begin%20=%20begin%20%7C%200;%0A%09%20%20%20%20%7D%0A%09%20%20%20%20if%20(end%20!==%20undefined)%20%7B%0A%09%20%20%20%20%20%20end%20=%20end%20%7C%200;%0A%09%20%20%20%20%7D%0A%09%20%20%20%20var%20owner%20=%20list.__ownerID%20%7C%7C%20new%20OwnerID();%0A%09%20%20%20%20var%20oldOrigin%20=%20list._origin;%0A%09%20%20%20%20var%20oldCapacity%20=%20list._capacity;%0A%09%20%20%20%20var%20newOrigin%20=%20oldOrigin%20+%20begin;%0A%09%20%20%20%20var%20newCapacity%20=%20end%20===%20undefined%20?%20oldCapacity%20:%20end%20%3C%200%20?%20oldCapacity%20+%20end%20:%20oldOrigin%20+%20end;%0A%09%20%20%20%20if%20(newOrigin%20===%20oldOrigin%20&&%20newCapacity%20===%20oldCapacity)%20%7B%0A%09%20%20%20%20%20%20return%20list;%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20//%20If%20it's%20going%20to%20end%20after%20it%20starts,%20it's%20empty.%0A%09%20%20%20%20if%20(newOrigin%20%3E=%20newCapacity)%20%7B%0A%09%20%20%20%20%20%20return%20list.clear();%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20var%20newLevel%20=%20list._level;%0A%09%20%20%20%20var%20newRoot%20=%20list._root;%0A%0A%09%20%20%20%20//%20New%20origin%20might%20need%20creating%20a%20higher%20root.%0A%09%20%20%20%20var%20offsetShift%20=%200;%0A%09%20%20%20%20while%20(newOrigin%20+%20offsetShift%20%3C%200)%20%7B%0A%09%20%20%20%20%20%20newRoot%20=%20new%20VNode(newRoot%20&&%20newRoot.array.length%20?%20%5Bundefined,%20newRoot%5D%20:%20%5B%5D,%20owner);%0A%09%20%20%20%20%20%20newLevel%20+=%20SHIFT;%0A%09%20%20%20%20%20%20offsetShift%20+=%201%20%3C%3C%20newLevel;%0A%09%20%20%20%20%7D%0A%09%20%20%20%20if%20(offsetShift)%20%7B%0A%09%20%20%20%20%20%20newOrigin%20+=%20offsetShift;%0A%09%20%20%20%20%20%20oldOrigin%20+=%20offsetShift;%0A%09%20%20%20%20%20%20newCapacity%20+=%20offsetShift;%0A%09%20%20%20%20%20%20oldCapacity%20+=%20offsetShift;%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20var%20oldTailOffset%20=%20getTailOffset(oldCapacity);%0A%09%20%20%20%20var%20newTailOffset%20=%20getTailOffset(newCapacity);%0A%0A%09%20%20%20%20//%20New%20size%20might%20need%20creating%20a%20higher%20root.%0A%09%20%20%20%20while%20(newTailOffset%20%3E=%201%20%3C%3C%20(newLevel%20+%20SHIFT))%20%7B%0A%09%20%20%20%20%20%20newRoot%20=%20new%20VNode(newRoot%20&&%20newRoot.array.length%20?%20%5BnewRoot%5D%20:%20%5B%5D,%20owner);%0A%09%20%20%20%20%20%20newLevel%20+=%20SHIFT;%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20//%20Locate%20or%20create%20the%20new%20tail.%0A%09%20%20%20%20var%20oldTail%20=%20list._tail;%0A%09%20%20%20%20var%20newTail%20=%20newTailOffset%20%3C%20oldTailOffset%20?%0A%09%20%20%20%20%20%20listNodeFor(list,%20newCapacity%20-%201)%20:%0A%09%20%20%20%20%20%20newTailOffset%20%3E%20oldTailOffset%20?%20new%20VNode(%5B%5D,%20owner)%20:%20oldTail;%0A%0A%09%20%20%20%20//%20Merge%20Tail%20into%20tree.%0A%09%20%20%20%20if%20(oldTail%20&&%20newTailOffset%20%3E%20oldTailOffset%20&&%20newOrigin%20%3C%20oldCapacity%20&&%20oldTail.array.length)%20%7B%0A%09%20%20%20%20%20%20newRoot%20=%20editableVNode(newRoot,%20owner);%0A%09%20%20%20%20%20%20var%20node%20=%20newRoot;%0A%09%20%20%20%20%20%20for%20(var%20level%20=%20newLevel;%20level%20%3E%20SHIFT;%20level%20-=%20SHIFT)%20%7B%0A%09%20%20%20%20%20%20%20%20var%20idx%20=%20(oldTailOffset%20%3E%3E%3E%20level)%20&%20MASK;%0A%09%20%20%20%20%20%20%20%20node%20=%20node.array%5Bidx%5D%20=%20editableVNode(node.array%5Bidx%5D,%20owner);%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20node.array%5B(oldTailOffset%20%3E%3E%3E%20SHIFT)%20&%20MASK%5D%20=%20oldTail;%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20//%20If%20the%20size%20has%20been%20reduced,%20there's%20a%20chance%20the%20tail%20needs%20to%20be%20trimmed.%0A%09%20%20%20%20if%20(newCapacity%20%3C%20oldCapacity)%20%7B%0A%09%20%20%20%20%20%20newTail%20=%20newTail%20&&%20newTail.removeAfter(owner,%200,%20newCapacity);%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20//%20If%20the%20new%20origin%20is%20within%20the%20tail,%20then%20we%20do%20not%20need%20a%20root.%0A%09%20%20%20%20if%20(newOrigin%20%3E=%20newTailOffset)%20%7B%0A%09%20%20%20%20%20%20newOrigin%20-=%20newTailOffset;%0A%09%20%20%20%20%20%20newCapacity%20-=%20newTailOffset;%0A%09%20%20%20%20%20%20newLevel%20=%20SHIFT;%0A%09%20%20%20%20%20%20newRoot%20=%20null;%0A%09%20%20%20%20%20%20newTail%20=%20newTail%20&&%20newTail.removeBefore(owner,%200,%20newOrigin);%0A%0A%09%20%20%20%20//%20Otherwise,%20if%20the%20root%20has%20been%20trimmed,%20garbage%20collect.%0A%09%20%20%20%20%7D%20else%20if%20(newOrigin%20%3E%20oldOrigin%20%7C%7C%20newTailOffset%20%3C%20oldTailOffset)%20%7B%0A%09%20%20%20%20%20%20offsetShift%20=%200;%0A%0A%09%20%20%20%20%20%20//%20Identify%20the%20new%20top%20root%20node%20of%20the%20subtree%20of%20the%20old%20root.%0A%09%20%20%20%20%20%20while%20(newRoot)%20%7B%0A%09%20%20%20%20%20%20%20%20var%20beginIndex%20=%20(newOrigin%20%3E%3E%3E%20newLevel)%20&%20MASK;%0A%09%20%20%20%20%20%20%20%20if%20(beginIndex%20!==%20(newTailOffset%20%3E%3E%3E%20newLevel)%20&%20MASK)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20break;%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20if%20(beginIndex)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20offsetShift%20+=%20(1%20%3C%3C%20newLevel)%20*%20beginIndex;%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20newLevel%20-=%20SHIFT;%0A%09%20%20%20%20%20%20%20%20newRoot%20=%20newRoot.array%5BbeginIndex%5D;%0A%09%20%20%20%20%20%20%7D%0A%0A%09%20%20%20%20%20%20//%20Trim%20the%20new%20sides%20of%20the%20new%20root.%0A%09%20%20%20%20%20%20if%20(newRoot%20&&%20newOrigin%20%3E%20oldOrigin)%20%7B%0A%09%20%20%20%20%20%20%20%20newRoot%20=%20newRoot.removeBefore(owner,%20newLevel,%20newOrigin%20-%20offsetShift);%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20if%20(newRoot%20&&%20newTailOffset%20%3C%20oldTailOffset)%20%7B%0A%09%20%20%20%20%20%20%20%20newRoot%20=%20newRoot.removeAfter(owner,%20newLevel,%20newTailOffset%20-%20offsetShift);%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20if%20(offsetShift)%20%7B%0A%09%20%20%20%20%20%20%20%20newOrigin%20-=%20offsetShift;%0A%09%20%20%20%20%20%20%20%20newCapacity%20-=%20offsetShift;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20if%20(list.__ownerID)%20%7B%0A%09%20%20%20%20%20%20list.size%20=%20newCapacity%20-%20newOrigin;%0A%09%20%20%20%20%20%20list._origin%20=%20newOrigin;%0A%09%20%20%20%20%20%20list._capacity%20=%20newCapacity;%0A%09%20%20%20%20%20%20list._level%20=%20newLevel;%0A%09%20%20%20%20%20%20list._root%20=%20newRoot;%0A%09%20%20%20%20%20%20list._tail%20=%20newTail;%0A%09%20%20%20%20%20%20list.__hash%20=%20undefined;%0A%09%20%20%20%20%20%20list.__altered%20=%20true;%0A%09%20%20%20%20%20%20return%20list;%0A%09%20%20%20%20%7D%0A%09%20%20%20%20return%20makeList(newOrigin,%20newCapacity,%20newLevel,%20newRoot,%20newTail);%0A%09%20%20%7D%0A%0A%09%20%20function%20mergeIntoListWith(list,%20merger,%20iterables)%20%7B%0A%09%20%20%20%20var%20iters%20=%20%5B%5D;%0A%09%20%20%20%20var%20maxSize%20=%200;%0A%09%20%20%20%20for%20(var%20ii%20=%200;%20ii%20%3C%20iterables.length;%20ii++)%20%7B%0A%09%20%20%20%20%20%20var%20value%20=%20iterables%5Bii%5D;%0A%09%20%20%20%20%20%20var%20iter%20=%20IndexedIterable(value);%0A%09%20%20%20%20%20%20if%20(iter.size%20%3E%20maxSize)%20%7B%0A%09%20%20%20%20%20%20%20%20maxSize%20=%20iter.size;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20if%20(!isIterable(value))%20%7B%0A%09%20%20%20%20%20%20%20%20iter%20=%20iter.map(function(v%20)%20%7Breturn%20fromJS(v)%7D);%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20iters.push(iter);%0A%09%20%20%20%20%7D%0A%09%20%20%20%20if%20(maxSize%20%3E%20list.size)%20%7B%0A%09%20%20%20%20%20%20list%20=%20list.setSize(maxSize);%0A%09%20%20%20%20%7D%0A%09%20%20%20%20return%20mergeIntoCollectionWith(list,%20merger,%20iters);%0A%09%20%20%7D%0A%0A%09%20%20function%20getTailOffset(size)%20%7B%0A%09%20%20%20%20return%20size%20%3C%20SIZE%20?%200%20:%20(((size%20-%201)%20%3E%3E%3E%20SHIFT)%20%3C%3C%20SHIFT);%0A%09%20%20%7D%0A%0A%09%20%20createClass(OrderedMap,%20Map);%0A%0A%09%20%20%20%20//%20@pragma%20Construction%0A%0A%09%20%20%20%20function%20OrderedMap(value)%20%7B%0A%09%20%20%20%20%20%20return%20value%20===%20null%20%7C%7C%20value%20===%20undefined%20?%20emptyOrderedMap()%20:%0A%09%20%20%20%20%20%20%20%20isOrderedMap(value)%20?%20value%20:%0A%09%20%20%20%20%20%20%20%20emptyOrderedMap().withMutations(function(map%20)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20var%20iter%20=%20KeyedIterable(value);%0A%09%20%20%20%20%20%20%20%20%20%20assertNotInfinite(iter.size);%0A%09%20%20%20%20%20%20%20%20%20%20iter.forEach(function(v,%20k)%20%20%7Breturn%20map.set(k,%20v)%7D);%0A%09%20%20%20%20%20%20%20%20%7D);%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20OrderedMap.of%20=%20function(/*...values*/)%20%7B%0A%09%20%20%20%20%20%20return%20this(arguments);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20OrderedMap.prototype.toString%20=%20function()%20%7B%0A%09%20%20%20%20%20%20return%20this.__toString('OrderedMap%20%7B',%20'%7D');%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20//%20@pragma%20Access%0A%0A%09%20%20%20%20OrderedMap.prototype.get%20=%20function(k,%20notSetValue)%20%7B%0A%09%20%20%20%20%20%20var%20index%20=%20this._map.get(k);%0A%09%20%20%20%20%20%20return%20index%20!==%20undefined%20?%20this._list.get(index)%5B1%5D%20:%20notSetValue;%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20//%20@pragma%20Modification%0A%0A%09%20%20%20%20OrderedMap.prototype.clear%20=%20function()%20%7B%0A%09%20%20%20%20%20%20if%20(this.size%20===%200)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20if%20(this.__ownerID)%20%7B%0A%09%20%20%20%20%20%20%20%20this.size%20=%200;%0A%09%20%20%20%20%20%20%20%20this._map.clear();%0A%09%20%20%20%20%20%20%20%20this._list.clear();%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20emptyOrderedMap();%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20OrderedMap.prototype.set%20=%20function(k,%20v)%20%7B%0A%09%20%20%20%20%20%20return%20updateOrderedMap(this,%20k,%20v);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20OrderedMap.prototype.remove%20=%20function(k)%20%7B%0A%09%20%20%20%20%20%20return%20updateOrderedMap(this,%20k,%20NOT_SET);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20OrderedMap.prototype.wasAltered%20=%20function()%20%7B%0A%09%20%20%20%20%20%20return%20this._map.wasAltered()%20%7C%7C%20this._list.wasAltered();%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20OrderedMap.prototype.__iterate%20=%20function(fn,%20reverse)%20%7Bvar%20this$0%20=%20this;%0A%09%20%20%20%20%20%20return%20this._list.__iterate(%0A%09%20%20%20%20%20%20%20%20function(entry%20)%20%7Breturn%20entry%20&&%20fn(entry%5B1%5D,%20entry%5B0%5D,%20this$0)%7D,%0A%09%20%20%20%20%20%20%20%20reverse%0A%09%20%20%20%20%20%20);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20OrderedMap.prototype.__iterator%20=%20function(type,%20reverse)%20%7B%0A%09%20%20%20%20%20%20return%20this._list.fromEntrySeq().__iterator(type,%20reverse);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20OrderedMap.prototype.__ensureOwner%20=%20function(ownerID)%20%7B%0A%09%20%20%20%20%20%20if%20(ownerID%20===%20this.__ownerID)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20var%20newMap%20=%20this._map.__ensureOwner(ownerID);%0A%09%20%20%20%20%20%20var%20newList%20=%20this._list.__ensureOwner(ownerID);%0A%09%20%20%20%20%20%20if%20(!ownerID)%20%7B%0A%09%20%20%20%20%20%20%20%20this.__ownerID%20=%20ownerID;%0A%09%20%20%20%20%20%20%20%20this._map%20=%20newMap;%0A%09%20%20%20%20%20%20%20%20this._list%20=%20newList;%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20makeOrderedMap(newMap,%20newList,%20ownerID,%20this.__hash);%0A%09%20%20%20%20%7D;%0A%0A%0A%09%20%20function%20isOrderedMap(maybeOrderedMap)%20%7B%0A%09%20%20%20%20return%20isMap(maybeOrderedMap)%20&&%20isOrdered(maybeOrderedMap);%0A%09%20%20%7D%0A%0A%09%20%20OrderedMap.isOrderedMap%20=%20isOrderedMap;%0A%0A%09%20%20OrderedMap.prototype%5BIS_ORDERED_SENTINEL%5D%20=%20true;%0A%09%20%20OrderedMap.prototype%5BDELETE%5D%20=%20OrderedMap.prototype.remove;%0A%0A%0A%0A%09%20%20function%20makeOrderedMap(map,%20list,%20ownerID,%20hash)%20%7B%0A%09%20%20%20%20var%20omap%20=%20Object.create(OrderedMap.prototype);%0A%09%20%20%20%20omap.size%20=%20map%20?%20map.size%20:%200;%0A%09%20%20%20%20omap._map%20=%20map;%0A%09%20%20%20%20omap._list%20=%20list;%0A%09%20%20%20%20omap.__ownerID%20=%20ownerID;%0A%09%20%20%20%20omap.__hash%20=%20hash;%0A%09%20%20%20%20return%20omap;%0A%09%20%20%7D%0A%0A%09%20%20var%20EMPTY_ORDERED_MAP;%0A%09%20%20function%20emptyOrderedMap()%20%7B%0A%09%20%20%20%20return%20EMPTY_ORDERED_MAP%20%7C%7C%20(EMPTY_ORDERED_MAP%20=%20makeOrderedMap(emptyMap(),%20emptyList()));%0A%09%20%20%7D%0A%0A%09%20%20function%20updateOrderedMap(omap,%20k,%20v)%20%7B%0A%09%20%20%20%20var%20map%20=%20omap._map;%0A%09%20%20%20%20var%20list%20=%20omap._list;%0A%09%20%20%20%20var%20i%20=%20map.get(k);%0A%09%20%20%20%20var%20has%20=%20i%20!==%20undefined;%0A%09%20%20%20%20var%20newMap;%0A%09%20%20%20%20var%20newList;%0A%09%20%20%20%20if%20(v%20===%20NOT_SET)%20%7B%20//%20removed%0A%09%20%20%20%20%20%20if%20(!has)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20omap;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20if%20(list.size%20%3E=%20SIZE%20&&%20list.size%20%3E=%20map.size%20*%202)%20%7B%0A%09%20%20%20%20%20%20%20%20newList%20=%20list.filter(function(entry,%20idx)%20%20%7Breturn%20entry%20!==%20undefined%20&&%20i%20!==%20idx%7D);%0A%09%20%20%20%20%20%20%20%20newMap%20=%20newList.toKeyedSeq().map(function(entry%20)%20%7Breturn%20entry%5B0%5D%7D).flip().toMap();%0A%09%20%20%20%20%20%20%20%20if%20(omap.__ownerID)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20newMap.__ownerID%20=%20newList.__ownerID%20=%20omap.__ownerID;%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%7D%20else%20%7B%0A%09%20%20%20%20%20%20%20%20newMap%20=%20map.remove(k);%0A%09%20%20%20%20%20%20%20%20newList%20=%20i%20===%20list.size%20-%201%20?%20list.pop()%20:%20list.set(i,%20undefined);%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%7D%20else%20%7B%0A%09%20%20%20%20%20%20if%20(has)%20%7B%0A%09%20%20%20%20%20%20%20%20if%20(v%20===%20list.get(i)%5B1%5D)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20return%20omap;%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20newMap%20=%20map;%0A%09%20%20%20%20%20%20%20%20newList%20=%20list.set(i,%20%5Bk,%20v%5D);%0A%09%20%20%20%20%20%20%7D%20else%20%7B%0A%09%20%20%20%20%20%20%20%20newMap%20=%20map.set(k,%20list.size);%0A%09%20%20%20%20%20%20%20%20newList%20=%20list.set(list.size,%20%5Bk,%20v%5D);%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%7D%0A%09%20%20%20%20if%20(omap.__ownerID)%20%7B%0A%09%20%20%20%20%20%20omap.size%20=%20newMap.size;%0A%09%20%20%20%20%20%20omap._map%20=%20newMap;%0A%09%20%20%20%20%20%20omap._list%20=%20newList;%0A%09%20%20%20%20%20%20omap.__hash%20=%20undefined;%0A%09%20%20%20%20%20%20return%20omap;%0A%09%20%20%20%20%7D%0A%09%20%20%20%20return%20makeOrderedMap(newMap,%20newList);%0A%09%20%20%7D%0A%0A%09%20%20createClass(ToKeyedSequence,%20KeyedSeq);%0A%09%20%20%20%20function%20ToKeyedSequence(indexed,%20useKeys)%20%7B%0A%09%20%20%20%20%20%20this._iter%20=%20indexed;%0A%09%20%20%20%20%20%20this._useKeys%20=%20useKeys;%0A%09%20%20%20%20%20%20this.size%20=%20indexed.size;%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20ToKeyedSequence.prototype.get%20=%20function(key,%20notSetValue)%20%7B%0A%09%20%20%20%20%20%20return%20this._iter.get(key,%20notSetValue);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20ToKeyedSequence.prototype.has%20=%20function(key)%20%7B%0A%09%20%20%20%20%20%20return%20this._iter.has(key);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20ToKeyedSequence.prototype.valueSeq%20=%20function()%20%7B%0A%09%20%20%20%20%20%20return%20this._iter.valueSeq();%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20ToKeyedSequence.prototype.reverse%20=%20function()%20%7Bvar%20this$0%20=%20this;%0A%09%20%20%20%20%20%20var%20reversedSequence%20=%20reverseFactory(this,%20true);%0A%09%20%20%20%20%20%20if%20(!this._useKeys)%20%7B%0A%09%20%20%20%20%20%20%20%20reversedSequence.valueSeq%20=%20function()%20%20%7Breturn%20this$0._iter.toSeq().reverse()%7D;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20reversedSequence;%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20ToKeyedSequence.prototype.map%20=%20function(mapper,%20context)%20%7Bvar%20this$0%20=%20this;%0A%09%20%20%20%20%20%20var%20mappedSequence%20=%20mapFactory(this,%20mapper,%20context);%0A%09%20%20%20%20%20%20if%20(!this._useKeys)%20%7B%0A%09%20%20%20%20%20%20%20%20mappedSequence.valueSeq%20=%20function()%20%20%7Breturn%20this$0._iter.toSeq().map(mapper,%20context)%7D;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20mappedSequence;%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20ToKeyedSequence.prototype.__iterate%20=%20function(fn,%20reverse)%20%7Bvar%20this$0%20=%20this;%0A%09%20%20%20%20%20%20var%20ii;%0A%09%20%20%20%20%20%20return%20this._iter.__iterate(%0A%09%20%20%20%20%20%20%20%20this._useKeys%20?%0A%09%20%20%20%20%20%20%20%20%20%20function(v,%20k)%20%20%7Breturn%20fn(v,%20k,%20this$0)%7D%20:%0A%09%20%20%20%20%20%20%20%20%20%20((ii%20=%20reverse%20?%20resolveSize(this)%20:%200),%0A%09%20%20%20%20%20%20%20%20%20%20%20%20function(v%20)%20%7Breturn%20fn(v,%20reverse%20?%20--ii%20:%20ii++,%20this$0)%7D),%0A%09%20%20%20%20%20%20%20%20reverse%0A%09%20%20%20%20%20%20);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20ToKeyedSequence.prototype.__iterator%20=%20function(type,%20reverse)%20%7B%0A%09%20%20%20%20%20%20if%20(this._useKeys)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this._iter.__iterator(type,%20reverse);%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20var%20iterator%20=%20this._iter.__iterator(ITERATE_VALUES,%20reverse);%0A%09%20%20%20%20%20%20var%20ii%20=%20reverse%20?%20resolveSize(this)%20:%200;%0A%09%20%20%20%20%20%20return%20new%20Iterator(function()%20%20%7B%0A%09%20%20%20%20%20%20%20%20var%20step%20=%20iterator.next();%0A%09%20%20%20%20%20%20%20%20return%20step.done%20?%20step%20:%0A%09%20%20%20%20%20%20%20%20%20%20iteratorValue(type,%20reverse%20?%20--ii%20:%20ii++,%20step.value,%20step);%0A%09%20%20%20%20%20%20%7D);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20ToKeyedSequence.prototype%5BIS_ORDERED_SENTINEL%5D%20=%20true;%0A%0A%0A%09%20%20createClass(ToIndexedSequence,%20IndexedSeq);%0A%09%20%20%20%20function%20ToIndexedSequence(iter)%20%7B%0A%09%20%20%20%20%20%20this._iter%20=%20iter;%0A%09%20%20%20%20%20%20this.size%20=%20iter.size;%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20ToIndexedSequence.prototype.includes%20=%20function(value)%20%7B%0A%09%20%20%20%20%20%20return%20this._iter.includes(value);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20ToIndexedSequence.prototype.__iterate%20=%20function(fn,%20reverse)%20%7Bvar%20this$0%20=%20this;%0A%09%20%20%20%20%20%20var%20iterations%20=%200;%0A%09%20%20%20%20%20%20return%20this._iter.__iterate(function(v%20)%20%7Breturn%20fn(v,%20iterations++,%20this$0)%7D,%20reverse);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20ToIndexedSequence.prototype.__iterator%20=%20function(type,%20reverse)%20%7B%0A%09%20%20%20%20%20%20var%20iterator%20=%20this._iter.__iterator(ITERATE_VALUES,%20reverse);%0A%09%20%20%20%20%20%20var%20iterations%20=%200;%0A%09%20%20%20%20%20%20return%20new%20Iterator(function()%20%20%7B%0A%09%20%20%20%20%20%20%20%20var%20step%20=%20iterator.next();%0A%09%20%20%20%20%20%20%20%20return%20step.done%20?%20step%20:%0A%09%20%20%20%20%20%20%20%20%20%20iteratorValue(type,%20iterations++,%20step.value,%20step)%0A%09%20%20%20%20%20%20%7D);%0A%09%20%20%20%20%7D;%0A%0A%0A%0A%09%20%20createClass(ToSetSequence,%20SetSeq);%0A%09%20%20%20%20function%20ToSetSequence(iter)%20%7B%0A%09%20%20%20%20%20%20this._iter%20=%20iter;%0A%09%20%20%20%20%20%20this.size%20=%20iter.size;%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20ToSetSequence.prototype.has%20=%20function(key)%20%7B%0A%09%20%20%20%20%20%20return%20this._iter.includes(key);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20ToSetSequence.prototype.__iterate%20=%20function(fn,%20reverse)%20%7Bvar%20this$0%20=%20this;%0A%09%20%20%20%20%20%20return%20this._iter.__iterate(function(v%20)%20%7Breturn%20fn(v,%20v,%20this$0)%7D,%20reverse);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20ToSetSequence.prototype.__iterator%20=%20function(type,%20reverse)%20%7B%0A%09%20%20%20%20%20%20var%20iterator%20=%20this._iter.__iterator(ITERATE_VALUES,%20reverse);%0A%09%20%20%20%20%20%20return%20new%20Iterator(function()%20%20%7B%0A%09%20%20%20%20%20%20%20%20var%20step%20=%20iterator.next();%0A%09%20%20%20%20%20%20%20%20return%20step.done%20?%20step%20:%0A%09%20%20%20%20%20%20%20%20%20%20iteratorValue(type,%20step.value,%20step.value,%20step);%0A%09%20%20%20%20%20%20%7D);%0A%09%20%20%20%20%7D;%0A%0A%0A%0A%09%20%20createClass(FromEntriesSequence,%20KeyedSeq);%0A%09%20%20%20%20function%20FromEntriesSequence(entries)%20%7B%0A%09%20%20%20%20%20%20this._iter%20=%20entries;%0A%09%20%20%20%20%20%20this.size%20=%20entries.size;%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20FromEntriesSequence.prototype.entrySeq%20=%20function()%20%7B%0A%09%20%20%20%20%20%20return%20this._iter.toSeq();%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20FromEntriesSequence.prototype.__iterate%20=%20function(fn,%20reverse)%20%7Bvar%20this$0%20=%20this;%0A%09%20%20%20%20%20%20return%20this._iter.__iterate(function(entry%20)%20%7B%0A%09%20%20%20%20%20%20%20%20//%20Check%20if%20entry%20exists%20first%20so%20array%20access%20doesn't%20throw%20for%20holes%0A%09%20%20%20%20%20%20%20%20//%20in%20the%20parent%20iteration.%0A%09%20%20%20%20%20%20%20%20if%20(entry)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20validateEntry(entry);%0A%09%20%20%20%20%20%20%20%20%20%20var%20indexedIterable%20=%20isIterable(entry);%0A%09%20%20%20%20%20%20%20%20%20%20return%20fn(%0A%09%20%20%20%20%20%20%20%20%20%20%20%20indexedIterable%20?%20entry.get(1)%20:%20entry%5B1%5D,%0A%09%20%20%20%20%20%20%20%20%20%20%20%20indexedIterable%20?%20entry.get(0)%20:%20entry%5B0%5D,%0A%09%20%20%20%20%20%20%20%20%20%20%20%20this$0%0A%09%20%20%20%20%20%20%20%20%20%20);%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%7D,%20reverse);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20FromEntriesSequence.prototype.__iterator%20=%20function(type,%20reverse)%20%7B%0A%09%20%20%20%20%20%20var%20iterator%20=%20this._iter.__iterator(ITERATE_VALUES,%20reverse);%0A%09%20%20%20%20%20%20return%20new%20Iterator(function()%20%20%7B%0A%09%20%20%20%20%20%20%20%20while%20(true)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20var%20step%20=%20iterator.next();%0A%09%20%20%20%20%20%20%20%20%20%20if%20(step.done)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20%20%20return%20step;%0A%09%20%20%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20%20%20var%20entry%20=%20step.value;%0A%09%20%20%20%20%20%20%20%20%20%20//%20Check%20if%20entry%20exists%20first%20so%20array%20access%20doesn't%20throw%20for%20holes%0A%09%20%20%20%20%20%20%20%20%20%20//%20in%20the%20parent%20iteration.%0A%09%20%20%20%20%20%20%20%20%20%20if%20(entry)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20%20%20validateEntry(entry);%0A%09%20%20%20%20%20%20%20%20%20%20%20%20var%20indexedIterable%20=%20isIterable(entry);%0A%09%20%20%20%20%20%20%20%20%20%20%20%20return%20iteratorValue(%0A%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20type,%0A%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20indexedIterable%20?%20entry.get(0)%20:%20entry%5B0%5D,%0A%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20indexedIterable%20?%20entry.get(1)%20:%20entry%5B1%5D,%0A%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20step%0A%09%20%20%20%20%20%20%20%20%20%20%20%20);%0A%09%20%20%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%7D);%0A%09%20%20%20%20%7D;%0A%0A%0A%09%20%20ToIndexedSequence.prototype.cacheResult%20=%0A%09%20%20ToKeyedSequence.prototype.cacheResult%20=%0A%09%20%20ToSetSequence.prototype.cacheResult%20=%0A%09%20%20FromEntriesSequence.prototype.cacheResult%20=%0A%09%20%20%20%20cacheResultThrough;%0A%0A%0A%09%20%20function%20flipFactory(iterable)%20%7B%0A%09%20%20%20%20var%20flipSequence%20=%20makeSequence(iterable);%0A%09%20%20%20%20flipSequence._iter%20=%20iterable;%0A%09%20%20%20%20flipSequence.size%20=%20iterable.size;%0A%09%20%20%20%20flipSequence.flip%20=%20function()%20%20%7Breturn%20iterable%7D;%0A%09%20%20%20%20flipSequence.reverse%20=%20function%20()%20%7B%0A%09%20%20%20%20%20%20var%20reversedSequence%20=%20iterable.reverse.apply(this);%20//%20super.reverse()%0A%09%20%20%20%20%20%20reversedSequence.flip%20=%20function()%20%20%7Breturn%20iterable.reverse()%7D;%0A%09%20%20%20%20%20%20return%20reversedSequence;%0A%09%20%20%20%20%7D;%0A%09%20%20%20%20flipSequence.has%20=%20function(key%20)%20%7Breturn%20iterable.includes(key)%7D;%0A%09%20%20%20%20flipSequence.includes%20=%20function(key%20)%20%7Breturn%20iterable.has(key)%7D;%0A%09%20%20%20%20flipSequence.cacheResult%20=%20cacheResultThrough;%0A%09%20%20%20%20flipSequence.__iterateUncached%20=%20function%20(fn,%20reverse)%20%7Bvar%20this$0%20=%20this;%0A%09%20%20%20%20%20%20return%20iterable.__iterate(function(v,%20k)%20%20%7Breturn%20fn(k,%20v,%20this$0)%20!==%20false%7D,%20reverse);%0A%09%20%20%20%20%7D%0A%09%20%20%20%20flipSequence.__iteratorUncached%20=%20function(type,%20reverse)%20%7B%0A%09%20%20%20%20%20%20if%20(type%20===%20ITERATE_ENTRIES)%20%7B%0A%09%20%20%20%20%20%20%20%20var%20iterator%20=%20iterable.__iterator(type,%20reverse);%0A%09%20%20%20%20%20%20%20%20return%20new%20Iterator(function()%20%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20var%20step%20=%20iterator.next();%0A%09%20%20%20%20%20%20%20%20%20%20if%20(!step.done)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20%20%20var%20k%20=%20step.value%5B0%5D;%0A%09%20%20%20%20%20%20%20%20%20%20%20%20step.value%5B0%5D%20=%20step.value%5B1%5D;%0A%09%20%20%20%20%20%20%20%20%20%20%20%20step.value%5B1%5D%20=%20k;%0A%09%20%20%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20%20%20return%20step;%0A%09%20%20%20%20%20%20%20%20%7D);%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20iterable.__iterator(%0A%09%20%20%20%20%20%20%20%20type%20===%20ITERATE_VALUES%20?%20ITERATE_KEYS%20:%20ITERATE_VALUES,%0A%09%20%20%20%20%20%20%20%20reverse%0A%09%20%20%20%20%20%20);%0A%09%20%20%20%20%7D%0A%09%20%20%20%20return%20flipSequence;%0A%09%20%20%7D%0A%0A%0A%09%20%20function%20mapFactory(iterable,%20mapper,%20context)%20%7B%0A%09%20%20%20%20var%20mappedSequence%20=%20makeSequence(iterable);%0A%09%20%20%20%20mappedSequence.size%20=%20iterable.size;%0A%09%20%20%20%20mappedSequence.has%20=%20function(key%20)%20%7Breturn%20iterable.has(key)%7D;%0A%09%20%20%20%20mappedSequence.get%20=%20function(key,%20notSetValue)%20%20%7B%0A%09%20%20%20%20%20%20var%20v%20=%20iterable.get(key,%20NOT_SET);%0A%09%20%20%20%20%20%20return%20v%20===%20NOT_SET%20?%0A%09%20%20%20%20%20%20%20%20notSetValue%20:%0A%09%20%20%20%20%20%20%20%20mapper.call(context,%20v,%20key,%20iterable);%0A%09%20%20%20%20%7D;%0A%09%20%20%20%20mappedSequence.__iterateUncached%20=%20function%20(fn,%20reverse)%20%7Bvar%20this$0%20=%20this;%0A%09%20%20%20%20%20%20return%20iterable.__iterate(%0A%09%20%20%20%20%20%20%20%20function(v,%20k,%20c)%20%20%7Breturn%20fn(mapper.call(context,%20v,%20k,%20c),%20k,%20this$0)%20!==%20false%7D,%0A%09%20%20%20%20%20%20%20%20reverse%0A%09%20%20%20%20%20%20);%0A%09%20%20%20%20%7D%0A%09%20%20%20%20mappedSequence.__iteratorUncached%20=%20function%20(type,%20reverse)%20%7B%0A%09%20%20%20%20%20%20var%20iterator%20=%20iterable.__iterator(ITERATE_ENTRIES,%20reverse);%0A%09%20%20%20%20%20%20return%20new%20Iterator(function()%20%20%7B%0A%09%20%20%20%20%20%20%20%20var%20step%20=%20iterator.next();%0A%09%20%20%20%20%20%20%20%20if%20(step.done)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20return%20step;%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20var%20entry%20=%20step.value;%0A%09%20%20%20%20%20%20%20%20var%20key%20=%20entry%5B0%5D;%0A%09%20%20%20%20%20%20%20%20return%20iteratorValue(%0A%09%20%20%20%20%20%20%20%20%20%20type,%0A%09%20%20%20%20%20%20%20%20%20%20key,%0A%09%20%20%20%20%20%20%20%20%20%20mapper.call(context,%20entry%5B1%5D,%20key,%20iterable),%0A%09%20%20%20%20%20%20%20%20%20%20step%0A%09%20%20%20%20%20%20%20%20);%0A%09%20%20%20%20%20%20%7D);%0A%09%20%20%20%20%7D%0A%09%20%20%20%20return%20mappedSequence;%0A%09%20%20%7D%0A%0A%0A%09%20%20function%20reverseFactory(iterable,%20useKeys)%20%7B%0A%09%20%20%20%20var%20reversedSequence%20=%20makeSequence(iterable);%0A%09%20%20%20%20reversedSequence._iter%20=%20iterable;%0A%09%20%20%20%20reversedSequence.size%20=%20iterable.size;%0A%09%20%20%20%20reversedSequence.reverse%20=%20function()%20%20%7Breturn%20iterable%7D;%0A%09%20%20%20%20if%20(iterable.flip)%20%7B%0A%09%20%20%20%20%20%20reversedSequence.flip%20=%20function%20()%20%7B%0A%09%20%20%20%20%20%20%20%20var%20flipSequence%20=%20flipFactory(iterable);%0A%09%20%20%20%20%20%20%20%20flipSequence.reverse%20=%20function()%20%20%7Breturn%20iterable.flip()%7D;%0A%09%20%20%20%20%20%20%20%20return%20flipSequence;%0A%09%20%20%20%20%20%20%7D;%0A%09%20%20%20%20%7D%0A%09%20%20%20%20reversedSequence.get%20=%20function(key,%20notSetValue)%20%0A%09%20%20%20%20%20%20%7Breturn%20iterable.get(useKeys%20?%20key%20:%20-1%20-%20key,%20notSetValue)%7D;%0A%09%20%20%20%20reversedSequence.has%20=%20function(key%20)%0A%09%20%20%20%20%20%20%7Breturn%20iterable.has(useKeys%20?%20key%20:%20-1%20-%20key)%7D;%0A%09%20%20%20%20reversedSequence.includes%20=%20function(value%20)%20%7Breturn%20iterable.includes(value)%7D;%0A%09%20%20%20%20reversedSequence.cacheResult%20=%20cacheResultThrough;%0A%09%20%20%20%20reversedSequence.__iterate%20=%20function%20(fn,%20reverse)%20%7Bvar%20this$0%20=%20this;%0A%09%20%20%20%20%20%20return%20iterable.__iterate(function(v,%20k)%20%20%7Breturn%20fn(v,%20k,%20this$0)%7D,%20!reverse);%0A%09%20%20%20%20%7D;%0A%09%20%20%20%20reversedSequence.__iterator%20=%0A%09%20%20%20%20%20%20function(type,%20reverse)%20%20%7Breturn%20iterable.__iterator(type,%20!reverse)%7D;%0A%09%20%20%20%20return%20reversedSequence;%0A%09%20%20%7D%0A%0A%0A%09%20%20function%20filterFactory(iterable,%20predicate,%20context,%20useKeys)%20%7B%0A%09%20%20%20%20var%20filterSequence%20=%20makeSequence(iterable);%0A%09%20%20%20%20if%20(useKeys)%20%7B%0A%09%20%20%20%20%20%20filterSequence.has%20=%20function(key%20)%20%7B%0A%09%20%20%20%20%20%20%20%20var%20v%20=%20iterable.get(key,%20NOT_SET);%0A%09%20%20%20%20%20%20%20%20return%20v%20!==%20NOT_SET%20&&%20!!predicate.call(context,%20v,%20key,%20iterable);%0A%09%20%20%20%20%20%20%7D;%0A%09%20%20%20%20%20%20filterSequence.get%20=%20function(key,%20notSetValue)%20%20%7B%0A%09%20%20%20%20%20%20%20%20var%20v%20=%20iterable.get(key,%20NOT_SET);%0A%09%20%20%20%20%20%20%20%20return%20v%20!==%20NOT_SET%20&&%20predicate.call(context,%20v,%20key,%20iterable)%20?%0A%09%20%20%20%20%20%20%20%20%20%20v%20:%20notSetValue;%0A%09%20%20%20%20%20%20%7D;%0A%09%20%20%20%20%7D%0A%09%20%20%20%20filterSequence.__iterateUncached%20=%20function%20(fn,%20reverse)%20%7Bvar%20this$0%20=%20this;%0A%09%20%20%20%20%20%20var%20iterations%20=%200;%0A%09%20%20%20%20%20%20iterable.__iterate(function(v,%20k,%20c)%20%20%7B%0A%09%20%20%20%20%20%20%20%20if%20(predicate.call(context,%20v,%20k,%20c))%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20iterations++;%0A%09%20%20%20%20%20%20%20%20%20%20return%20fn(v,%20useKeys%20?%20k%20:%20iterations%20-%201,%20this$0);%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%7D,%20reverse);%0A%09%20%20%20%20%20%20return%20iterations;%0A%09%20%20%20%20%7D;%0A%09%20%20%20%20filterSequence.__iteratorUncached%20=%20function%20(type,%20reverse)%20%7B%0A%09%20%20%20%20%20%20var%20iterator%20=%20iterable.__iterator(ITERATE_ENTRIES,%20reverse);%0A%09%20%20%20%20%20%20var%20iterations%20=%200;%0A%09%20%20%20%20%20%20return%20new%20Iterator(function()%20%20%7B%0A%09%20%20%20%20%20%20%20%20while%20(true)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20var%20step%20=%20iterator.next();%0A%09%20%20%20%20%20%20%20%20%20%20if%20(step.done)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20%20%20return%20step;%0A%09%20%20%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20%20%20var%20entry%20=%20step.value;%0A%09%20%20%20%20%20%20%20%20%20%20var%20key%20=%20entry%5B0%5D;%0A%09%20%20%20%20%20%20%20%20%20%20var%20value%20=%20entry%5B1%5D;%0A%09%20%20%20%20%20%20%20%20%20%20if%20(predicate.call(context,%20value,%20key,%20iterable))%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20%20%20return%20iteratorValue(type,%20useKeys%20?%20key%20:%20iterations++,%20value,%20step);%0A%09%20%20%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%7D);%0A%09%20%20%20%20%7D%0A%09%20%20%20%20return%20filterSequence;%0A%09%20%20%7D%0A%0A%0A%09%20%20function%20countByFactory(iterable,%20grouper,%20context)%20%7B%0A%09%20%20%20%20var%20groups%20=%20Map().asMutable();%0A%09%20%20%20%20iterable.__iterate(function(v,%20k)%20%20%7B%0A%09%20%20%20%20%20%20groups.update(%0A%09%20%20%20%20%20%20%20%20grouper.call(context,%20v,%20k,%20iterable),%0A%09%20%20%20%20%20%20%20%200,%0A%09%20%20%20%20%20%20%20%20function(a%20)%20%7Breturn%20a%20+%201%7D%0A%09%20%20%20%20%20%20);%0A%09%20%20%20%20%7D);%0A%09%20%20%20%20return%20groups.asImmutable();%0A%09%20%20%7D%0A%0A%0A%09%20%20function%20groupByFactory(iterable,%20grouper,%20context)%20%7B%0A%09%20%20%20%20var%20isKeyedIter%20=%20isKeyed(iterable);%0A%09%20%20%20%20var%20groups%20=%20(isOrdered(iterable)%20?%20OrderedMap()%20:%20Map()).asMutable();%0A%09%20%20%20%20iterable.__iterate(function(v,%20k)%20%20%7B%0A%09%20%20%20%20%20%20groups.update(%0A%09%20%20%20%20%20%20%20%20grouper.call(context,%20v,%20k,%20iterable),%0A%09%20%20%20%20%20%20%20%20function(a%20)%20%7Breturn%20(a%20=%20a%20%7C%7C%20%5B%5D,%20a.push(isKeyedIter%20?%20%5Bk,%20v%5D%20:%20v),%20a)%7D%0A%09%20%20%20%20%20%20);%0A%09%20%20%20%20%7D);%0A%09%20%20%20%20var%20coerce%20=%20iterableClass(iterable);%0A%09%20%20%20%20return%20groups.map(function(arr%20)%20%7Breturn%20reify(iterable,%20coerce(arr))%7D);%0A%09%20%20%7D%0A%0A%0A%09%20%20function%20sliceFactory(iterable,%20begin,%20end,%20useKeys)%20%7B%0A%09%20%20%20%20var%20originalSize%20=%20iterable.size;%0A%0A%09%20%20%20%20//%20Sanitize%20begin%20&%20end%20using%20this%20shorthand%20for%20ToInt32(argument)%0A%09%20%20%20%20//%20http://www.ecma-international.org/ecma-262/6.0/#sec-toint32%0A%09%20%20%20%20if%20(begin%20!==%20undefined)%20%7B%0A%09%20%20%20%20%20%20begin%20=%20begin%20%7C%200;%0A%09%20%20%20%20%7D%0A%09%20%20%20%20if%20(end%20!==%20undefined)%20%7B%0A%09%20%20%20%20%20%20end%20=%20end%20%7C%200;%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20if%20(wholeSlice(begin,%20end,%20originalSize))%20%7B%0A%09%20%20%20%20%20%20return%20iterable;%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20var%20resolvedBegin%20=%20resolveBegin(begin,%20originalSize);%0A%09%20%20%20%20var%20resolvedEnd%20=%20resolveEnd(end,%20originalSize);%0A%0A%09%20%20%20%20//%20begin%20or%20end%20will%20be%20NaN%20if%20they%20were%20provided%20as%20negative%20numbers%20and%0A%09%20%20%20%20//%20this%20iterable's%20size%20is%20unknown.%20In%20that%20case,%20cache%20first%20so%20there%20is%0A%09%20%20%20%20//%20a%20known%20size%20and%20these%20do%20not%20resolve%20to%20NaN.%0A%09%20%20%20%20if%20(resolvedBegin%20!==%20resolvedBegin%20%7C%7C%20resolvedEnd%20!==%20resolvedEnd)%20%7B%0A%09%20%20%20%20%20%20return%20sliceFactory(iterable.toSeq().cacheResult(),%20begin,%20end,%20useKeys);%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20//%20Note:%20resolvedEnd%20is%20undefined%20when%20the%20original%20sequence's%20length%20is%0A%09%20%20%20%20//%20unknown%20and%20this%20slice%20did%20not%20supply%20an%20end%20and%20should%20contain%20all%0A%09%20%20%20%20//%20elements%20after%20resolvedBegin.%0A%09%20%20%20%20//%20In%20that%20case,%20resolvedSize%20will%20be%20NaN%20and%20sliceSize%20will%20remain%20undefined.%0A%09%20%20%20%20var%20resolvedSize%20=%20resolvedEnd%20-%20resolvedBegin;%0A%09%20%20%20%20var%20sliceSize;%0A%09%20%20%20%20if%20(resolvedSize%20===%20resolvedSize)%20%7B%0A%09%20%20%20%20%20%20sliceSize%20=%20resolvedSize%20%3C%200%20?%200%20:%20resolvedSize;%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20var%20sliceSeq%20=%20makeSequence(iterable);%0A%0A%09%20%20%20%20//%20If%20iterable.size%20is%20undefined,%20the%20size%20of%20the%20realized%20sliceSeq%20is%0A%09%20%20%20%20//%20unknown%20at%20this%20point%20unless%20the%20number%20of%20items%20to%20slice%20is%200%0A%09%20%20%20%20sliceSeq.size%20=%20sliceSize%20===%200%20?%20sliceSize%20:%20iterable.size%20&&%20sliceSize%20%7C%7C%20undefined;%0A%0A%09%20%20%20%20if%20(!useKeys%20&&%20isSeq(iterable)%20&&%20sliceSize%20%3E=%200)%20%7B%0A%09%20%20%20%20%20%20sliceSeq.get%20=%20function%20(index,%20notSetValue)%20%7B%0A%09%20%20%20%20%20%20%20%20index%20=%20wrapIndex(this,%20index);%0A%09%20%20%20%20%20%20%20%20return%20index%20%3E=%200%20&&%20index%20%3C%20sliceSize%20?%0A%09%20%20%20%20%20%20%20%20%20%20iterable.get(index%20+%20resolvedBegin,%20notSetValue)%20:%0A%09%20%20%20%20%20%20%20%20%20%20notSetValue;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20sliceSeq.__iterateUncached%20=%20function(fn,%20reverse)%20%7Bvar%20this$0%20=%20this;%0A%09%20%20%20%20%20%20if%20(sliceSize%20===%200)%20%7B%0A%09%20%20%20%20%20%20%20%20return%200;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20if%20(reverse)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this.cacheResult().__iterate(fn,%20reverse);%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20var%20skipped%20=%200;%0A%09%20%20%20%20%20%20var%20isSkipping%20=%20true;%0A%09%20%20%20%20%20%20var%20iterations%20=%200;%0A%09%20%20%20%20%20%20iterable.__iterate(function(v,%20k)%20%20%7B%0A%09%20%20%20%20%20%20%20%20if%20(!(isSkipping%20&&%20(isSkipping%20=%20skipped++%20%3C%20resolvedBegin)))%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20iterations++;%0A%09%20%20%20%20%20%20%20%20%20%20return%20fn(v,%20useKeys%20?%20k%20:%20iterations%20-%201,%20this$0)%20!==%20false%20&&%0A%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20iterations%20!==%20sliceSize;%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%7D);%0A%09%20%20%20%20%20%20return%20iterations;%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20sliceSeq.__iteratorUncached%20=%20function(type,%20reverse)%20%7B%0A%09%20%20%20%20%20%20if%20(sliceSize%20!==%200%20&&%20reverse)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this.cacheResult().__iterator(type,%20reverse);%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20//%20Don't%20bother%20instantiating%20parent%20iterator%20if%20taking%200.%0A%09%20%20%20%20%20%20var%20iterator%20=%20sliceSize%20!==%200%20&&%20iterable.__iterator(type,%20reverse);%0A%09%20%20%20%20%20%20var%20skipped%20=%200;%0A%09%20%20%20%20%20%20var%20iterations%20=%200;%0A%09%20%20%20%20%20%20return%20new%20Iterator(function()%20%20%7B%0A%09%20%20%20%20%20%20%20%20while%20(skipped++%20%3C%20resolvedBegin)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20iterator.next();%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20if%20(++iterations%20%3E%20sliceSize)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20return%20iteratorDone();%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20var%20step%20=%20iterator.next();%0A%09%20%20%20%20%20%20%20%20if%20(useKeys%20%7C%7C%20type%20===%20ITERATE_VALUES)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20return%20step;%0A%09%20%20%20%20%20%20%20%20%7D%20else%20if%20(type%20===%20ITERATE_KEYS)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20return%20iteratorValue(type,%20iterations%20-%201,%20undefined,%20step);%0A%09%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20return%20iteratorValue(type,%20iterations%20-%201,%20step.value%5B1%5D,%20step);%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%7D);%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20return%20sliceSeq;%0A%09%20%20%7D%0A%0A%0A%09%20%20function%20takeWhileFactory(iterable,%20predicate,%20context)%20%7B%0A%09%20%20%20%20var%20takeSequence%20=%20makeSequence(iterable);%0A%09%20%20%20%20takeSequence.__iterateUncached%20=%20function(fn,%20reverse)%20%7Bvar%20this$0%20=%20this;%0A%09%20%20%20%20%20%20if%20(reverse)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this.cacheResult().__iterate(fn,%20reverse);%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20var%20iterations%20=%200;%0A%09%20%20%20%20%20%20iterable.__iterate(function(v,%20k,%20c)%20%0A%09%20%20%20%20%20%20%20%20%7Breturn%20predicate.call(context,%20v,%20k,%20c)%20&&%20++iterations%20&&%20fn(v,%20k,%20this$0)%7D%0A%09%20%20%20%20%20%20);%0A%09%20%20%20%20%20%20return%20iterations;%0A%09%20%20%20%20%7D;%0A%09%20%20%20%20takeSequence.__iteratorUncached%20=%20function(type,%20reverse)%20%7Bvar%20this$0%20=%20this;%0A%09%20%20%20%20%20%20if%20(reverse)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this.cacheResult().__iterator(type,%20reverse);%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20var%20iterator%20=%20iterable.__iterator(ITERATE_ENTRIES,%20reverse);%0A%09%20%20%20%20%20%20var%20iterating%20=%20true;%0A%09%20%20%20%20%20%20return%20new%20Iterator(function()%20%20%7B%0A%09%20%20%20%20%20%20%20%20if%20(!iterating)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20return%20iteratorDone();%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20var%20step%20=%20iterator.next();%0A%09%20%20%20%20%20%20%20%20if%20(step.done)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20return%20step;%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20var%20entry%20=%20step.value;%0A%09%20%20%20%20%20%20%20%20var%20k%20=%20entry%5B0%5D;%0A%09%20%20%20%20%20%20%20%20var%20v%20=%20entry%5B1%5D;%0A%09%20%20%20%20%20%20%20%20if%20(!predicate.call(context,%20v,%20k,%20this$0))%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20iterating%20=%20false;%0A%09%20%20%20%20%20%20%20%20%20%20return%20iteratorDone();%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20return%20type%20===%20ITERATE_ENTRIES%20?%20step%20:%0A%09%20%20%20%20%20%20%20%20%20%20iteratorValue(type,%20k,%20v,%20step);%0A%09%20%20%20%20%20%20%7D);%0A%09%20%20%20%20%7D;%0A%09%20%20%20%20return%20takeSequence;%0A%09%20%20%7D%0A%0A%0A%09%20%20function%20skipWhileFactory(iterable,%20predicate,%20context,%20useKeys)%20%7B%0A%09%20%20%20%20var%20skipSequence%20=%20makeSequence(iterable);%0A%09%20%20%20%20skipSequence.__iterateUncached%20=%20function%20(fn,%20reverse)%20%7Bvar%20this$0%20=%20this;%0A%09%20%20%20%20%20%20if%20(reverse)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this.cacheResult().__iterate(fn,%20reverse);%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20var%20isSkipping%20=%20true;%0A%09%20%20%20%20%20%20var%20iterations%20=%200;%0A%09%20%20%20%20%20%20iterable.__iterate(function(v,%20k,%20c)%20%20%7B%0A%09%20%20%20%20%20%20%20%20if%20(!(isSkipping%20&&%20(isSkipping%20=%20predicate.call(context,%20v,%20k,%20c))))%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20iterations++;%0A%09%20%20%20%20%20%20%20%20%20%20return%20fn(v,%20useKeys%20?%20k%20:%20iterations%20-%201,%20this$0);%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%7D);%0A%09%20%20%20%20%20%20return%20iterations;%0A%09%20%20%20%20%7D;%0A%09%20%20%20%20skipSequence.__iteratorUncached%20=%20function(type,%20reverse)%20%7Bvar%20this$0%20=%20this;%0A%09%20%20%20%20%20%20if%20(reverse)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this.cacheResult().__iterator(type,%20reverse);%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20var%20iterator%20=%20iterable.__iterator(ITERATE_ENTRIES,%20reverse);%0A%09%20%20%20%20%20%20var%20skipping%20=%20true;%0A%09%20%20%20%20%20%20var%20iterations%20=%200;%0A%09%20%20%20%20%20%20return%20new%20Iterator(function()%20%20%7B%0A%09%20%20%20%20%20%20%20%20var%20step,%20k,%20v;%0A%09%20%20%20%20%20%20%20%20do%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20step%20=%20iterator.next();%0A%09%20%20%20%20%20%20%20%20%20%20if%20(step.done)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(useKeys%20%7C%7C%20type%20===%20ITERATE_VALUES)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20step;%0A%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20if%20(type%20===%20ITERATE_KEYS)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20iteratorValue(type,%20iterations++,%20undefined,%20step);%0A%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20iteratorValue(type,%20iterations++,%20step.value%5B1%5D,%20step);%0A%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20%20%20var%20entry%20=%20step.value;%0A%09%20%20%20%20%20%20%20%20%20%20k%20=%20entry%5B0%5D;%0A%09%20%20%20%20%20%20%20%20%20%20v%20=%20entry%5B1%5D;%0A%09%20%20%20%20%20%20%20%20%20%20skipping%20&&%20(skipping%20=%20predicate.call(context,%20v,%20k,%20this$0));%0A%09%20%20%20%20%20%20%20%20%7D%20while%20(skipping);%0A%09%20%20%20%20%20%20%20%20return%20type%20===%20ITERATE_ENTRIES%20?%20step%20:%0A%09%20%20%20%20%20%20%20%20%20%20iteratorValue(type,%20k,%20v,%20step);%0A%09%20%20%20%20%20%20%7D);%0A%09%20%20%20%20%7D;%0A%09%20%20%20%20return%20skipSequence;%0A%09%20%20%7D%0A%0A%0A%09%20%20function%20concatFactory(iterable,%20values)%20%7B%0A%09%20%20%20%20var%20isKeyedIterable%20=%20isKeyed(iterable);%0A%09%20%20%20%20var%20iters%20=%20%5Biterable%5D.concat(values).map(function(v%20)%20%7B%0A%09%20%20%20%20%20%20if%20(!isIterable(v))%20%7B%0A%09%20%20%20%20%20%20%20%20v%20=%20isKeyedIterable%20?%0A%09%20%20%20%20%20%20%20%20%20%20keyedSeqFromValue(v)%20:%0A%09%20%20%20%20%20%20%20%20%20%20indexedSeqFromValue(Array.isArray(v)%20?%20v%20:%20%5Bv%5D);%0A%09%20%20%20%20%20%20%7D%20else%20if%20(isKeyedIterable)%20%7B%0A%09%20%20%20%20%20%20%20%20v%20=%20KeyedIterable(v);%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20v;%0A%09%20%20%20%20%7D).filter(function(v%20)%20%7Breturn%20v.size%20!==%200%7D);%0A%0A%09%20%20%20%20if%20(iters.length%20===%200)%20%7B%0A%09%20%20%20%20%20%20return%20iterable;%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20if%20(iters.length%20===%201)%20%7B%0A%09%20%20%20%20%20%20var%20singleton%20=%20iters%5B0%5D;%0A%09%20%20%20%20%20%20if%20(singleton%20===%20iterable%20%7C%7C%0A%09%20%20%20%20%20%20%20%20%20%20isKeyedIterable%20&&%20isKeyed(singleton)%20%7C%7C%0A%09%20%20%20%20%20%20%20%20%20%20isIndexed(iterable)%20&&%20isIndexed(singleton))%20%7B%0A%09%20%20%20%20%20%20%20%20return%20singleton;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20var%20concatSeq%20=%20new%20ArraySeq(iters);%0A%09%20%20%20%20if%20(isKeyedIterable)%20%7B%0A%09%20%20%20%20%20%20concatSeq%20=%20concatSeq.toKeyedSeq();%0A%09%20%20%20%20%7D%20else%20if%20(!isIndexed(iterable))%20%7B%0A%09%20%20%20%20%20%20concatSeq%20=%20concatSeq.toSetSeq();%0A%09%20%20%20%20%7D%0A%09%20%20%20%20concatSeq%20=%20concatSeq.flatten(true);%0A%09%20%20%20%20concatSeq.size%20=%20iters.reduce(%0A%09%20%20%20%20%20%20function(sum,%20seq)%20%20%7B%0A%09%20%20%20%20%20%20%20%20if%20(sum%20!==%20undefined)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20var%20size%20=%20seq.size;%0A%09%20%20%20%20%20%20%20%20%20%20if%20(size%20!==%20undefined)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20%20%20return%20sum%20+%20size;%0A%09%20%20%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%7D,%0A%09%20%20%20%20%20%200%0A%09%20%20%20%20);%0A%09%20%20%20%20return%20concatSeq;%0A%09%20%20%7D%0A%0A%0A%09%20%20function%20flattenFactory(iterable,%20depth,%20useKeys)%20%7B%0A%09%20%20%20%20var%20flatSequence%20=%20makeSequence(iterable);%0A%09%20%20%20%20flatSequence.__iterateUncached%20=%20function(fn,%20reverse)%20%7B%0A%09%20%20%20%20%20%20var%20iterations%20=%200;%0A%09%20%20%20%20%20%20var%20stopped%20=%20false;%0A%09%20%20%20%20%20%20function%20flatDeep(iter,%20currentDepth)%20%7Bvar%20this$0%20=%20this;%0A%09%20%20%20%20%20%20%20%20iter.__iterate(function(v,%20k)%20%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20if%20((!depth%20%7C%7C%20currentDepth%20%3C%20depth)%20&&%20isIterable(v))%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20%20%20flatDeep(v,%20currentDepth%20+%201);%0A%09%20%20%20%20%20%20%20%20%20%20%7D%20else%20if%20(fn(v,%20useKeys%20?%20k%20:%20iterations++,%20this$0)%20===%20false)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20%20%20stopped%20=%20true;%0A%09%20%20%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20%20%20return%20!stopped;%0A%09%20%20%20%20%20%20%20%20%7D,%20reverse);%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20flatDeep(iterable,%200);%0A%09%20%20%20%20%20%20return%20iterations;%0A%09%20%20%20%20%7D%0A%09%20%20%20%20flatSequence.__iteratorUncached%20=%20function(type,%20reverse)%20%7B%0A%09%20%20%20%20%20%20var%20iterator%20=%20iterable.__iterator(type,%20reverse);%0A%09%20%20%20%20%20%20var%20stack%20=%20%5B%5D;%0A%09%20%20%20%20%20%20var%20iterations%20=%200;%0A%09%20%20%20%20%20%20return%20new%20Iterator(function()%20%20%7B%0A%09%20%20%20%20%20%20%20%20while%20(iterator)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20var%20step%20=%20iterator.next();%0A%09%20%20%20%20%20%20%20%20%20%20if%20(step.done%20!==%20false)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20%20%20iterator%20=%20stack.pop();%0A%09%20%20%20%20%20%20%20%20%20%20%20%20continue;%0A%09%20%20%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20%20%20var%20v%20=%20step.value;%0A%09%20%20%20%20%20%20%20%20%20%20if%20(type%20===%20ITERATE_ENTRIES)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20%20%20v%20=%20v%5B1%5D;%0A%09%20%20%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20%20%20if%20((!depth%20%7C%7C%20stack.length%20%3C%20depth)%20&&%20isIterable(v))%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20%20%20stack.push(iterator);%0A%09%20%20%20%20%20%20%20%20%20%20%20%20iterator%20=%20v.__iterator(type,%20reverse);%0A%09%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20%20%20return%20useKeys%20?%20step%20:%20iteratorValue(type,%20iterations++,%20v,%20step);%0A%09%20%20%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20return%20iteratorDone();%0A%09%20%20%20%20%20%20%7D);%0A%09%20%20%20%20%7D%0A%09%20%20%20%20return%20flatSequence;%0A%09%20%20%7D%0A%0A%0A%09%20%20function%20flatMapFactory(iterable,%20mapper,%20context)%20%7B%0A%09%20%20%20%20var%20coerce%20=%20iterableClass(iterable);%0A%09%20%20%20%20return%20iterable.toSeq().map(%0A%09%20%20%20%20%20%20function(v,%20k)%20%20%7Breturn%20coerce(mapper.call(context,%20v,%20k,%20iterable))%7D%0A%09%20%20%20%20).flatten(true);%0A%09%20%20%7D%0A%0A%0A%09%20%20function%20interposeFactory(iterable,%20separator)%20%7B%0A%09%20%20%20%20var%20interposedSequence%20=%20makeSequence(iterable);%0A%09%20%20%20%20interposedSequence.size%20=%20iterable.size%20&&%20iterable.size%20*%202%20-1;%0A%09%20%20%20%20interposedSequence.__iterateUncached%20=%20function(fn,%20reverse)%20%7Bvar%20this$0%20=%20this;%0A%09%20%20%20%20%20%20var%20iterations%20=%200;%0A%09%20%20%20%20%20%20iterable.__iterate(function(v,%20k)%20%0A%09%20%20%20%20%20%20%20%20%7Breturn%20(!iterations%20%7C%7C%20fn(separator,%20iterations++,%20this$0)%20!==%20false)%20&&%0A%09%20%20%20%20%20%20%20%20fn(v,%20iterations++,%20this$0)%20!==%20false%7D,%0A%09%20%20%20%20%20%20%20%20reverse%0A%09%20%20%20%20%20%20);%0A%09%20%20%20%20%20%20return%20iterations;%0A%09%20%20%20%20%7D;%0A%09%20%20%20%20interposedSequence.__iteratorUncached%20=%20function(type,%20reverse)%20%7B%0A%09%20%20%20%20%20%20var%20iterator%20=%20iterable.__iterator(ITERATE_VALUES,%20reverse);%0A%09%20%20%20%20%20%20var%20iterations%20=%200;%0A%09%20%20%20%20%20%20var%20step;%0A%09%20%20%20%20%20%20return%20new%20Iterator(function()%20%20%7B%0A%09%20%20%20%20%20%20%20%20if%20(!step%20%7C%7C%20iterations%20%25%202)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20step%20=%20iterator.next();%0A%09%20%20%20%20%20%20%20%20%20%20if%20(step.done)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20%20%20return%20step;%0A%09%20%20%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20return%20iterations%20%25%202%20?%0A%09%20%20%20%20%20%20%20%20%20%20iteratorValue(type,%20iterations++,%20separator)%20:%0A%09%20%20%20%20%20%20%20%20%20%20iteratorValue(type,%20iterations++,%20step.value,%20step);%0A%09%20%20%20%20%20%20%7D);%0A%09%20%20%20%20%7D;%0A%09%20%20%20%20return%20interposedSequence;%0A%09%20%20%7D%0A%0A%0A%09%20%20function%20sortFactory(iterable,%20comparator,%20mapper)%20%7B%0A%09%20%20%20%20if%20(!comparator)%20%7B%0A%09%20%20%20%20%20%20comparator%20=%20defaultComparator;%0A%09%20%20%20%20%7D%0A%09%20%20%20%20var%20isKeyedIterable%20=%20isKeyed(iterable);%0A%09%20%20%20%20var%20index%20=%200;%0A%09%20%20%20%20var%20entries%20=%20iterable.toSeq().map(%0A%09%20%20%20%20%20%20function(v,%20k)%20%20%7Breturn%20%5Bk,%20v,%20index++,%20mapper%20?%20mapper(v,%20k,%20iterable)%20:%20v%5D%7D%0A%09%20%20%20%20).toArray();%0A%09%20%20%20%20entries.sort(function(a,%20b)%20%20%7Breturn%20comparator(a%5B3%5D,%20b%5B3%5D)%20%7C%7C%20a%5B2%5D%20-%20b%5B2%5D%7D).forEach(%0A%09%20%20%20%20%20%20isKeyedIterable%20?%0A%09%20%20%20%20%20%20function(v,%20i)%20%20%7B%20entries%5Bi%5D.length%20=%202;%20%7D%20:%0A%09%20%20%20%20%20%20function(v,%20i)%20%20%7B%20entries%5Bi%5D%20=%20v%5B1%5D;%20%7D%0A%09%20%20%20%20);%0A%09%20%20%20%20return%20isKeyedIterable%20?%20KeyedSeq(entries)%20:%0A%09%20%20%20%20%20%20isIndexed(iterable)%20?%20IndexedSeq(entries)%20:%0A%09%20%20%20%20%20%20SetSeq(entries);%0A%09%20%20%7D%0A%0A%0A%09%20%20function%20maxFactory(iterable,%20comparator,%20mapper)%20%7B%0A%09%20%20%20%20if%20(!comparator)%20%7B%0A%09%20%20%20%20%20%20comparator%20=%20defaultComparator;%0A%09%20%20%20%20%7D%0A%09%20%20%20%20if%20(mapper)%20%7B%0A%09%20%20%20%20%20%20var%20entry%20=%20iterable.toSeq()%0A%09%20%20%20%20%20%20%20%20.map(function(v,%20k)%20%20%7Breturn%20%5Bv,%20mapper(v,%20k,%20iterable)%5D%7D)%0A%09%20%20%20%20%20%20%20%20.reduce(function(a,%20b)%20%20%7Breturn%20maxCompare(comparator,%20a%5B1%5D,%20b%5B1%5D)%20?%20b%20:%20a%7D);%0A%09%20%20%20%20%20%20return%20entry%20&&%20entry%5B0%5D;%0A%09%20%20%20%20%7D%20else%20%7B%0A%09%20%20%20%20%20%20return%20iterable.reduce(function(a,%20b)%20%20%7Breturn%20maxCompare(comparator,%20a,%20b)%20?%20b%20:%20a%7D);%0A%09%20%20%20%20%7D%0A%09%20%20%7D%0A%0A%09%20%20function%20maxCompare(comparator,%20a,%20b)%20%7B%0A%09%20%20%20%20var%20comp%20=%20comparator(b,%20a);%0A%09%20%20%20%20//%20b%20is%20considered%20the%20new%20max%20if%20the%20comparator%20declares%20them%20equal,%20but%0A%09%20%20%20%20//%20they%20are%20not%20equal%20and%20b%20is%20in%20fact%20a%20nullish%20value.%0A%09%20%20%20%20return%20(comp%20===%200%20&&%20b%20!==%20a%20&&%20(b%20===%20undefined%20%7C%7C%20b%20===%20null%20%7C%7C%20b%20!==%20b))%20%7C%7C%20comp%20%3E%200;%0A%09%20%20%7D%0A%0A%0A%09%20%20function%20zipWithFactory(keyIter,%20zipper,%20iters)%20%7B%0A%09%20%20%20%20var%20zipSequence%20=%20makeSequence(keyIter);%0A%09%20%20%20%20zipSequence.size%20=%20new%20ArraySeq(iters).map(function(i%20)%20%7Breturn%20i.size%7D).min();%0A%09%20%20%20%20//%20Note:%20this%20a%20generic%20base%20implementation%20of%20__iterate%20in%20terms%20of%0A%09%20%20%20%20//%20__iterator%20which%20may%20be%20more%20generically%20useful%20in%20the%20future.%0A%09%20%20%20%20zipSequence.__iterate%20=%20function(fn,%20reverse)%20%7B%0A%09%20%20%20%20%20%20/*%20generic:%0A%09%20%20%20%20%20%20var%20iterator%20=%20this.__iterator(ITERATE_ENTRIES,%20reverse);%0A%09%20%20%20%20%20%20var%20step;%0A%09%20%20%20%20%20%20var%20iterations%20=%200;%0A%09%20%20%20%20%20%20while%20(!(step%20=%20iterator.next()).done)%20%7B%0A%09%20%20%20%20%20%20%20%20iterations++;%0A%09%20%20%20%20%20%20%20%20if%20(fn(step.value%5B1%5D,%20step.value%5B0%5D,%20this)%20===%20false)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20break;%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20iterations;%0A%09%20%20%20%20%20%20*/%0A%09%20%20%20%20%20%20//%20indexed:%0A%09%20%20%20%20%20%20var%20iterator%20=%20this.__iterator(ITERATE_VALUES,%20reverse);%0A%09%20%20%20%20%20%20var%20step;%0A%09%20%20%20%20%20%20var%20iterations%20=%200;%0A%09%20%20%20%20%20%20while%20(!(step%20=%20iterator.next()).done)%20%7B%0A%09%20%20%20%20%20%20%20%20if%20(fn(step.value,%20iterations++,%20this)%20===%20false)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20break;%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20iterations;%0A%09%20%20%20%20%7D;%0A%09%20%20%20%20zipSequence.__iteratorUncached%20=%20function(type,%20reverse)%20%7B%0A%09%20%20%20%20%20%20var%20iterators%20=%20iters.map(function(i%20)%0A%09%20%20%20%20%20%20%20%20%7Breturn%20(i%20=%20Iterable(i),%20getIterator(reverse%20?%20i.reverse()%20:%20i))%7D%0A%09%20%20%20%20%20%20);%0A%09%20%20%20%20%20%20var%20iterations%20=%200;%0A%09%20%20%20%20%20%20var%20isDone%20=%20false;%0A%09%20%20%20%20%20%20return%20new%20Iterator(function()%20%20%7B%0A%09%20%20%20%20%20%20%20%20var%20steps;%0A%09%20%20%20%20%20%20%20%20if%20(!isDone)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20steps%20=%20iterators.map(function(i%20)%20%7Breturn%20i.next()%7D);%0A%09%20%20%20%20%20%20%20%20%20%20isDone%20=%20steps.some(function(s%20)%20%7Breturn%20s.done%7D);%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20if%20(isDone)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20return%20iteratorDone();%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20return%20iteratorValue(%0A%09%20%20%20%20%20%20%20%20%20%20type,%0A%09%20%20%20%20%20%20%20%20%20%20iterations++,%0A%09%20%20%20%20%20%20%20%20%20%20zipper.apply(null,%20steps.map(function(s%20)%20%7Breturn%20s.value%7D))%0A%09%20%20%20%20%20%20%20%20);%0A%09%20%20%20%20%20%20%7D);%0A%09%20%20%20%20%7D;%0A%09%20%20%20%20return%20zipSequence%0A%09%20%20%7D%0A%0A%0A%09%20%20//%20#pragma%20Helper%20Functions%0A%0A%09%20%20function%20reify(iter,%20seq)%20%7B%0A%09%20%20%20%20return%20isSeq(iter)%20?%20seq%20:%20iter.constructor(seq);%0A%09%20%20%7D%0A%0A%09%20%20function%20validateEntry(entry)%20%7B%0A%09%20%20%20%20if%20(entry%20!==%20Object(entry))%20%7B%0A%09%20%20%20%20%20%20throw%20new%20TypeError('Expected%20%5BK,%20V%5D%20tuple:%20'%20+%20entry);%0A%09%20%20%20%20%7D%0A%09%20%20%7D%0A%0A%09%20%20function%20resolveSize(iter)%20%7B%0A%09%20%20%20%20assertNotInfinite(iter.size);%0A%09%20%20%20%20return%20ensureSize(iter);%0A%09%20%20%7D%0A%0A%09%20%20function%20iterableClass(iterable)%20%7B%0A%09%20%20%20%20return%20isKeyed(iterable)%20?%20KeyedIterable%20:%0A%09%20%20%20%20%20%20isIndexed(iterable)%20?%20IndexedIterable%20:%0A%09%20%20%20%20%20%20SetIterable;%0A%09%20%20%7D%0A%0A%09%20%20function%20makeSequence(iterable)%20%7B%0A%09%20%20%20%20return%20Object.create(%0A%09%20%20%20%20%20%20(%0A%09%20%20%20%20%20%20%20%20isKeyed(iterable)%20?%20KeyedSeq%20:%0A%09%20%20%20%20%20%20%20%20isIndexed(iterable)%20?%20IndexedSeq%20:%0A%09%20%20%20%20%20%20%20%20SetSeq%0A%09%20%20%20%20%20%20).prototype%0A%09%20%20%20%20);%0A%09%20%20%7D%0A%0A%09%20%20function%20cacheResultThrough()%20%7B%0A%09%20%20%20%20if%20(this._iter.cacheResult)%20%7B%0A%09%20%20%20%20%20%20this._iter.cacheResult();%0A%09%20%20%20%20%20%20this.size%20=%20this._iter.size;%0A%09%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%7D%20else%20%7B%0A%09%20%20%20%20%20%20return%20Seq.prototype.cacheResult.call(this);%0A%09%20%20%20%20%7D%0A%09%20%20%7D%0A%0A%09%20%20function%20defaultComparator(a,%20b)%20%7B%0A%09%20%20%20%20return%20a%20%3E%20b%20?%201%20:%20a%20%3C%20b%20?%20-1%20:%200;%0A%09%20%20%7D%0A%0A%09%20%20function%20forceIterator(keyPath)%20%7B%0A%09%20%20%20%20var%20iter%20=%20getIterator(keyPath);%0A%09%20%20%20%20if%20(!iter)%20%7B%0A%09%20%20%20%20%20%20//%20Array%20might%20not%20be%20iterable%20in%20this%20environment,%20so%20we%20need%20a%20fallback%0A%09%20%20%20%20%20%20//%20to%20our%20wrapped%20type.%0A%09%20%20%20%20%20%20if%20(!isArrayLike(keyPath))%20%7B%0A%09%20%20%20%20%20%20%20%20throw%20new%20TypeError('Expected%20iterable%20or%20array-like:%20'%20+%20keyPath);%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20iter%20=%20getIterator(Iterable(keyPath));%0A%09%20%20%20%20%7D%0A%09%20%20%20%20return%20iter;%0A%09%20%20%7D%0A%0A%09%20%20createClass(Record,%20KeyedCollection);%0A%0A%09%20%20%20%20function%20Record(defaultValues,%20name)%20%7B%0A%09%20%20%20%20%20%20var%20hasInitialized;%0A%0A%09%20%20%20%20%20%20var%20RecordType%20=%20function%20Record(values)%20%7B%0A%09%20%20%20%20%20%20%20%20if%20(values%20instanceof%20RecordType)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20return%20values;%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20if%20(!(this%20instanceof%20RecordType))%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20return%20new%20RecordType(values);%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20if%20(!hasInitialized)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20hasInitialized%20=%20true;%0A%09%20%20%20%20%20%20%20%20%20%20var%20keys%20=%20Object.keys(defaultValues);%0A%09%20%20%20%20%20%20%20%20%20%20setProps(RecordTypePrototype,%20keys);%0A%09%20%20%20%20%20%20%20%20%20%20RecordTypePrototype.size%20=%20keys.length;%0A%09%20%20%20%20%20%20%20%20%20%20RecordTypePrototype._name%20=%20name;%0A%09%20%20%20%20%20%20%20%20%20%20RecordTypePrototype._keys%20=%20keys;%0A%09%20%20%20%20%20%20%20%20%20%20RecordTypePrototype._defaultValues%20=%20defaultValues;%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20this._map%20=%20Map(values);%0A%09%20%20%20%20%20%20%7D;%0A%0A%09%20%20%20%20%20%20var%20RecordTypePrototype%20=%20RecordType.prototype%20=%20Object.create(RecordPrototype);%0A%09%20%20%20%20%20%20RecordTypePrototype.constructor%20=%20RecordType;%0A%0A%09%20%20%20%20%20%20return%20RecordType;%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20Record.prototype.toString%20=%20function()%20%7B%0A%09%20%20%20%20%20%20return%20this.__toString(recordName(this)%20+%20'%20%7B',%20'%7D');%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20//%20@pragma%20Access%0A%0A%09%20%20%20%20Record.prototype.has%20=%20function(k)%20%7B%0A%09%20%20%20%20%20%20return%20this._defaultValues.hasOwnProperty(k);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Record.prototype.get%20=%20function(k,%20notSetValue)%20%7B%0A%09%20%20%20%20%20%20if%20(!this.has(k))%20%7B%0A%09%20%20%20%20%20%20%20%20return%20notSetValue;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20var%20defaultVal%20=%20this._defaultValues%5Bk%5D;%0A%09%20%20%20%20%20%20return%20this._map%20?%20this._map.get(k,%20defaultVal)%20:%20defaultVal;%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20//%20@pragma%20Modification%0A%0A%09%20%20%20%20Record.prototype.clear%20=%20function()%20%7B%0A%09%20%20%20%20%20%20if%20(this.__ownerID)%20%7B%0A%09%20%20%20%20%20%20%20%20this._map%20&&%20this._map.clear();%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20var%20RecordType%20=%20this.constructor;%0A%09%20%20%20%20%20%20return%20RecordType._empty%20%7C%7C%20(RecordType._empty%20=%20makeRecord(this,%20emptyMap()));%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Record.prototype.set%20=%20function(k,%20v)%20%7B%0A%09%20%20%20%20%20%20if%20(!this.has(k))%20%7B%0A%09%20%20%20%20%20%20%20%20throw%20new%20Error('Cannot%20set%20unknown%20key%20%22'%20+%20k%20+%20'%22%20on%20'%20+%20recordName(this));%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20var%20newMap%20=%20this._map%20&&%20this._map.set(k,%20v);%0A%09%20%20%20%20%20%20if%20(this.__ownerID%20%7C%7C%20newMap%20===%20this._map)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20makeRecord(this,%20newMap);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Record.prototype.remove%20=%20function(k)%20%7B%0A%09%20%20%20%20%20%20if%20(!this.has(k))%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20var%20newMap%20=%20this._map%20&&%20this._map.remove(k);%0A%09%20%20%20%20%20%20if%20(this.__ownerID%20%7C%7C%20newMap%20===%20this._map)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20makeRecord(this,%20newMap);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Record.prototype.wasAltered%20=%20function()%20%7B%0A%09%20%20%20%20%20%20return%20this._map.wasAltered();%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Record.prototype.__iterator%20=%20function(type,%20reverse)%20%7Bvar%20this$0%20=%20this;%0A%09%20%20%20%20%20%20return%20KeyedIterable(this._defaultValues).map(function(_,%20k)%20%20%7Breturn%20this$0.get(k)%7D).__iterator(type,%20reverse);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Record.prototype.__iterate%20=%20function(fn,%20reverse)%20%7Bvar%20this$0%20=%20this;%0A%09%20%20%20%20%20%20return%20KeyedIterable(this._defaultValues).map(function(_,%20k)%20%20%7Breturn%20this$0.get(k)%7D).__iterate(fn,%20reverse);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Record.prototype.__ensureOwner%20=%20function(ownerID)%20%7B%0A%09%20%20%20%20%20%20if%20(ownerID%20===%20this.__ownerID)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20var%20newMap%20=%20this._map%20&&%20this._map.__ensureOwner(ownerID);%0A%09%20%20%20%20%20%20if%20(!ownerID)%20%7B%0A%09%20%20%20%20%20%20%20%20this.__ownerID%20=%20ownerID;%0A%09%20%20%20%20%20%20%20%20this._map%20=%20newMap;%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20makeRecord(this,%20newMap,%20ownerID);%0A%09%20%20%20%20%7D;%0A%0A%0A%09%20%20var%20RecordPrototype%20=%20Record.prototype;%0A%09%20%20RecordPrototype%5BDELETE%5D%20=%20RecordPrototype.remove;%0A%09%20%20RecordPrototype.deleteIn%20=%0A%09%20%20RecordPrototype.removeIn%20=%20MapPrototype.removeIn;%0A%09%20%20RecordPrototype.merge%20=%20MapPrototype.merge;%0A%09%20%20RecordPrototype.mergeWith%20=%20MapPrototype.mergeWith;%0A%09%20%20RecordPrototype.mergeIn%20=%20MapPrototype.mergeIn;%0A%09%20%20RecordPrototype.mergeDeep%20=%20MapPrototype.mergeDeep;%0A%09%20%20RecordPrototype.mergeDeepWith%20=%20MapPrototype.mergeDeepWith;%0A%09%20%20RecordPrototype.mergeDeepIn%20=%20MapPrototype.mergeDeepIn;%0A%09%20%20RecordPrototype.setIn%20=%20MapPrototype.setIn;%0A%09%20%20RecordPrototype.update%20=%20MapPrototype.update;%0A%09%20%20RecordPrototype.updateIn%20=%20MapPrototype.updateIn;%0A%09%20%20RecordPrototype.withMutations%20=%20MapPrototype.withMutations;%0A%09%20%20RecordPrototype.asMutable%20=%20MapPrototype.asMutable;%0A%09%20%20RecordPrototype.asImmutable%20=%20MapPrototype.asImmutable;%0A%0A%0A%09%20%20function%20makeRecord(likeRecord,%20map,%20ownerID)%20%7B%0A%09%20%20%20%20var%20record%20=%20Object.create(Object.getPrototypeOf(likeRecord));%0A%09%20%20%20%20record._map%20=%20map;%0A%09%20%20%20%20record.__ownerID%20=%20ownerID;%0A%09%20%20%20%20return%20record;%0A%09%20%20%7D%0A%0A%09%20%20function%20recordName(record)%20%7B%0A%09%20%20%20%20return%20record._name%20%7C%7C%20record.constructor.name%20%7C%7C%20'Record';%0A%09%20%20%7D%0A%0A%09%20%20function%20setProps(prototype,%20names)%20%7B%0A%09%20%20%20%20try%20%7B%0A%09%20%20%20%20%20%20names.forEach(setProp.bind(undefined,%20prototype));%0A%09%20%20%20%20%7D%20catch%20(error)%20%7B%0A%09%20%20%20%20%20%20//%20Object.defineProperty%20failed.%20Probably%20IE8.%0A%09%20%20%20%20%7D%0A%09%20%20%7D%0A%0A%09%20%20function%20setProp(prototype,%20name)%20%7B%0A%09%20%20%20%20Object.defineProperty(prototype,%20name,%20%7B%0A%09%20%20%20%20%20%20get:%20function()%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this.get(name);%0A%09%20%20%20%20%20%20%7D,%0A%09%20%20%20%20%20%20set:%20function(value)%20%7B%0A%09%20%20%20%20%20%20%20%20invariant(this.__ownerID,%20'Cannot%20set%20on%20an%20immutable%20record.');%0A%09%20%20%20%20%20%20%20%20this.set(name,%20value);%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%7D);%0A%09%20%20%7D%0A%0A%09%20%20createClass(Set,%20SetCollection);%0A%0A%09%20%20%20%20//%20@pragma%20Construction%0A%0A%09%20%20%20%20function%20Set(value)%20%7B%0A%09%20%20%20%20%20%20return%20value%20===%20null%20%7C%7C%20value%20===%20undefined%20?%20emptySet()%20:%0A%09%20%20%20%20%20%20%20%20isSet(value)%20&&%20!isOrdered(value)%20?%20value%20:%0A%09%20%20%20%20%20%20%20%20emptySet().withMutations(function(set%20)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20var%20iter%20=%20SetIterable(value);%0A%09%20%20%20%20%20%20%20%20%20%20assertNotInfinite(iter.size);%0A%09%20%20%20%20%20%20%20%20%20%20iter.forEach(function(v%20)%20%7Breturn%20set.add(v)%7D);%0A%09%20%20%20%20%20%20%20%20%7D);%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20Set.of%20=%20function(/*...values*/)%20%7B%0A%09%20%20%20%20%20%20return%20this(arguments);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Set.fromKeys%20=%20function(value)%20%7B%0A%09%20%20%20%20%20%20return%20this(KeyedIterable(value).keySeq());%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Set.prototype.toString%20=%20function()%20%7B%0A%09%20%20%20%20%20%20return%20this.__toString('Set%20%7B',%20'%7D');%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20//%20@pragma%20Access%0A%0A%09%20%20%20%20Set.prototype.has%20=%20function(value)%20%7B%0A%09%20%20%20%20%20%20return%20this._map.has(value);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20//%20@pragma%20Modification%0A%0A%09%20%20%20%20Set.prototype.add%20=%20function(value)%20%7B%0A%09%20%20%20%20%20%20return%20updateSet(this,%20this._map.set(value,%20true));%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Set.prototype.remove%20=%20function(value)%20%7B%0A%09%20%20%20%20%20%20return%20updateSet(this,%20this._map.remove(value));%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Set.prototype.clear%20=%20function()%20%7B%0A%09%20%20%20%20%20%20return%20updateSet(this,%20this._map.clear());%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20//%20@pragma%20Composition%0A%0A%09%20%20%20%20Set.prototype.union%20=%20function()%20%7Bvar%20iters%20=%20SLICE$0.call(arguments,%200);%0A%09%20%20%20%20%20%20iters%20=%20iters.filter(function(x%20)%20%7Breturn%20x.size%20!==%200%7D);%0A%09%20%20%20%20%20%20if%20(iters.length%20===%200)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20if%20(this.size%20===%200%20&&%20!this.__ownerID%20&&%20iters.length%20===%201)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this.constructor(iters%5B0%5D);%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20this.withMutations(function(set%20)%20%7B%0A%09%20%20%20%20%20%20%20%20for%20(var%20ii%20=%200;%20ii%20%3C%20iters.length;%20ii++)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20SetIterable(iters%5Bii%5D).forEach(function(value%20)%20%7Breturn%20set.add(value)%7D);%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%7D);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Set.prototype.intersect%20=%20function()%20%7Bvar%20iters%20=%20SLICE$0.call(arguments,%200);%0A%09%20%20%20%20%20%20if%20(iters.length%20===%200)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20iters%20=%20iters.map(function(iter%20)%20%7Breturn%20SetIterable(iter)%7D);%0A%09%20%20%20%20%20%20var%20originalSet%20=%20this;%0A%09%20%20%20%20%20%20return%20this.withMutations(function(set%20)%20%7B%0A%09%20%20%20%20%20%20%20%20originalSet.forEach(function(value%20)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20if%20(!iters.every(function(iter%20)%20%7Breturn%20iter.includes(value)%7D))%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20%20%20set.remove(value);%0A%09%20%20%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20%7D);%0A%09%20%20%20%20%20%20%7D);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Set.prototype.subtract%20=%20function()%20%7Bvar%20iters%20=%20SLICE$0.call(arguments,%200);%0A%09%20%20%20%20%20%20if%20(iters.length%20===%200)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20iters%20=%20iters.map(function(iter%20)%20%7Breturn%20SetIterable(iter)%7D);%0A%09%20%20%20%20%20%20var%20originalSet%20=%20this;%0A%09%20%20%20%20%20%20return%20this.withMutations(function(set%20)%20%7B%0A%09%20%20%20%20%20%20%20%20originalSet.forEach(function(value%20)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20if%20(iters.some(function(iter%20)%20%7Breturn%20iter.includes(value)%7D))%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20%20%20set.remove(value);%0A%09%20%20%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20%7D);%0A%09%20%20%20%20%20%20%7D);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Set.prototype.merge%20=%20function()%20%7B%0A%09%20%20%20%20%20%20return%20this.union.apply(this,%20arguments);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Set.prototype.mergeWith%20=%20function(merger)%20%7Bvar%20iters%20=%20SLICE$0.call(arguments,%201);%0A%09%20%20%20%20%20%20return%20this.union.apply(this,%20iters);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Set.prototype.sort%20=%20function(comparator)%20%7B%0A%09%20%20%20%20%20%20//%20Late%20binding%0A%09%20%20%20%20%20%20return%20OrderedSet(sortFactory(this,%20comparator));%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Set.prototype.sortBy%20=%20function(mapper,%20comparator)%20%7B%0A%09%20%20%20%20%20%20//%20Late%20binding%0A%09%20%20%20%20%20%20return%20OrderedSet(sortFactory(this,%20comparator,%20mapper));%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Set.prototype.wasAltered%20=%20function()%20%7B%0A%09%20%20%20%20%20%20return%20this._map.wasAltered();%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Set.prototype.__iterate%20=%20function(fn,%20reverse)%20%7Bvar%20this$0%20=%20this;%0A%09%20%20%20%20%20%20return%20this._map.__iterate(function(_,%20k)%20%20%7Breturn%20fn(k,%20k,%20this$0)%7D,%20reverse);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Set.prototype.__iterator%20=%20function(type,%20reverse)%20%7B%0A%09%20%20%20%20%20%20return%20this._map.map(function(_,%20k)%20%20%7Breturn%20k%7D).__iterator(type,%20reverse);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Set.prototype.__ensureOwner%20=%20function(ownerID)%20%7B%0A%09%20%20%20%20%20%20if%20(ownerID%20===%20this.__ownerID)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20var%20newMap%20=%20this._map.__ensureOwner(ownerID);%0A%09%20%20%20%20%20%20if%20(!ownerID)%20%7B%0A%09%20%20%20%20%20%20%20%20this.__ownerID%20=%20ownerID;%0A%09%20%20%20%20%20%20%20%20this._map%20=%20newMap;%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20this.__make(newMap,%20ownerID);%0A%09%20%20%20%20%7D;%0A%0A%0A%09%20%20function%20isSet(maybeSet)%20%7B%0A%09%20%20%20%20return%20!!(maybeSet%20&&%20maybeSet%5BIS_SET_SENTINEL%5D);%0A%09%20%20%7D%0A%0A%09%20%20Set.isSet%20=%20isSet;%0A%0A%09%20%20var%20IS_SET_SENTINEL%20=%20'@@__IMMUTABLE_SET__@@';%0A%0A%09%20%20var%20SetPrototype%20=%20Set.prototype;%0A%09%20%20SetPrototype%5BIS_SET_SENTINEL%5D%20=%20true;%0A%09%20%20SetPrototype%5BDELETE%5D%20=%20SetPrototype.remove;%0A%09%20%20SetPrototype.mergeDeep%20=%20SetPrototype.merge;%0A%09%20%20SetPrototype.mergeDeepWith%20=%20SetPrototype.mergeWith;%0A%09%20%20SetPrototype.withMutations%20=%20MapPrototype.withMutations;%0A%09%20%20SetPrototype.asMutable%20=%20MapPrototype.asMutable;%0A%09%20%20SetPrototype.asImmutable%20=%20MapPrototype.asImmutable;%0A%0A%09%20%20SetPrototype.__empty%20=%20emptySet;%0A%09%20%20SetPrototype.__make%20=%20makeSet;%0A%0A%09%20%20function%20updateSet(set,%20newMap)%20%7B%0A%09%20%20%20%20if%20(set.__ownerID)%20%7B%0A%09%20%20%20%20%20%20set.size%20=%20newMap.size;%0A%09%20%20%20%20%20%20set._map%20=%20newMap;%0A%09%20%20%20%20%20%20return%20set;%0A%09%20%20%20%20%7D%0A%09%20%20%20%20return%20newMap%20===%20set._map%20?%20set%20:%0A%09%20%20%20%20%20%20newMap.size%20===%200%20?%20set.__empty()%20:%0A%09%20%20%20%20%20%20set.__make(newMap);%0A%09%20%20%7D%0A%0A%09%20%20function%20makeSet(map,%20ownerID)%20%7B%0A%09%20%20%20%20var%20set%20=%20Object.create(SetPrototype);%0A%09%20%20%20%20set.size%20=%20map%20?%20map.size%20:%200;%0A%09%20%20%20%20set._map%20=%20map;%0A%09%20%20%20%20set.__ownerID%20=%20ownerID;%0A%09%20%20%20%20return%20set;%0A%09%20%20%7D%0A%0A%09%20%20var%20EMPTY_SET;%0A%09%20%20function%20emptySet()%20%7B%0A%09%20%20%20%20return%20EMPTY_SET%20%7C%7C%20(EMPTY_SET%20=%20makeSet(emptyMap()));%0A%09%20%20%7D%0A%0A%09%20%20createClass(OrderedSet,%20Set);%0A%0A%09%20%20%20%20//%20@pragma%20Construction%0A%0A%09%20%20%20%20function%20OrderedSet(value)%20%7B%0A%09%20%20%20%20%20%20return%20value%20===%20null%20%7C%7C%20value%20===%20undefined%20?%20emptyOrderedSet()%20:%0A%09%20%20%20%20%20%20%20%20isOrderedSet(value)%20?%20value%20:%0A%09%20%20%20%20%20%20%20%20emptyOrderedSet().withMutations(function(set%20)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20var%20iter%20=%20SetIterable(value);%0A%09%20%20%20%20%20%20%20%20%20%20assertNotInfinite(iter.size);%0A%09%20%20%20%20%20%20%20%20%20%20iter.forEach(function(v%20)%20%7Breturn%20set.add(v)%7D);%0A%09%20%20%20%20%20%20%20%20%7D);%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20OrderedSet.of%20=%20function(/*...values*/)%20%7B%0A%09%20%20%20%20%20%20return%20this(arguments);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20OrderedSet.fromKeys%20=%20function(value)%20%7B%0A%09%20%20%20%20%20%20return%20this(KeyedIterable(value).keySeq());%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20OrderedSet.prototype.toString%20=%20function()%20%7B%0A%09%20%20%20%20%20%20return%20this.__toString('OrderedSet%20%7B',%20'%7D');%0A%09%20%20%20%20%7D;%0A%0A%0A%09%20%20function%20isOrderedSet(maybeOrderedSet)%20%7B%0A%09%20%20%20%20return%20isSet(maybeOrderedSet)%20&&%20isOrdered(maybeOrderedSet);%0A%09%20%20%7D%0A%0A%09%20%20OrderedSet.isOrderedSet%20=%20isOrderedSet;%0A%0A%09%20%20var%20OrderedSetPrototype%20=%20OrderedSet.prototype;%0A%09%20%20OrderedSetPrototype%5BIS_ORDERED_SENTINEL%5D%20=%20true;%0A%0A%09%20%20OrderedSetPrototype.__empty%20=%20emptyOrderedSet;%0A%09%20%20OrderedSetPrototype.__make%20=%20makeOrderedSet;%0A%0A%09%20%20function%20makeOrderedSet(map,%20ownerID)%20%7B%0A%09%20%20%20%20var%20set%20=%20Object.create(OrderedSetPrototype);%0A%09%20%20%20%20set.size%20=%20map%20?%20map.size%20:%200;%0A%09%20%20%20%20set._map%20=%20map;%0A%09%20%20%20%20set.__ownerID%20=%20ownerID;%0A%09%20%20%20%20return%20set;%0A%09%20%20%7D%0A%0A%09%20%20var%20EMPTY_ORDERED_SET;%0A%09%20%20function%20emptyOrderedSet()%20%7B%0A%09%20%20%20%20return%20EMPTY_ORDERED_SET%20%7C%7C%20(EMPTY_ORDERED_SET%20=%20makeOrderedSet(emptyOrderedMap()));%0A%09%20%20%7D%0A%0A%09%20%20createClass(Stack,%20IndexedCollection);%0A%0A%09%20%20%20%20//%20@pragma%20Construction%0A%0A%09%20%20%20%20function%20Stack(value)%20%7B%0A%09%20%20%20%20%20%20return%20value%20===%20null%20%7C%7C%20value%20===%20undefined%20?%20emptyStack()%20:%0A%09%20%20%20%20%20%20%20%20isStack(value)%20?%20value%20:%0A%09%20%20%20%20%20%20%20%20emptyStack().unshiftAll(value);%0A%09%20%20%20%20%7D%0A%0A%09%20%20%20%20Stack.of%20=%20function(/*...values*/)%20%7B%0A%09%20%20%20%20%20%20return%20this(arguments);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Stack.prototype.toString%20=%20function()%20%7B%0A%09%20%20%20%20%20%20return%20this.__toString('Stack%20%5B',%20'%5D');%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20//%20@pragma%20Access%0A%0A%09%20%20%20%20Stack.prototype.get%20=%20function(index,%20notSetValue)%20%7B%0A%09%20%20%20%20%20%20var%20head%20=%20this._head;%0A%09%20%20%20%20%20%20index%20=%20wrapIndex(this,%20index);%0A%09%20%20%20%20%20%20while%20(head%20&&%20index--)%20%7B%0A%09%20%20%20%20%20%20%20%20head%20=%20head.next;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20head%20?%20head.value%20:%20notSetValue;%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Stack.prototype.peek%20=%20function()%20%7B%0A%09%20%20%20%20%20%20return%20this._head%20&&%20this._head.value;%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20//%20@pragma%20Modification%0A%0A%09%20%20%20%20Stack.prototype.push%20=%20function(/*...values*/)%20%7B%0A%09%20%20%20%20%20%20if%20(arguments.length%20===%200)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20var%20newSize%20=%20this.size%20+%20arguments.length;%0A%09%20%20%20%20%20%20var%20head%20=%20this._head;%0A%09%20%20%20%20%20%20for%20(var%20ii%20=%20arguments.length%20-%201;%20ii%20%3E=%200;%20ii--)%20%7B%0A%09%20%20%20%20%20%20%20%20head%20=%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20value:%20arguments%5Bii%5D,%0A%09%20%20%20%20%20%20%20%20%20%20next:%20head%0A%09%20%20%20%20%20%20%20%20%7D;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20if%20(this.__ownerID)%20%7B%0A%09%20%20%20%20%20%20%20%20this.size%20=%20newSize;%0A%09%20%20%20%20%20%20%20%20this._head%20=%20head;%0A%09%20%20%20%20%20%20%20%20this.__hash%20=%20undefined;%0A%09%20%20%20%20%20%20%20%20this.__altered%20=%20true;%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20makeStack(newSize,%20head);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Stack.prototype.pushAll%20=%20function(iter)%20%7B%0A%09%20%20%20%20%20%20iter%20=%20IndexedIterable(iter);%0A%09%20%20%20%20%20%20if%20(iter.size%20===%200)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20assertNotInfinite(iter.size);%0A%09%20%20%20%20%20%20var%20newSize%20=%20this.size;%0A%09%20%20%20%20%20%20var%20head%20=%20this._head;%0A%09%20%20%20%20%20%20iter.reverse().forEach(function(value%20)%20%7B%0A%09%20%20%20%20%20%20%20%20newSize++;%0A%09%20%20%20%20%20%20%20%20head%20=%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20value:%20value,%0A%09%20%20%20%20%20%20%20%20%20%20next:%20head%0A%09%20%20%20%20%20%20%20%20%7D;%0A%09%20%20%20%20%20%20%7D);%0A%09%20%20%20%20%20%20if%20(this.__ownerID)%20%7B%0A%09%20%20%20%20%20%20%20%20this.size%20=%20newSize;%0A%09%20%20%20%20%20%20%20%20this._head%20=%20head;%0A%09%20%20%20%20%20%20%20%20this.__hash%20=%20undefined;%0A%09%20%20%20%20%20%20%20%20this.__altered%20=%20true;%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20makeStack(newSize,%20head);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Stack.prototype.pop%20=%20function()%20%7B%0A%09%20%20%20%20%20%20return%20this.slice(1);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Stack.prototype.unshift%20=%20function(/*...values*/)%20%7B%0A%09%20%20%20%20%20%20return%20this.push.apply(this,%20arguments);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Stack.prototype.unshiftAll%20=%20function(iter)%20%7B%0A%09%20%20%20%20%20%20return%20this.pushAll(iter);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Stack.prototype.shift%20=%20function()%20%7B%0A%09%20%20%20%20%20%20return%20this.pop.apply(this,%20arguments);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Stack.prototype.clear%20=%20function()%20%7B%0A%09%20%20%20%20%20%20if%20(this.size%20===%200)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20if%20(this.__ownerID)%20%7B%0A%09%20%20%20%20%20%20%20%20this.size%20=%200;%0A%09%20%20%20%20%20%20%20%20this._head%20=%20undefined;%0A%09%20%20%20%20%20%20%20%20this.__hash%20=%20undefined;%0A%09%20%20%20%20%20%20%20%20this.__altered%20=%20true;%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20emptyStack();%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Stack.prototype.slice%20=%20function(begin,%20end)%20%7B%0A%09%20%20%20%20%20%20if%20(wholeSlice(begin,%20end,%20this.size))%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20var%20resolvedBegin%20=%20resolveBegin(begin,%20this.size);%0A%09%20%20%20%20%20%20var%20resolvedEnd%20=%20resolveEnd(end,%20this.size);%0A%09%20%20%20%20%20%20if%20(resolvedEnd%20!==%20this.size)%20%7B%0A%09%20%20%20%20%20%20%20%20//%20super.slice(begin,%20end);%0A%09%20%20%20%20%20%20%20%20return%20IndexedCollection.prototype.slice.call(this,%20begin,%20end);%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20var%20newSize%20=%20this.size%20-%20resolvedBegin;%0A%09%20%20%20%20%20%20var%20head%20=%20this._head;%0A%09%20%20%20%20%20%20while%20(resolvedBegin--)%20%7B%0A%09%20%20%20%20%20%20%20%20head%20=%20head.next;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20if%20(this.__ownerID)%20%7B%0A%09%20%20%20%20%20%20%20%20this.size%20=%20newSize;%0A%09%20%20%20%20%20%20%20%20this._head%20=%20head;%0A%09%20%20%20%20%20%20%20%20this.__hash%20=%20undefined;%0A%09%20%20%20%20%20%20%20%20this.__altered%20=%20true;%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20makeStack(newSize,%20head);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20//%20@pragma%20Mutability%0A%0A%09%20%20%20%20Stack.prototype.__ensureOwner%20=%20function(ownerID)%20%7B%0A%09%20%20%20%20%20%20if%20(ownerID%20===%20this.__ownerID)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20if%20(!ownerID)%20%7B%0A%09%20%20%20%20%20%20%20%20this.__ownerID%20=%20ownerID;%0A%09%20%20%20%20%20%20%20%20this.__altered%20=%20false;%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20makeStack(this.size,%20this._head,%20ownerID,%20this.__hash);%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20//%20@pragma%20Iteration%0A%0A%09%20%20%20%20Stack.prototype.__iterate%20=%20function(fn,%20reverse)%20%7B%0A%09%20%20%20%20%20%20if%20(reverse)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this.reverse().__iterate(fn);%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20var%20iterations%20=%200;%0A%09%20%20%20%20%20%20var%20node%20=%20this._head;%0A%09%20%20%20%20%20%20while%20(node)%20%7B%0A%09%20%20%20%20%20%20%20%20if%20(fn(node.value,%20iterations++,%20this)%20===%20false)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20break;%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20node%20=%20node.next;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20iterations;%0A%09%20%20%20%20%7D;%0A%0A%09%20%20%20%20Stack.prototype.__iterator%20=%20function(type,%20reverse)%20%7B%0A%09%20%20%20%20%20%20if%20(reverse)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this.reverse().__iterator(type);%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20var%20iterations%20=%200;%0A%09%20%20%20%20%20%20var%20node%20=%20this._head;%0A%09%20%20%20%20%20%20return%20new%20Iterator(function()%20%20%7B%0A%09%20%20%20%20%20%20%20%20if%20(node)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20var%20value%20=%20node.value;%0A%09%20%20%20%20%20%20%20%20%20%20node%20=%20node.next;%0A%09%20%20%20%20%20%20%20%20%20%20return%20iteratorValue(type,%20iterations++,%20value);%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20return%20iteratorDone();%0A%09%20%20%20%20%20%20%7D);%0A%09%20%20%20%20%7D;%0A%0A%0A%09%20%20function%20isStack(maybeStack)%20%7B%0A%09%20%20%20%20return%20!!(maybeStack%20&&%20maybeStack%5BIS_STACK_SENTINEL%5D);%0A%09%20%20%7D%0A%0A%09%20%20Stack.isStack%20=%20isStack;%0A%0A%09%20%20var%20IS_STACK_SENTINEL%20=%20'@@__IMMUTABLE_STACK__@@';%0A%0A%09%20%20var%20StackPrototype%20=%20Stack.prototype;%0A%09%20%20StackPrototype%5BIS_STACK_SENTINEL%5D%20=%20true;%0A%09%20%20StackPrototype.withMutations%20=%20MapPrototype.withMutations;%0A%09%20%20StackPrototype.asMutable%20=%20MapPrototype.asMutable;%0A%09%20%20StackPrototype.asImmutable%20=%20MapPrototype.asImmutable;%0A%09%20%20StackPrototype.wasAltered%20=%20MapPrototype.wasAltered;%0A%0A%0A%09%20%20function%20makeStack(size,%20head,%20ownerID,%20hash)%20%7B%0A%09%20%20%20%20var%20map%20=%20Object.create(StackPrototype);%0A%09%20%20%20%20map.size%20=%20size;%0A%09%20%20%20%20map._head%20=%20head;%0A%09%20%20%20%20map.__ownerID%20=%20ownerID;%0A%09%20%20%20%20map.__hash%20=%20hash;%0A%09%20%20%20%20map.__altered%20=%20false;%0A%09%20%20%20%20return%20map;%0A%09%20%20%7D%0A%0A%09%20%20var%20EMPTY_STACK;%0A%09%20%20function%20emptyStack()%20%7B%0A%09%20%20%20%20return%20EMPTY_STACK%20%7C%7C%20(EMPTY_STACK%20=%20makeStack(0));%0A%09%20%20%7D%0A%0A%09%20%20/**%0A%09%20%20%20*%20Contributes%20additional%20methods%20to%20a%20constructor%0A%09%20%20%20*/%0A%09%20%20function%20mixin(ctor,%20methods)%20%7B%0A%09%20%20%20%20var%20keyCopier%20=%20function(key%20)%20%7B%20ctor.prototype%5Bkey%5D%20=%20methods%5Bkey%5D;%20%7D;%0A%09%20%20%20%20Object.keys(methods).forEach(keyCopier);%0A%09%20%20%20%20Object.getOwnPropertySymbols%20&&%0A%09%20%20%20%20%20%20Object.getOwnPropertySymbols(methods).forEach(keyCopier);%0A%09%20%20%20%20return%20ctor;%0A%09%20%20%7D%0A%0A%09%20%20Iterable.Iterator%20=%20Iterator;%0A%0A%09%20%20mixin(Iterable,%20%7B%0A%0A%09%20%20%20%20//%20###%20Conversion%20to%20other%20types%0A%0A%09%20%20%20%20toArray:%20function()%20%7B%0A%09%20%20%20%20%20%20assertNotInfinite(this.size);%0A%09%20%20%20%20%20%20var%20array%20=%20new%20Array(this.size%20%7C%7C%200);%0A%09%20%20%20%20%20%20this.valueSeq().__iterate(function(v,%20i)%20%20%7B%20array%5Bi%5D%20=%20v;%20%7D);%0A%09%20%20%20%20%20%20return%20array;%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20toIndexedSeq:%20function()%20%7B%0A%09%20%20%20%20%20%20return%20new%20ToIndexedSequence(this);%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20toJS:%20function()%20%7B%0A%09%20%20%20%20%20%20return%20this.toSeq().map(%0A%09%20%20%20%20%20%20%20%20function(value%20)%20%7Breturn%20value%20&&%20typeof%20value.toJS%20===%20'function'%20?%20value.toJS()%20:%20value%7D%0A%09%20%20%20%20%20%20).__toJS();%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20toJSON:%20function()%20%7B%0A%09%20%20%20%20%20%20return%20this.toSeq().map(%0A%09%20%20%20%20%20%20%20%20function(value%20)%20%7Breturn%20value%20&&%20typeof%20value.toJSON%20===%20'function'%20?%20value.toJSON()%20:%20value%7D%0A%09%20%20%20%20%20%20).__toJS();%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20toKeyedSeq:%20function()%20%7B%0A%09%20%20%20%20%20%20return%20new%20ToKeyedSequence(this,%20true);%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20toMap:%20function()%20%7B%0A%09%20%20%20%20%20%20//%20Use%20Late%20Binding%20here%20to%20solve%20the%20circular%20dependency.%0A%09%20%20%20%20%20%20return%20Map(this.toKeyedSeq());%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20toObject:%20function()%20%7B%0A%09%20%20%20%20%20%20assertNotInfinite(this.size);%0A%09%20%20%20%20%20%20var%20object%20=%20%7B%7D;%0A%09%20%20%20%20%20%20this.__iterate(function(v,%20k)%20%20%7B%20object%5Bk%5D%20=%20v;%20%7D);%0A%09%20%20%20%20%20%20return%20object;%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20toOrderedMap:%20function()%20%7B%0A%09%20%20%20%20%20%20//%20Use%20Late%20Binding%20here%20to%20solve%20the%20circular%20dependency.%0A%09%20%20%20%20%20%20return%20OrderedMap(this.toKeyedSeq());%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20toOrderedSet:%20function()%20%7B%0A%09%20%20%20%20%20%20//%20Use%20Late%20Binding%20here%20to%20solve%20the%20circular%20dependency.%0A%09%20%20%20%20%20%20return%20OrderedSet(isKeyed(this)%20?%20this.valueSeq()%20:%20this);%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20toSet:%20function()%20%7B%0A%09%20%20%20%20%20%20//%20Use%20Late%20Binding%20here%20to%20solve%20the%20circular%20dependency.%0A%09%20%20%20%20%20%20return%20Set(isKeyed(this)%20?%20this.valueSeq()%20:%20this);%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20toSetSeq:%20function()%20%7B%0A%09%20%20%20%20%20%20return%20new%20ToSetSequence(this);%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20toSeq:%20function()%20%7B%0A%09%20%20%20%20%20%20return%20isIndexed(this)%20?%20this.toIndexedSeq()%20:%0A%09%20%20%20%20%20%20%20%20isKeyed(this)%20?%20this.toKeyedSeq()%20:%0A%09%20%20%20%20%20%20%20%20this.toSetSeq();%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20toStack:%20function()%20%7B%0A%09%20%20%20%20%20%20//%20Use%20Late%20Binding%20here%20to%20solve%20the%20circular%20dependency.%0A%09%20%20%20%20%20%20return%20Stack(isKeyed(this)%20?%20this.valueSeq()%20:%20this);%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20toList:%20function()%20%7B%0A%09%20%20%20%20%20%20//%20Use%20Late%20Binding%20here%20to%20solve%20the%20circular%20dependency.%0A%09%20%20%20%20%20%20return%20List(isKeyed(this)%20?%20this.valueSeq()%20:%20this);%0A%09%20%20%20%20%7D,%0A%0A%0A%09%20%20%20%20//%20###%20Common%20JavaScript%20methods%20and%20properties%0A%0A%09%20%20%20%20toString:%20function()%20%7B%0A%09%20%20%20%20%20%20return%20'%5BIterable%5D';%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20__toString:%20function(head,%20tail)%20%7B%0A%09%20%20%20%20%20%20if%20(this.size%20===%200)%20%7B%0A%09%20%20%20%20%20%20%20%20return%20head%20+%20tail;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20head%20+%20'%20'%20+%20this.toSeq().map(this.__toStringMapper).join(',%20')%20+%20'%20'%20+%20tail;%0A%09%20%20%20%20%7D,%0A%0A%0A%09%20%20%20%20//%20###%20ES6%20Collection%20methods%20(ES6%20Array%20and%20Map)%0A%0A%09%20%20%20%20concat:%20function()%20%7Bvar%20values%20=%20SLICE$0.call(arguments,%200);%0A%09%20%20%20%20%20%20return%20reify(this,%20concatFactory(this,%20values));%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20includes:%20function(searchValue)%20%7B%0A%09%20%20%20%20%20%20return%20this.some(function(value%20)%20%7Breturn%20is(value,%20searchValue)%7D);%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20entries:%20function()%20%7B%0A%09%20%20%20%20%20%20return%20this.__iterator(ITERATE_ENTRIES);%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20every:%20function(predicate,%20context)%20%7B%0A%09%20%20%20%20%20%20assertNotInfinite(this.size);%0A%09%20%20%20%20%20%20var%20returnValue%20=%20true;%0A%09%20%20%20%20%20%20this.__iterate(function(v,%20k,%20c)%20%20%7B%0A%09%20%20%20%20%20%20%20%20if%20(!predicate.call(context,%20v,%20k,%20c))%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20returnValue%20=%20false;%0A%09%20%20%20%20%20%20%20%20%20%20return%20false;%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%7D);%0A%09%20%20%20%20%20%20return%20returnValue;%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20filter:%20function(predicate,%20context)%20%7B%0A%09%20%20%20%20%20%20return%20reify(this,%20filterFactory(this,%20predicate,%20context,%20true));%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20find:%20function(predicate,%20context,%20notSetValue)%20%7B%0A%09%20%20%20%20%20%20var%20entry%20=%20this.findEntry(predicate,%20context);%0A%09%20%20%20%20%20%20return%20entry%20?%20entry%5B1%5D%20:%20notSetValue;%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20findEntry:%20function(predicate,%20context)%20%7B%0A%09%20%20%20%20%20%20var%20found;%0A%09%20%20%20%20%20%20this.__iterate(function(v,%20k,%20c)%20%20%7B%0A%09%20%20%20%20%20%20%20%20if%20(predicate.call(context,%20v,%20k,%20c))%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20found%20=%20%5Bk,%20v%5D;%0A%09%20%20%20%20%20%20%20%20%20%20return%20false;%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%7D);%0A%09%20%20%20%20%20%20return%20found;%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20findLastEntry:%20function(predicate,%20context)%20%7B%0A%09%20%20%20%20%20%20return%20this.toSeq().reverse().findEntry(predicate,%20context);%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20forEach:%20function(sideEffect,%20context)%20%7B%0A%09%20%20%20%20%20%20assertNotInfinite(this.size);%0A%09%20%20%20%20%20%20return%20this.__iterate(context%20?%20sideEffect.bind(context)%20:%20sideEffect);%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20join:%20function(separator)%20%7B%0A%09%20%20%20%20%20%20assertNotInfinite(this.size);%0A%09%20%20%20%20%20%20separator%20=%20separator%20!==%20undefined%20?%20''%20+%20separator%20:%20',';%0A%09%20%20%20%20%20%20var%20joined%20=%20'';%0A%09%20%20%20%20%20%20var%20isFirst%20=%20true;%0A%09%20%20%20%20%20%20this.__iterate(function(v%20)%20%7B%0A%09%20%20%20%20%20%20%20%20isFirst%20?%20(isFirst%20=%20false)%20:%20(joined%20+=%20separator);%0A%09%20%20%20%20%20%20%20%20joined%20+=%20v%20!==%20null%20&&%20v%20!==%20undefined%20?%20v.toString()%20:%20'';%0A%09%20%20%20%20%20%20%7D);%0A%09%20%20%20%20%20%20return%20joined;%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20keys:%20function()%20%7B%0A%09%20%20%20%20%20%20return%20this.__iterator(ITERATE_KEYS);%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20map:%20function(mapper,%20context)%20%7B%0A%09%20%20%20%20%20%20return%20reify(this,%20mapFactory(this,%20mapper,%20context));%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20reduce:%20function(reducer,%20initialReduction,%20context)%20%7B%0A%09%20%20%20%20%20%20assertNotInfinite(this.size);%0A%09%20%20%20%20%20%20var%20reduction;%0A%09%20%20%20%20%20%20var%20useFirst;%0A%09%20%20%20%20%20%20if%20(arguments.length%20%3C%202)%20%7B%0A%09%20%20%20%20%20%20%20%20useFirst%20=%20true;%0A%09%20%20%20%20%20%20%7D%20else%20%7B%0A%09%20%20%20%20%20%20%20%20reduction%20=%20initialReduction;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20this.__iterate(function(v,%20k,%20c)%20%20%7B%0A%09%20%20%20%20%20%20%20%20if%20(useFirst)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20useFirst%20=%20false;%0A%09%20%20%20%20%20%20%20%20%20%20reduction%20=%20v;%0A%09%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20reduction%20=%20reducer.call(context,%20reduction,%20v,%20k,%20c);%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%7D);%0A%09%20%20%20%20%20%20return%20reduction;%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20reduceRight:%20function(reducer,%20initialReduction,%20context)%20%7B%0A%09%20%20%20%20%20%20var%20reversed%20=%20this.toKeyedSeq().reverse();%0A%09%20%20%20%20%20%20return%20reversed.reduce.apply(reversed,%20arguments);%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20reverse:%20function()%20%7B%0A%09%20%20%20%20%20%20return%20reify(this,%20reverseFactory(this,%20true));%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20slice:%20function(begin,%20end)%20%7B%0A%09%20%20%20%20%20%20return%20reify(this,%20sliceFactory(this,%20begin,%20end,%20true));%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20some:%20function(predicate,%20context)%20%7B%0A%09%20%20%20%20%20%20return%20!this.every(not(predicate),%20context);%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20sort:%20function(comparator)%20%7B%0A%09%20%20%20%20%20%20return%20reify(this,%20sortFactory(this,%20comparator));%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20values:%20function()%20%7B%0A%09%20%20%20%20%20%20return%20this.__iterator(ITERATE_VALUES);%0A%09%20%20%20%20%7D,%0A%0A%0A%09%20%20%20%20//%20###%20More%20sequential%20methods%0A%0A%09%20%20%20%20butLast:%20function()%20%7B%0A%09%20%20%20%20%20%20return%20this.slice(0,%20-1);%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20isEmpty:%20function()%20%7B%0A%09%20%20%20%20%20%20return%20this.size%20!==%20undefined%20?%20this.size%20===%200%20:%20!this.some(function()%20%20%7Breturn%20true%7D);%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20count:%20function(predicate,%20context)%20%7B%0A%09%20%20%20%20%20%20return%20ensureSize(%0A%09%20%20%20%20%20%20%20%20predicate%20?%20this.toSeq().filter(predicate,%20context)%20:%20this%0A%09%20%20%20%20%20%20);%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20countBy:%20function(grouper,%20context)%20%7B%0A%09%20%20%20%20%20%20return%20countByFactory(this,%20grouper,%20context);%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20equals:%20function(other)%20%7B%0A%09%20%20%20%20%20%20return%20deepEqual(this,%20other);%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20entrySeq:%20function()%20%7B%0A%09%20%20%20%20%20%20var%20iterable%20=%20this;%0A%09%20%20%20%20%20%20if%20(iterable._cache)%20%7B%0A%09%20%20%20%20%20%20%20%20//%20We%20cache%20as%20an%20entries%20array,%20so%20we%20can%20just%20return%20the%20cache!%0A%09%20%20%20%20%20%20%20%20return%20new%20ArraySeq(iterable._cache);%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20var%20entriesSequence%20=%20iterable.toSeq().map(entryMapper).toIndexedSeq();%0A%09%20%20%20%20%20%20entriesSequence.fromEntrySeq%20=%20function()%20%20%7Breturn%20iterable.toSeq()%7D;%0A%09%20%20%20%20%20%20return%20entriesSequence;%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20filterNot:%20function(predicate,%20context)%20%7B%0A%09%20%20%20%20%20%20return%20this.filter(not(predicate),%20context);%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20findLast:%20function(predicate,%20context,%20notSetValue)%20%7B%0A%09%20%20%20%20%20%20return%20this.toKeyedSeq().reverse().find(predicate,%20context,%20notSetValue);%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20first:%20function()%20%7B%0A%09%20%20%20%20%20%20return%20this.find(returnTrue);%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20flatMap:%20function(mapper,%20context)%20%7B%0A%09%20%20%20%20%20%20return%20reify(this,%20flatMapFactory(this,%20mapper,%20context));%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20flatten:%20function(depth)%20%7B%0A%09%20%20%20%20%20%20return%20reify(this,%20flattenFactory(this,%20depth,%20true));%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20fromEntrySeq:%20function()%20%7B%0A%09%20%20%20%20%20%20return%20new%20FromEntriesSequence(this);%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20get:%20function(searchKey,%20notSetValue)%20%7B%0A%09%20%20%20%20%20%20return%20this.find(function(_,%20key)%20%20%7Breturn%20is(key,%20searchKey)%7D,%20undefined,%20notSetValue);%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20getIn:%20function(searchKeyPath,%20notSetValue)%20%7B%0A%09%20%20%20%20%20%20var%20nested%20=%20this;%0A%09%20%20%20%20%20%20//%20Note:%20in%20an%20ES6%20environment,%20we%20would%20prefer:%0A%09%20%20%20%20%20%20//%20for%20(var%20key%20of%20searchKeyPath)%20%7B%0A%09%20%20%20%20%20%20var%20iter%20=%20forceIterator(searchKeyPath);%0A%09%20%20%20%20%20%20var%20step;%0A%09%20%20%20%20%20%20while%20(!(step%20=%20iter.next()).done)%20%7B%0A%09%20%20%20%20%20%20%20%20var%20key%20=%20step.value;%0A%09%20%20%20%20%20%20%20%20nested%20=%20nested%20&&%20nested.get%20?%20nested.get(key,%20NOT_SET)%20:%20NOT_SET;%0A%09%20%20%20%20%20%20%20%20if%20(nested%20===%20NOT_SET)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20return%20notSetValue;%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20nested;%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20groupBy:%20function(grouper,%20context)%20%7B%0A%09%20%20%20%20%20%20return%20groupByFactory(this,%20grouper,%20context);%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20has:%20function(searchKey)%20%7B%0A%09%20%20%20%20%20%20return%20this.get(searchKey,%20NOT_SET)%20!==%20NOT_SET;%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20hasIn:%20function(searchKeyPath)%20%7B%0A%09%20%20%20%20%20%20return%20this.getIn(searchKeyPath,%20NOT_SET)%20!==%20NOT_SET;%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20isSubset:%20function(iter)%20%7B%0A%09%20%20%20%20%20%20iter%20=%20typeof%20iter.includes%20===%20'function'%20?%20iter%20:%20Iterable(iter);%0A%09%20%20%20%20%20%20return%20this.every(function(value%20)%20%7Breturn%20iter.includes(value)%7D);%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20isSuperset:%20function(iter)%20%7B%0A%09%20%20%20%20%20%20iter%20=%20typeof%20iter.isSubset%20===%20'function'%20?%20iter%20:%20Iterable(iter);%0A%09%20%20%20%20%20%20return%20iter.isSubset(this);%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20keySeq:%20function()%20%7B%0A%09%20%20%20%20%20%20return%20this.toSeq().map(keyMapper).toIndexedSeq();%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20last:%20function()%20%7B%0A%09%20%20%20%20%20%20return%20this.toSeq().reverse().first();%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20max:%20function(comparator)%20%7B%0A%09%20%20%20%20%20%20return%20maxFactory(this,%20comparator);%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20maxBy:%20function(mapper,%20comparator)%20%7B%0A%09%20%20%20%20%20%20return%20maxFactory(this,%20comparator,%20mapper);%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20min:%20function(comparator)%20%7B%0A%09%20%20%20%20%20%20return%20maxFactory(this,%20comparator%20?%20neg(comparator)%20:%20defaultNegComparator);%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20minBy:%20function(mapper,%20comparator)%20%7B%0A%09%20%20%20%20%20%20return%20maxFactory(this,%20comparator%20?%20neg(comparator)%20:%20defaultNegComparator,%20mapper);%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20rest:%20function()%20%7B%0A%09%20%20%20%20%20%20return%20this.slice(1);%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20skip:%20function(amount)%20%7B%0A%09%20%20%20%20%20%20return%20this.slice(Math.max(0,%20amount));%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20skipLast:%20function(amount)%20%7B%0A%09%20%20%20%20%20%20return%20reify(this,%20this.toSeq().reverse().skip(amount).reverse());%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20skipWhile:%20function(predicate,%20context)%20%7B%0A%09%20%20%20%20%20%20return%20reify(this,%20skipWhileFactory(this,%20predicate,%20context,%20true));%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20skipUntil:%20function(predicate,%20context)%20%7B%0A%09%20%20%20%20%20%20return%20this.skipWhile(not(predicate),%20context);%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20sortBy:%20function(mapper,%20comparator)%20%7B%0A%09%20%20%20%20%20%20return%20reify(this,%20sortFactory(this,%20comparator,%20mapper));%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20take:%20function(amount)%20%7B%0A%09%20%20%20%20%20%20return%20this.slice(0,%20Math.max(0,%20amount));%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20takeLast:%20function(amount)%20%7B%0A%09%20%20%20%20%20%20return%20reify(this,%20this.toSeq().reverse().take(amount).reverse());%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20takeWhile:%20function(predicate,%20context)%20%7B%0A%09%20%20%20%20%20%20return%20reify(this,%20takeWhileFactory(this,%20predicate,%20context));%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20takeUntil:%20function(predicate,%20context)%20%7B%0A%09%20%20%20%20%20%20return%20this.takeWhile(not(predicate),%20context);%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20valueSeq:%20function()%20%7B%0A%09%20%20%20%20%20%20return%20this.toIndexedSeq();%0A%09%20%20%20%20%7D,%0A%0A%0A%09%20%20%20%20//%20###%20Hashable%20Object%0A%0A%09%20%20%20%20hashCode:%20function()%20%7B%0A%09%20%20%20%20%20%20return%20this.__hash%20%7C%7C%20(this.__hash%20=%20hashIterable(this));%0A%09%20%20%20%20%7D%0A%0A%0A%09%20%20%20%20//%20###%20Internal%0A%0A%09%20%20%20%20//%20abstract%20__iterate(fn,%20reverse)%0A%0A%09%20%20%20%20//%20abstract%20__iterator(type,%20reverse)%0A%09%20%20%7D);%0A%0A%09%20%20//%20var%20IS_ITERABLE_SENTINEL%20=%20'@@__IMMUTABLE_ITERABLE__@@';%0A%09%20%20//%20var%20IS_KEYED_SENTINEL%20=%20'@@__IMMUTABLE_KEYED__@@';%0A%09%20%20//%20var%20IS_INDEXED_SENTINEL%20=%20'@@__IMMUTABLE_INDEXED__@@';%0A%09%20%20//%20var%20IS_ORDERED_SENTINEL%20=%20'@@__IMMUTABLE_ORDERED__@@';%0A%0A%09%20%20var%20IterablePrototype%20=%20Iterable.prototype;%0A%09%20%20IterablePrototype%5BIS_ITERABLE_SENTINEL%5D%20=%20true;%0A%09%20%20IterablePrototype%5BITERATOR_SYMBOL%5D%20=%20IterablePrototype.values;%0A%09%20%20IterablePrototype.__toJS%20=%20IterablePrototype.toArray;%0A%09%20%20IterablePrototype.__toStringMapper%20=%20quoteString;%0A%09%20%20IterablePrototype.inspect%20=%0A%09%20%20IterablePrototype.toSource%20=%20function()%20%7B%20return%20this.toString();%20%7D;%0A%09%20%20IterablePrototype.chain%20=%20IterablePrototype.flatMap;%0A%09%20%20IterablePrototype.contains%20=%20IterablePrototype.includes;%0A%0A%09%20%20//%20Temporary%20warning%20about%20using%20length%0A%09%20%20(function%20()%20%7B%0A%09%20%20%20%20try%20%7B%0A%09%20%20%20%20%20%20Object.defineProperty(IterablePrototype,%20'length',%20%7B%0A%09%20%20%20%20%20%20%20%20get:%20function%20()%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20if%20(!Iterable.noLengthWarning)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20%20%20var%20stack;%0A%09%20%20%20%20%20%20%20%20%20%20%20%20try%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error();%0A%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20catch%20(error)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20stack%20=%20error.stack;%0A%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(stack.indexOf('_wrapObject')%20===%20-1)%20%7B%0A%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20console%20&&%20console.warn%20&&%20console.warn(%0A%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'iterable.length%20has%20been%20deprecated,%20'+%0A%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'use%20iterable.size%20or%20iterable.count().%20'+%0A%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'This%20warning%20will%20become%20a%20silent%20error%20in%20a%20future%20version.%20'%20+%0A%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20stack%0A%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20);%0A%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this.size;%0A%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20%7D);%0A%09%20%20%20%20%7D%20catch%20(e)%20%7B%7D%0A%09%20%20%7D)();%0A%0A%0A%0A%09%20%20mixin(KeyedIterable,%20%7B%0A%0A%09%20%20%20%20//%20###%20More%20sequential%20methods%0A%0A%09%20%20%20%20flip:%20function()%20%7B%0A%09%20%20%20%20%20%20return%20reify(this,%20flipFactory(this));%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20findKey:%20function(predicate,%20context)%20%7B%0A%09%20%20%20%20%20%20var%20entry%20=%20this.findEntry(predicate,%20context);%0A%09%20%20%20%20%20%20return%20entry%20&&%20entry%5B0%5D;%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20findLastKey:%20function(predicate,%20context)%20%7B%0A%09%20%20%20%20%20%20return%20this.toSeq().reverse().findKey(predicate,%20context);%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20keyOf:%20function(searchValue)%20%7B%0A%09%20%20%20%20%20%20return%20this.findKey(function(value%20)%20%7Breturn%20is(value,%20searchValue)%7D);%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20lastKeyOf:%20function(searchValue)%20%7B%0A%09%20%20%20%20%20%20return%20this.findLastKey(function(value%20)%20%7Breturn%20is(value,%20searchValue)%7D);%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20mapEntries:%20function(mapper,%20context)%20%7Bvar%20this$0%20=%20this;%0A%09%20%20%20%20%20%20var%20iterations%20=%200;%0A%09%20%20%20%20%20%20return%20reify(this,%0A%09%20%20%20%20%20%20%20%20this.toSeq().map(%0A%09%20%20%20%20%20%20%20%20%20%20function(v,%20k)%20%20%7Breturn%20mapper.call(context,%20%5Bk,%20v%5D,%20iterations++,%20this$0)%7D%0A%09%20%20%20%20%20%20%20%20).fromEntrySeq()%0A%09%20%20%20%20%20%20);%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20mapKeys:%20function(mapper,%20context)%20%7Bvar%20this$0%20=%20this;%0A%09%20%20%20%20%20%20return%20reify(this,%0A%09%20%20%20%20%20%20%20%20this.toSeq().flip().map(%0A%09%20%20%20%20%20%20%20%20%20%20function(k,%20v)%20%20%7Breturn%20mapper.call(context,%20k,%20v,%20this$0)%7D%0A%09%20%20%20%20%20%20%20%20).flip()%0A%09%20%20%20%20%20%20);%0A%09%20%20%20%20%7D%0A%0A%09%20%20%7D);%0A%0A%09%20%20var%20KeyedIterablePrototype%20=%20KeyedIterable.prototype;%0A%09%20%20KeyedIterablePrototype%5BIS_KEYED_SENTINEL%5D%20=%20true;%0A%09%20%20KeyedIterablePrototype%5BITERATOR_SYMBOL%5D%20=%20IterablePrototype.entries;%0A%09%20%20KeyedIterablePrototype.__toJS%20=%20IterablePrototype.toObject;%0A%09%20%20KeyedIterablePrototype.__toStringMapper%20=%20function(v,%20k)%20%20%7Breturn%20JSON.stringify(k)%20+%20':%20'%20+%20quoteString(v)%7D;%0A%0A%0A%0A%09%20%20mixin(IndexedIterable,%20%7B%0A%0A%09%20%20%20%20//%20###%20Conversion%20to%20other%20types%0A%0A%09%20%20%20%20toKeyedSeq:%20function()%20%7B%0A%09%20%20%20%20%20%20return%20new%20ToKeyedSequence(this,%20false);%0A%09%20%20%20%20%7D,%0A%0A%0A%09%20%20%20%20//%20###%20ES6%20Collection%20methods%20(ES6%20Array%20and%20Map)%0A%0A%09%20%20%20%20filter:%20function(predicate,%20context)%20%7B%0A%09%20%20%20%20%20%20return%20reify(this,%20filterFactory(this,%20predicate,%20context,%20false));%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20findIndex:%20function(predicate,%20context)%20%7B%0A%09%20%20%20%20%20%20var%20entry%20=%20this.findEntry(predicate,%20context);%0A%09%20%20%20%20%20%20return%20entry%20?%20entry%5B0%5D%20:%20-1;%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20indexOf:%20function(searchValue)%20%7B%0A%09%20%20%20%20%20%20var%20key%20=%20this.toKeyedSeq().keyOf(searchValue);%0A%09%20%20%20%20%20%20return%20key%20===%20undefined%20?%20-1%20:%20key;%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20lastIndexOf:%20function(searchValue)%20%7B%0A%09%20%20%20%20%20%20var%20key%20=%20this.toKeyedSeq().reverse().keyOf(searchValue);%0A%09%20%20%20%20%20%20return%20key%20===%20undefined%20?%20-1%20:%20key;%0A%0A%09%20%20%20%20%20%20//%20var%20index%20=%0A%09%20%20%20%20%20%20//%20return%20this.toSeq().reverse().indexOf(searchValue);%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20reverse:%20function()%20%7B%0A%09%20%20%20%20%20%20return%20reify(this,%20reverseFactory(this,%20false));%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20slice:%20function(begin,%20end)%20%7B%0A%09%20%20%20%20%20%20return%20reify(this,%20sliceFactory(this,%20begin,%20end,%20false));%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20splice:%20function(index,%20removeNum%20/*,%20...values*/)%20%7B%0A%09%20%20%20%20%20%20var%20numArgs%20=%20arguments.length;%0A%09%20%20%20%20%20%20removeNum%20=%20Math.max(removeNum%20%7C%200,%200);%0A%09%20%20%20%20%20%20if%20(numArgs%20===%200%20%7C%7C%20(numArgs%20===%202%20&&%20!removeNum))%20%7B%0A%09%20%20%20%20%20%20%20%20return%20this;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20//%20If%20index%20is%20negative,%20it%20should%20resolve%20relative%20to%20the%20size%20of%20the%0A%09%20%20%20%20%20%20//%20collection.%20However%20size%20may%20be%20expensive%20to%20compute%20if%20not%20cached,%20so%0A%09%20%20%20%20%20%20//%20only%20call%20count()%20if%20the%20number%20is%20in%20fact%20negative.%0A%09%20%20%20%20%20%20index%20=%20resolveBegin(index,%20index%20%3C%200%20?%20this.count()%20:%20this.size);%0A%09%20%20%20%20%20%20var%20spliced%20=%20this.slice(0,%20index);%0A%09%20%20%20%20%20%20return%20reify(%0A%09%20%20%20%20%20%20%20%20this,%0A%09%20%20%20%20%20%20%20%20numArgs%20===%201%20?%0A%09%20%20%20%20%20%20%20%20%20%20spliced%20:%0A%09%20%20%20%20%20%20%20%20%20%20spliced.concat(arrCopy(arguments,%202),%20this.slice(index%20+%20removeNum))%0A%09%20%20%20%20%20%20);%0A%09%20%20%20%20%7D,%0A%0A%0A%09%20%20%20%20//%20###%20More%20collection%20methods%0A%0A%09%20%20%20%20findLastIndex:%20function(predicate,%20context)%20%7B%0A%09%20%20%20%20%20%20var%20key%20=%20this.toKeyedSeq().findLastKey(predicate,%20context);%0A%09%20%20%20%20%20%20return%20key%20===%20undefined%20?%20-1%20:%20key;%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20first:%20function()%20%7B%0A%09%20%20%20%20%20%20return%20this.get(0);%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20flatten:%20function(depth)%20%7B%0A%09%20%20%20%20%20%20return%20reify(this,%20flattenFactory(this,%20depth,%20false));%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20get:%20function(index,%20notSetValue)%20%7B%0A%09%20%20%20%20%20%20index%20=%20wrapIndex(this,%20index);%0A%09%20%20%20%20%20%20return%20(index%20%3C%200%20%7C%7C%20(this.size%20===%20Infinity%20%7C%7C%0A%09%20%20%20%20%20%20%20%20%20%20(this.size%20!==%20undefined%20&&%20index%20%3E%20this.size)))%20?%0A%09%20%20%20%20%20%20%20%20notSetValue%20:%0A%09%20%20%20%20%20%20%20%20this.find(function(_,%20key)%20%20%7Breturn%20key%20===%20index%7D,%20undefined,%20notSetValue);%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20has:%20function(index)%20%7B%0A%09%20%20%20%20%20%20index%20=%20wrapIndex(this,%20index);%0A%09%20%20%20%20%20%20return%20index%20%3E=%200%20&&%20(this.size%20!==%20undefined%20?%0A%09%20%20%20%20%20%20%20%20this.size%20===%20Infinity%20%7C%7C%20index%20%3C%20this.size%20:%0A%09%20%20%20%20%20%20%20%20this.indexOf(index)%20!==%20-1%0A%09%20%20%20%20%20%20);%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20interpose:%20function(separator)%20%7B%0A%09%20%20%20%20%20%20return%20reify(this,%20interposeFactory(this,%20separator));%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20interleave:%20function(/*...iterables*/)%20%7B%0A%09%20%20%20%20%20%20var%20iterables%20=%20%5Bthis%5D.concat(arrCopy(arguments));%0A%09%20%20%20%20%20%20var%20zipped%20=%20zipWithFactory(this.toSeq(),%20IndexedSeq.of,%20iterables);%0A%09%20%20%20%20%20%20var%20interleaved%20=%20zipped.flatten(true);%0A%09%20%20%20%20%20%20if%20(zipped.size)%20%7B%0A%09%20%20%20%20%20%20%20%20interleaved.size%20=%20zipped.size%20*%20iterables.length;%0A%09%20%20%20%20%20%20%7D%0A%09%20%20%20%20%20%20return%20reify(this,%20interleaved);%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20last:%20function()%20%7B%0A%09%20%20%20%20%20%20return%20this.get(-1);%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20skipWhile:%20function(predicate,%20context)%20%7B%0A%09%20%20%20%20%20%20return%20reify(this,%20skipWhileFactory(this,%20predicate,%20context,%20false));%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20zip:%20function(/*,%20...iterables%20*/)%20%7B%0A%09%20%20%20%20%20%20var%20iterables%20=%20%5Bthis%5D.concat(arrCopy(arguments));%0A%09%20%20%20%20%20%20return%20reify(this,%20zipWithFactory(this,%20defaultZipper,%20iterables));%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20zipWith:%20function(zipper/*,%20...iterables%20*/)%20%7B%0A%09%20%20%20%20%20%20var%20iterables%20=%20arrCopy(arguments);%0A%09%20%20%20%20%20%20iterables%5B0%5D%20=%20this;%0A%09%20%20%20%20%20%20return%20reify(this,%20zipWithFactory(this,%20zipper,%20iterables));%0A%09%20%20%20%20%7D%0A%0A%09%20%20%7D);%0A%0A%09%20%20IndexedIterable.prototype%5BIS_INDEXED_SENTINEL%5D%20=%20true;%0A%09%20%20IndexedIterable.prototype%5BIS_ORDERED_SENTINEL%5D%20=%20true;%0A%0A%0A%0A%09%20%20mixin(SetIterable,%20%7B%0A%0A%09%20%20%20%20//%20###%20ES6%20Collection%20methods%20(ES6%20Array%20and%20Map)%0A%0A%09%20%20%20%20get:%20function(value,%20notSetValue)%20%7B%0A%09%20%20%20%20%20%20return%20this.has(value)%20?%20value%20:%20notSetValue;%0A%09%20%20%20%20%7D,%0A%0A%09%20%20%20%20includes:%20function(value)%20%7B%0A%09%20%20%20%20%20%20return%20this.has(value);%0A%09%20%20%20%20%7D,%0A%0A%0A%09%20%20%20%20//%20###%20More%20sequential%20methods%0A%0A%09%20%20%20%20keySeq:%20function()%20%7B%0A%09%20%20%20%20%20%20return%20this.valueSeq();%0A%09%20%20%20%20%7D%0A%0A%09%20%20%7D);%0A%0A%09%20%20SetIterable.prototype.has%20=%20IterablePrototype.includes;%0A%0A%0A%09%20%20//%20Mixin%20subclasses%0A%0A%09%20%20mixin(KeyedSeq,%20KeyedIterable.prototype);%0A%09%20%20mixin(IndexedSeq,%20IndexedIterable.prototype);%0A%09%20%20mixin(SetSeq,%20SetIterable.prototype);%0A%0A%09%20%20mixin(KeyedCollection,%20KeyedIterable.prototype);%0A%09%20%20mixin(IndexedCollection,%20IndexedIterable.prototype);%0A%09%20%20mixin(SetCollection,%20SetIterable.prototype);%0A%0A%0A%09%20%20//%20#pragma%20Helper%20functions%0A%0A%09%20%20function%20keyMapper(v,%20k)%20%7B%0A%09%20%20%20%20return%20k;%0A%09%20%20%7D%0A%0A%09%20%20function%20entryMapper(v,%20k)%20%7B%0A%09%20%20%20%20return%20%5Bk,%20v%5D;%0A%09%20%20%7D%0A%0A%09%20%20function%20not(predicate)%20%7B%0A%09%20%20%20%20return%20function()%20%7B%0A%09%20%20%20%20%20%20return%20!predicate.apply(this,%20arguments);%0A%09%20%20%20%20%7D%0A%09%20%20%7D%0A%0A%09%20%20function%20neg(predicate)%20%7B%0A%09%20%20%20%20return%20function()%20%7B%0A%09%20%20%20%20%20%20return%20-predicate.apply(this,%20arguments);%0A%09%20%20%20%20%7D%0A%09%20%20%7D%0A%0A%09%20%20function%20quoteString(value)%20%7B%0A%09%20%20%20%20return%20typeof%20value%20===%20'string'%20?%20JSON.stringify(value)%20:%20value;%0A%09%20%20%7D%0A%0A%09%20%20function%20defaultZipper()%20%7B%0A%09%20%20%20%20return%20arrCopy(arguments);%0A%09%20%20%7D%0A%0A%09%20%20function%20defaultNegComparator(a,%20b)%20%7B%0A%09%20%20%20%20return%20a%20%3C%20b%20?%201%20:%20a%20%3E%20b%20?%20-1%20:%200;%0A%09%20%20%7D%0A%0A%09%20%20function%20hashIterable(iterable)%20%7B%0A%09%20%20%20%20if%20(iterable.size%20===%20Infinity)%20%7B%0A%09%20%20%20%20%20%20return%200;%0A%09%20%20%20%20%7D%0A%09%20%20%20%20var%20ordered%20=%20isOrdered(iterable);%0A%09%20%20%20%20var%20keyed%20=%20isKeyed(iterable);%0A%09%20%20%20%20var%20h%20=%20ordered%20?%201%20:%200;%0A%09%20%20%20%20var%20size%20=%20iterable.__iterate(%0A%09%20%20%20%20%20%20keyed%20?%0A%09%20%20%20%20%20%20%20%20ordered%20?%0A%09%20%20%20%20%20%20%20%20%20%20function(v,%20k)%20%20%7B%20h%20=%2031%20*%20h%20+%20hashMerge(hash(v),%20hash(k))%20%7C%200;%20%7D%20:%0A%09%20%20%20%20%20%20%20%20%20%20function(v,%20k)%20%20%7B%20h%20=%20h%20+%20hashMerge(hash(v),%20hash(k))%20%7C%200;%20%7D%20:%0A%09%20%20%20%20%20%20%20%20ordered%20?%0A%09%20%20%20%20%20%20%20%20%20%20function(v%20)%20%7B%20h%20=%2031%20*%20h%20+%20hash(v)%20%7C%200;%20%7D%20:%0A%09%20%20%20%20%20%20%20%20%20%20function(v%20)%20%7B%20h%20=%20h%20+%20hash(v)%20%7C%200;%20%7D%0A%09%20%20%20%20);%0A%09%20%20%20%20return%20murmurHashOfSize(size,%20h);%0A%09%20%20%7D%0A%0A%09%20%20function%20murmurHashOfSize(size,%20h)%20%7B%0A%09%20%20%20%20h%20=%20imul(h,%200xCC9E2D51);%0A%09%20%20%20%20h%20=%20imul(h%20%3C%3C%2015%20%7C%20h%20%3E%3E%3E%20-15,%200x1B873593);%0A%09%20%20%20%20h%20=%20imul(h%20%3C%3C%2013%20%7C%20h%20%3E%3E%3E%20-13,%205);%0A%09%20%20%20%20h%20=%20(h%20+%200xE6546B64%20%7C%200)%20%5E%20size;%0A%09%20%20%20%20h%20=%20imul(h%20%5E%20h%20%3E%3E%3E%2016,%200x85EBCA6B);%0A%09%20%20%20%20h%20=%20imul(h%20%5E%20h%20%3E%3E%3E%2013,%200xC2B2AE35);%0A%09%20%20%20%20h%20=%20smi(h%20%5E%20h%20%3E%3E%3E%2016);%0A%09%20%20%20%20return%20h;%0A%09%20%20%7D%0A%0A%09%20%20function%20hashMerge(a,%20b)%20%7B%0A%09%20%20%20%20return%20a%20%5E%20b%20+%200x9E3779B9%20+%20(a%20%3C%3C%206)%20+%20(a%20%3E%3E%202)%20%7C%200;%20//%20int%0A%09%20%20%7D%0A%0A%09%20%20var%20Immutable%20=%20%7B%0A%0A%09%20%20%20%20Iterable:%20Iterable,%0A%0A%09%20%20%20%20Seq:%20Seq,%0A%09%20%20%20%20Collection:%20Collection,%0A%09%20%20%20%20Map:%20Map,%0A%09%20%20%20%20OrderedMap:%20OrderedMap,%0A%09%20%20%20%20List:%20List,%0A%09%20%20%20%20Stack:%20Stack,%0A%09%20%20%20%20Set:%20Set,%0A%09%20%20%20%20OrderedSet:%20OrderedSet,%0A%0A%09%20%20%20%20Record:%20Record,%0A%09%20%20%20%20Range:%20Range,%0A%09%20%20%20%20Repeat:%20Repeat,%0A%0A%09%20%20%20%20is:%20is,%0A%09%20%20%20%20fromJS:%20fromJS%0A%0A%09%20%20%7D;%0A%0A%09%20%20return%20Immutable;%0A%0A%09%7D));%0A%0A/***/%20%7D%0A/******/%20%5D);")
var parentNode = (document.head || document.documentElement)
parentNode.appendChild(s);
parentNode.removeChild(s);